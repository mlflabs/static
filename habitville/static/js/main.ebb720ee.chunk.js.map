{"version":3,"sources":["../node_modules/@ionic/core/dist/esm-es5 lazy /^/.//.*/.entry/.js$/ include: //.entry/.js$/ exclude: //.system/.entry/.js$/ groupOptions: {} namespace object","../node_modules/ionicons/dist/esm-es5 lazy /^/.//.*/.entry/.js$/ include: //.entry/.js$/ exclude: //.system/.entry/.js$/ groupOptions: {} namespace object","pages/habits/models.ts","modules/loading/loadingService.ts","modules/loading/loading.component.tsx","modules/auth/components/user.page.tsx","modules/data/models.ts","env.ts","pages/habits/utilsHabits.ts","modules/data/utilsData.ts","pages/todo/models.ts","components/animatedIcon.tsx","modules/parties/models.ts","modules/data/adapters/dexie.ts","modules/localStorage/localStorageService.ts","utils.ts","modules/ajax/ajax.ts","modules/toast/toastService.ts","modules/auth/authService.ts","modules/data/sync.ts","modules/data/dataService.ts","modules/messages/models.ts","modules/social/models.ts","modules/gamify/utilsGamify.ts","modules/gamify/gamifyService.ts","pages/todo/todo.service.ts","pages/todo/todo.new.component.tsx","colors.ts","pages/todo/todo.edit.inline.component.tsx","pages/todo/Todo.listitem.component.tsx","pages/todo/hooks/todos.hook.ts","modules/app/hooks/appStatus.hook.ts","components/HeaderWithProgress.tsx","pages/todo/Todos.page.tsx","modules/auth/components/intro.page.tsx","modules/parties/party.service.ts","modules/social/social.service.ts","modules/social/components/Friends.list.component.tsx","modules/messages/components/Messages.list.component.tsx","pages/Home.tsx","pages/NotFound.tsx","modules/forms/myInput.tsx","modules/forms/myForm.tsx","modules/auth/components/auth.menu.component.tsx","modules/auth/components/login.page.tsx","modules/auth/components/register.page.tsx","modules/auth/unauthenticatedRoute.tsx","pages/habits/habits.service.ts","pages/habits/Habit.listitem.component.tsx","pages/habits/Habit.add.component.tsx","pages/habits/Habits.page.tsx","pages/habits/hooks/habits.hook.ts","components/MenuHeaderWithProgress.tsx","pages/todo/list.inline.add.component.tsx","pages/todo/todo.menu.item.tsx","pages/todo/todo.menulist.component.tsx","modules/menu/hooks/menu.hook.tsx","components/Menu.tsx","modules/parties/components/Party.edit.component.tsx","modules/parties/components/Party.listitem.component.tsx","modules/parties/pages/Parties.page.tsx","modules/parties/components/Challenge.member.scoreHistory.tsx","modules/parties/components/Members.list.component.tsx","modules/parties/components/Challenge.members.item.component.tsx","modules/parties/components/Challenge.listitem.component.tsx","modules/parties/components/Challenge.add.component.tsx","modules/parties/components/Challenge.list.component.tsx","modules/parties/pages/Party.view.page.tsx","routes.tsx","modules/toast/toast.component.tsx","App.tsx","serviceWorker.ts","index.tsx"],"names":["map","webpackAsyncContext","req","__webpack_require__","o","Promise","resolve","then","e","Error","code","ids","id","keys","Object","module","exports","habitStage","habitIntervals","habitDifficulty","loadingService","_loading","loading$","BehaviorSubject","show","this","msg","next","Loading","useState","state","setState","useEffect","subscriptions","subscribe","res","it","unsubscribe","isOpen","message","UserPage","Doc","String","fromCharCode","values","undefined","name","deleted","created","Date","now","updated","creator","type","dirty","rev","assign","ProjectItem","note","access","printDifficulty","hab","trivial","easy","medium","hard","extreme","Habit","stage","current","difficulty","regularityInterval","day","regularityIntervalGoal","regularityEachDayGoal","actions","lastCalculatedDate","currentTimeperiedStreak","currentTimeperiodLastDay","currentStreak","biggestStreak","newRewards","ulog","level","TRACE","detail","process","REACT_APP_STAGE","SYNC_SERVER","AUTH_API_URL","env","APP_ID","ACCESS_META_KEY","SERVER_ACCESS_META_KEY","MOMENT_DATE_FORMAT","GAMIFY_HABIT_GOLD_BASE_REWARD","GAMIFY_HABIT_EXPERIENCE_BASE_REWARD","HABIT_REWARDS_GOLD_BASE","HABIT_REWARDS_GOLD_PERCENTAGE_INCREASE","HABIT_REWARDS_EXPERIENCE_BASE","HABIT_REWARDS_EXPERIENCE_PERCENTAGE_INCREASE","HABIT_REWARDS_NEW_GOLD","HABIT_REWARDS_NEW_EXPERIENCE","TODO_NEW_GOLD_REWARDS","TODO_DONE_GOLD_REWARDS","TODO_NEW_EXPERIENCE_REWARDS","TODO_DONE_EXPERIENCE_REWARDS","MESSAGE_DURATION","TOKEN_EXPIRATION","getInitGamifyRewards","base","gold","experience","items","sortByDate","a","b","date","calculateCurrentStreak","habit","r","rewards","sort","forEach","action","moment","isBefore","isSame","isAfter","calculateDailyChallengeStreak","calculateWeeklyChallengeStreak","calculateMonthlyChallengeStreak","rewards1","rewards2","currentAction","subtract","format","currentDateMoment","add","isSameOrBefore","value","Math","floor","calculateGoldByStreak","calculateExperienceByStreak","analizeDay","h","nextTimeperiodFirstDay","nextWeekFirstDay","streak","baseXP","exponent","generateUserChannelId","userid","getDefaultProject","uuid","generateProjectUUID","genrateMetaData","generateUUID","ok","shortid","generate","substring","getProjectChildId","length","getChannelFromProjectId","app","generateCollectionId","projectid","collection","replace","waitMS","ms","setTimeout","saveIntoArray","item","ary","idKey","i","getIndexById","slice","getDocumentRights","user","channel","split","getChannelNameFromId","canEditProjectByRights","rights","getDefaultTodoList","project","TodoList","folder","icon","secondaryType","fullname","color","_new","getDefaultTodoTag","TodoTag","animatedIcon","Todo","done","list","tags","parent","subTodos","showSubTodos","showDone","doneRewards","AnimatedIcon","ChallengeState","ChallengeDifficulty","ChallengeIntervals","iconsvg","actionFunc","isStopped","isPaused","defaultOptions","loop","autoplay","render","animationData","rendererSettings","clearCanvas","scaleMode","preserveAspectRatio","actionHandler","onClick","className","options","height","width","log","DexieAdapter","scheme","db","_ready","ready$","_subscriptions","changes$","Subject","Dexie","stores","tables","t","columns","version","_init","open","error","sub","get","bulkGet","filter","doc","field","operator","where","equals","toArray","docs","startsWith","notEqual","put","bulkPut","PartyProject","members","moneyTypeSingle","moneyTypeMultiple","moneyColor","Challenge","waiting","localStorageService","localStorage","getItem","val","JSON","parse","str","stringify","setItem","console","capitalize","s","charAt","toUpperCase","printDateRelative","timestamp","m","diff","fromNow","getNested","obj","args","reduce","saveIntoDocList","d","ToastType","getAjaxMessage","success","data","status","errors","getPostRequest","url","form","getErrorMessage","location","post","showLoading","loadingMessage","axios","hideLoading","info","response","AuthStatus","toastService","messages$","default","milliseconds","toast","autoClose","duration","err","showMessage","getUser","username","email","token","token_expiery","expires","isGuest","getGuestUser","authService","_user","_authStatus","authStatus$","username$","loadAuth","User","forceLogout","setAuthStatus","setObject","isEqual","Guest","getObject","updateUser","warn","password","history","prev","push","printServerErrors","organizeData","channels","checkpoints","syncData","props","syncurl","checkpoint","chpoints","types","databaseScheme","sync","dataService","authId","_ready$","addSyncCall$","pipe","throttleTime","_syncRemote","getDoc","getBulk","queryByProperty","getProjectItems","save","remoteSync","oldDoc","_","getToken","gotNewRightsToken","doc2","doctype","channelname","asObservable","change","property","projectChildId","authid","syncRemote","dbSub","ready","Number","requestMaxSize","saveFromSync","calculateLevelExperience","exp","x","pow","calculateDoneTodoGold","todo","days","rew","calculateDoneTodoExperience","gamifyService","_userId","_state","health","maxHealth","maxExperience","state$","calculateFinishedTodoRewards","addGold","messageReceivedGold","addExperience","messageReceivedExperience","messageLostGold","messageLostExperience","calculateNewTodo","calculateNewHabitRewards","addRewards","dataSub","getReadySub","loadInitDocs","_save","sub2","subscribeDocChanges","getGamifyDocId","preMessage","postMessage","equal","initEqual","ts","red","TodoService","_projectid","selectedTodo","tag","tagDocs","doneTodos","orderFilter","orderAsync","showNewTagFilter","_subscription","listName","tagName","getTags","reloadTodos","subscribeProjectTypeChanges","filterAndSaveTodos","filtered","filterDoneParentFunction","orderFunction","todoId","parentId","parentTodo","concat","saveNewTags","addSubTodoToParent","tagDoc","printSimpleError","saveRes","remove","removeSubTodoFromParent","todoService","TodoNewComp","focus","closeFunc","saveFunc","projectId","useReducer","payload","title","showTags","closeFocus","_dispatch","inputEl","useRef","searchTags$","dispatch","setDelayedFocusOnInput","setFocus","searchTags","getTagsByStartingName","debounceTime","distinctUntilChanged","switchMap","term","regex","tag2","match","otherTags","index","trim","newDoc","onInputFocus","onSubAction","lastIndexOf","closeToolbar","fill","key","size","src","printSmallTagFromName","class","autofocus","ref","placeholder","onKeyPress","onIonChange","onIonBlur","onIonFocus","getDefaultState","showDeleteWarrning","text","mergeText","TodoEditInlineComponent","dataFunctions","hideRemoveWarrning","handleTagChange","newtags","find","includes","printTag","autoGrow","exec","newState","select","close","trash","onDidDismiss","header","buttons","role","cssClass","handler","reducer","TodoListItemComp","doneHandler","handleSelectTodo","printEdit","button","lines","slot","restart","check","AppStatus","HeaderWithProgress","style","right","alt","top","heart","trailWidth","percent","strokeWidth","strokeColor","leaf","Keyboard","Plugins","Device","TodosPage","useLocation","params","useParams","pathname","selectList","changeDoneFilter","changeOrderFilter","showNewTag","init","useTodosCollectionFacade","dataFunc","getInfo","devInfo","operatingSystem","addListener","keyboardHeight","setKeyboard","checkmarkCircleOutline","radioButtonOff","arrowDownOutline","arrowUpOutline","lastChild","vertical","horizontal","edge","IntroPage","initPartyState","partyService","sub1","subscribeChanges","party","channelid","partyProject","_createParty","saveNewProject","challenge","_createChallenge","saveSystemDoc","msgId","replied","accepted","newMsg","challengeid","saveFromServer","trace","initSocialState","friends","socialService","_userid","showAddModal","FriendsListComponent","hideAddUser","member","inputs","addFriend","messages","MessagesListComponent","loadMsgs","subscribeChannelTypeChanges","getAllByChannel","msgs","printMessageIcon","messageType","mail","peopleCircle","personAdd","printReplyStatus","happy","sad","printMessage","from","acceptPartyInvitation","rejectPartyInviation","printClubRequestAcceptRejectButtons","acceptFriendInvitation","rejectFriendInviation","printFriendRequestAcceptRejectButtons","Home","NotFound","padding","MyInput","updateFunction","position","displayName","hasValidation","event","target","printErrors","submitButtonText","getFormOptions","settings","getValidator","MyForm","submitFunction","valid","initForm","model","Array","isArray","validateItem","validators","validateForm","updateItem","validate","findById","validator","isEmpty","isLength","isEmail","disabled","AuthMenuComponent","page","useHistory","LoginPage","submitButtongText","min","max","submit","loginAndRedirect","paddingTop","logIn","RegisterPage","register","UnauthenticatedRoute","exact","path","component","to","getInitHabitsState","selected","habits","stageFilter","HabitsService","_project","_docs","docs$","getAllByProject","filterhabits","filterFunction","HabitListItemComponent","showEditModalFunction","setDoc","printDate","active","printDayIcon","updatehabit","cog","getRegularityValues","interval","week","month","HabitAddComponent","dismissFunc","getDefaultRegularityState","regularity","handleChange","handlerRegularityValue","handleDifficultyChange","newReg","handlerRegularityIntervalChange","debounce","times","printRegularityLabel","printDifficultyLabel","showModal","modalHabit","getAction","HabitsPage","habitsService","changeStageFilter","getProject","useHabitsCollectionFacade","habitsState","addhabit","MenuHeaderWithProgress","ListAddInlineComponent","encodeURI","newList","saveList","TodoMenuItemButtonComponet","actonFunc","sun","star","routerLink","routerDirection","initialState","tagsOpen","lists","openLists","showDeleteListAlert","deleteList","l","TodoMenuListComponent","subTodoList","loadInitTodoLists","tagsList","subscribeByPropertyChange","loadInitTags","todolists","tagButtonClickHandler","listItem","side","tagItem","subHeader","getMenuState","sunny","checkmark","basket","construct","appPages","home","refresh","bonfire","apps","lastComponent","withRouter","useMenuHookFacade","contentId","appPage","autoHide","PartyEditComponent","PartyListItemComponent","userId","PartiesPage","subs","changes","editParty","saveParty","ChallengeMemberScoreHistory","printDay","dateString","score","scoreHistory","PartyMembersListComponent","printScore","self","canEditThisProject","addUser","ChallengeMembersItem","ChallengeListItemComponent","joined","printAdminActionButtons","canEditProject","changeChallengeState","finished","future","acceptChallenge","submitChallengeActions","ChallengeAddComponent","_challenge","regularityValue","chdiff","modalChalleng","challenges","ChallengeListComponent","modalChallenge","loadChallenges","addChallenge","ch","hideChallengeModal","saveChallenge","getInitState","loadParty","PartyViewPage","Routes","loading","dataReady","appStatus","setAppStatus","setStatusFunction","getIsAuthenticated","renewToken","getUsername","guest","auth","useAppStatus","newpath","when","getRoutes","Toasts","setMessage","hideProgressBar","newestOnTop","closeOnClick","rtl","draggable","pauseOnHover","App","Boolean","window","hostname","ReactDOM","document","getElementById","navigator","serviceWorker","registration","unregister"],"mappings":"u11CAAA,IAAIA,EAAM,CACT,kCAAmC,CAClC,IACA,IAED,iCAAkC,CACjC,IACA,IAED,2BAA4B,CAC3B,IACA,IAED,0BAA2B,CAC1B,IACA,IAED,2BAA4B,CAC3B,IACA,IAED,0BAA2B,CAC1B,IACA,IAED,8BAA+B,CAC9B,IACA,IAED,6BAA8B,CAC7B,IACA,IAED,iCAAkC,CACjC,IACA,IAED,gCAAiC,CAChC,IACA,IAED,8BAA+B,CAC9B,IACA,IAED,6BAA8B,CAC7B,IACA,IAED,8BAA+B,CAC9B,IACA,IAED,6BAA8B,CAC7B,IACA,IAED,4BAA6B,CAC5B,IACA,IAED,2BAA4B,CAC3B,IACA,IAED,8BAA+B,CAC9B,IACA,IAED,6BAA8B,CAC7B,IACA,IAED,0BAA2B,CAC1B,IACA,IAED,yBAA0B,CACzB,IACA,IAED,uBAAwB,CACvB,IACA,IAED,gCAAiC,CAChC,IACA,IAED,+BAAgC,CAC/B,IACA,IAED,2BAA4B,CAC3B,IACA,IAED,0BAA2B,CAC1B,IACA,IAED,qBAAsB,CACrB,IACA,IAED,uCAAwC,CACvC,IACA,IAED,sCAAuC,CACtC,IACA,IAED,2BAA4B,CAC3B,IACA,IAED,0BAA2B,CAC1B,IACA,IAED,mCAAoC,CACnC,IACA,IAED,kCAAmC,CAClC,IACA,IAED,4BAA6B,CAC5B,IACA,IAED,2BAA4B,CAC3B,IACA,IAED,6BAA8B,CAC7B,IACA,IAED,4BAA6B,CAC5B,IACA,IAED,4BAA6B,CAC5B,IACA,IAED,2BAA4B,CAC3B,IACA,IAED,2BAA4B,CAC3B,IACA,IAED,0BAA2B,CAC1B,IACA,IAED,uBAAwB,CACvB,IACA,IAED,6BAA8B,CAC7B,IACA,IAED,4BAA6B,CAC5B,IACA,IAED,kCAAmC,CAClC,IACA,IAED,iCAAkC,CACjC,IACA,IAED,6BAA8B,CAC7B,IACA,IAED,4BAA6B,CAC5B,IACA,IAED,2BAA4B,CAC3B,IACA,IAED,0BAA2B,CAC1B,IACA,IAED,iCAAkC,CACjC,IACA,IAED,gCAAiC,CAChC,IACA,IAED,+BA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","file":"static/js/main.ebb720ee.chunk.js","sourcesContent":["var map = {\n\t\"./ion-action-sheet-ios.entry.js\": [\n\t\t339,\n\t\t37\n\t],\n\t\"./ion-action-sheet-md.entry.js\": [\n\t\t340,\n\t\t38\n\t],\n\t\"./ion-alert-ios.entry.js\": [\n\t\t341,\n\t\t21\n\t],\n\t\"./ion-alert-md.entry.js\": [\n\t\t342,\n\t\t22\n\t],\n\t\"./ion-app_8-ios.entry.js\": [\n\t\t343,\n\t\t10\n\t],\n\t\"./ion-app_8-md.entry.js\": [\n\t\t344,\n\t\t11\n\t],\n\t\"./ion-avatar_3-ios.entry.js\": [\n\t\t345,\n\t\t39\n\t],\n\t\"./ion-avatar_3-md.entry.js\": [\n\t\t346,\n\t\t40\n\t],\n\t\"./ion-back-button-ios.entry.js\": [\n\t\t347,\n\t\t41\n\t],\n\t\"./ion-back-button-md.entry.js\": [\n\t\t348,\n\t\t42\n\t],\n\t\"./ion-backdrop-ios.entry.js\": [\n\t\t349,\n\t\t79\n\t],\n\t\"./ion-backdrop-md.entry.js\": [\n\t\t350,\n\t\t80\n\t],\n\t\"./ion-button_2-ios.entry.js\": [\n\t\t351,\n\t\t43\n\t],\n\t\"./ion-button_2-md.entry.js\": [\n\t\t352,\n\t\t44\n\t],\n\t\"./ion-card_5-ios.entry.js\": [\n\t\t353,\n\t\t45\n\t],\n\t\"./ion-card_5-md.entry.js\": [\n\t\t354,\n\t\t46\n\t],\n\t\"./ion-checkbox-ios.entry.js\": [\n\t\t355,\n\t\t47\n\t],\n\t\"./ion-checkbox-md.entry.js\": [\n\t\t356,\n\t\t48\n\t],\n\t\"./ion-chip-ios.entry.js\": [\n\t\t357,\n\t\t49\n\t],\n\t\"./ion-chip-md.entry.js\": [\n\t\t358,\n\t\t50\n\t],\n\t\"./ion-col_3.entry.js\": [\n\t\t359,\n\t\t81\n\t],\n\t\"./ion-datetime_3-ios.entry.js\": [\n\t\t360,\n\t\t17\n\t],\n\t\"./ion-datetime_3-md.entry.js\": [\n\t\t361,\n\t\t18\n\t],\n\t\"./ion-fab_3-ios.entry.js\": [\n\t\t362,\n\t\t51\n\t],\n\t\"./ion-fab_3-md.entry.js\": [\n\t\t363,\n\t\t52\n\t],\n\t\"./ion-img.entry.js\": [\n\t\t364,\n\t\t82\n\t],\n\t\"./ion-infinite-scroll_2-ios.entry.js\": [\n\t\t365,\n\t\t35\n\t],\n\t\"./ion-infinite-scroll_2-md.entry.js\": [\n\t\t366,\n\t\t36\n\t],\n\t\"./ion-input-ios.entry.js\": [\n\t\t367,\n\t\t53\n\t],\n\t\"./ion-input-md.entry.js\": [\n\t\t368,\n\t\t54\n\t],\n\t\"./ion-item-option_3-ios.entry.js\": [\n\t\t369,\n\t\t55\n\t],\n\t\"./ion-item-option_3-md.entry.js\": [\n\t\t370,\n\t\t56\n\t],\n\t\"./ion-item_8-ios.entry.js\": [\n\t\t371,\n\t\t57\n\t],\n\t\"./ion-item_8-md.entry.js\": [\n\t\t372,\n\t\t58\n\t],\n\t\"./ion-loading-ios.entry.js\": [\n\t\t373,\n\t\t23\n\t],\n\t\"./ion-loading-md.entry.js\": [\n\t\t374,\n\t\t24\n\t],\n\t\"./ion-menu_3-ios.entry.js\": [\n\t\t375,\n\t\t59\n\t],\n\t\"./ion-menu_3-md.entry.js\": [\n\t\t376,\n\t\t60\n\t],\n\t\"./ion-modal-ios.entry.js\": [\n\t\t377,\n\t\t12\n\t],\n\t\"./ion-modal-md.entry.js\": [\n\t\t378,\n\t\t13\n\t],\n\t\"./ion-nav_2.entry.js\": [\n\t\t379,\n\t\t16\n\t],\n\t\"./ion-popover-ios.entry.js\": [\n\t\t380,\n\t\t14\n\t],\n\t\"./ion-popover-md.entry.js\": [\n\t\t381,\n\t\t15\n\t],\n\t\"./ion-progress-bar-ios.entry.js\": [\n\t\t382,\n\t\t61\n\t],\n\t\"./ion-progress-bar-md.entry.js\": [\n\t\t383,\n\t\t62\n\t],\n\t\"./ion-radio_2-ios.entry.js\": [\n\t\t384,\n\t\t63\n\t],\n\t\"./ion-radio_2-md.entry.js\": [\n\t\t385,\n\t\t64\n\t],\n\t\"./ion-range-ios.entry.js\": [\n\t\t386,\n\t\t65\n\t],\n\t\"./ion-range-md.entry.js\": [\n\t\t387,\n\t\t66\n\t],\n\t\"./ion-refresher_2-ios.entry.js\": [\n\t\t388,\n\t\t25\n\t],\n\t\"./ion-refresher_2-md.entry.js\": [\n\t\t389,\n\t\t26\n\t],\n\t\"./ion-reorder_2-ios.entry.js\": [\n\t\t390,\n\t\t33\n\t],\n\t\"./ion-reorder_2-md.entry.js\": [\n\t\t391,\n\t\t34\n\t],\n\t\"./ion-ripple-effect.entry.js\": [\n\t\t392,\n\t\t83\n\t],\n\t\"./ion-route_4.entry.js\": [\n\t\t393,\n\t\t67\n\t],\n\t\"./ion-searchbar-ios.entry.js\": [\n\t\t394,\n\t\t27\n\t],\n\t\"./ion-searchbar-md.entry.js\": [\n\t\t395,\n\t\t28\n\t],\n\t\"./ion-segment_2-ios.entry.js\": [\n\t\t396,\n\t\t68\n\t],\n\t\"./ion-segment_2-md.entry.js\": [\n\t\t397,\n\t\t69\n\t],\n\t\"./ion-select_3-ios.entry.js\": [\n\t\t398,\n\t\t70\n\t],\n\t\"./ion-select_3-md.entry.js\": [\n\t\t399,\n\t\t71\n\t],\n\t\"./ion-slide_2-ios.entry.js\": [\n\t\t400,\n\t\t84\n\t],\n\t\"./ion-slide_2-md.entry.js\": [\n\t\t401,\n\t\t85\n\t],\n\t\"./ion-spinner.entry.js\": [\n\t\t402,\n\t\t31\n\t],\n\t\"./ion-split-pane-ios.entry.js\": [\n\t\t403,\n\t\t86\n\t],\n\t\"./ion-split-pane-md.entry.js\": [\n\t\t404,\n\t\t87\n\t],\n\t\"./ion-tab-bar_2-ios.entry.js\": [\n\t\t405,\n\t\t72\n\t],\n\t\"./ion-tab-bar_2-md.entry.js\": [\n\t\t406,\n\t\t73\n\t],\n\t\"./ion-tab_2.entry.js\": [\n\t\t407,\n\t\t32\n\t],\n\t\"./ion-text.entry.js\": [\n\t\t408,\n\t\t74\n\t],\n\t\"./ion-textarea-ios.entry.js\": [\n\t\t409,\n\t\t75\n\t],\n\t\"./ion-textarea-md.entry.js\": [\n\t\t410,\n\t\t76\n\t],\n\t\"./ion-toast-ios.entry.js\": [\n\t\t411,\n\t\t29\n\t],\n\t\"./ion-toast-md.entry.js\": [\n\t\t412,\n\t\t30\n\t],\n\t\"./ion-toggle-ios.entry.js\": [\n\t\t413,\n\t\t19\n\t],\n\t\"./ion-toggle-md.entry.js\": [\n\t\t414,\n\t\t20\n\t],\n\t\"./ion-virtual-scroll.entry.js\": [\n\t\t415,\n\t\t88\n\t]\n};\nfunction webpackAsyncContext(req) {\n\tif(!__webpack_require__.o(map, req)) {\n\t\treturn Promise.resolve().then(function() {\n\t\t\tvar e = new Error(\"Cannot find module '\" + req + \"'\");\n\t\t\te.code = 'MODULE_NOT_FOUND';\n\t\t\tthrow e;\n\t\t});\n\t}\n\n\tvar ids = map[req], id = ids[0];\n\treturn __webpack_require__.e(ids[1]).then(function() {\n\t\treturn __webpack_require__(id);\n\t});\n}\nwebpackAsyncContext.keys = function webpackAsyncContextKeys() {\n\treturn Object.keys(map);\n};\nwebpackAsyncContext.id = 168;\nmodule.exports = webpackAsyncContext;","var map = {\n\t\"./ion-icon.entry.js\": [\n\t\t419,\n\t\t96\n\t]\n};\nfunction webpackAsyncContext(req) {\n\tif(!__webpack_require__.o(map, req)) {\n\t\treturn Promise.resolve().then(function() {\n\t\t\tvar e = new Error(\"Cannot find module '\" + req + \"'\");\n\t\t\te.code = 'MODULE_NOT_FOUND';\n\t\t\tthrow e;\n\t\t});\n\t}\n\n\tvar ids = map[req], id = ids[0];\n\treturn __webpack_require__.e(ids[1]).then(function() {\n\t\treturn __webpack_require__(id);\n\t});\n}\nwebpackAsyncContext.keys = function webpackAsyncContextKeys() {\n\treturn Object.keys(map);\n};\nwebpackAsyncContext.id = 170;\nmodule.exports = webpackAsyncContext;","\nimport { Doc } from '../../modules/data/models'\nimport { GamifyRewards } from './utilsHabits';\n\nexport const TYPE_HABBIT = 'hab';\nexport const MOMENT_DATE_FORMAT = 'YYYYMMDD';\n\nexport enum habitStage {\n  'finished',\n  'current',\n  'future',\n  'resting'\n}\n\nexport enum habitIntervals {\n  day = 'day',\n  week = 'week',\n  month = 'month'\n}\n\nexport enum habitDifficulty {\n  trivial, easy, medium, hard, extreme\n}\n\nexport const printDifficulty = (hab:habitDifficulty):string => {\n  switch(hab) {\n    case habitDifficulty.trivial:\n      return 'trivial'; // , easy peasy lemon squeezy\n    case habitDifficulty.easy:\n      return 'easy'; //Piece of Cake , Smooth Sailin'\n    case habitDifficulty.medium:\n      return 'medium'; //Let's Go\n    case habitDifficulty.hard:\n      return 'hard'; //No Pain, No Gain\n    case habitDifficulty.extreme:\n      return 'extreme'; //Death Wish\n  }\n}\n\n\nexport interface HabitAction {\n  value: number, \n  date:string, \n  reward?: GamifyRewards,\n}\n\nexport class Habit extends Doc {\n  name: string = 'New habit';\n  note?: string;\n  type:string = TYPE_HABBIT;\n  stage: habitStage = habitStage.current;\n  difficulty:habitDifficulty = habitDifficulty.medium;\n  //regularity\n  regularityInterval:habitIntervals = habitIntervals.day;\n  regularityIntervalGoal: number = 1;\n  regularityEachDayGoal: number = 1;\n\n  actions: {[key: string]: HabitAction } = {};\n  //streaks\n  //member info\n  lastCalculatedDate?:string;\n  currentTimeperiedStreak: number = 0;\n  currentTimeperiodLastDay?: string;\n\n  currentStreak: number = 0;\n  biggestStreak: number = 0;\n\n  newRewards?: GamifyRewards;\n  \n  constructor(values: Object = {}) {\n    super()\n    Object.assign(this, values);\n  }\n}\n\n\n","\nimport { BehaviorSubject } from 'rxjs';\n\n\n\nexport class LoadingService {\n  private _loading: boolean = false;\n  \n\n  public loading$ = new BehaviorSubject({show: this._loading, msg: 'Loading...'});\n\n  showLoading(msg = \"Loading...\") {\n    this._loading = true;\n    this.loading$.next({show:true, msg});\n  }\n\n  hideLoading() {\n    this._loading = false;\n    this.loading$.next({show:false, msg:''});\n  }\n\n  public get loading(): boolean {\n    return this._loading;\n  }\n\n\n  startLoadingTimer() {\n\n  }\n\n}\nexport const loadingService = new LoadingService();\n\n\n","import React, { useState, useEffect } from 'react';\nimport { IonLoading } from '@ionic/react';\nimport { Subscription } from 'rxjs';\nimport { loadingService } from './loadingService';\n\nexport const Loading: React.FC = () => {\n  const [state, setState] = useState({show:false, msg: 'Loading...'});\n\n  useEffect(() => {\n    const subscriptions: Subscription[] = [\n      loadingService.loading$.subscribe(res =>{\n        setState({show: res.show, msg: res.msg});\n      })\n    ];\n    return () => { subscriptions.map(it => it.unsubscribe()) };\n  },[]);\n\n  \n  //onDidDismiss={() => setShowLoading(false)}\n  return (\n      <IonLoading\n        isOpen={state.show}\n        message={state.msg}\n      />\n  );\n};","import React from 'react';\nimport { IonHeader, IonToolbar, IonPage, IonTitle, IonContent, IonLabel } from '@ionic/react';\n\n\n\nconst UserPage: React.FC = () => {\n  return (\n    <IonPage>\n      <IonHeader>\n        <IonToolbar>\n          <IonTitle>User Page</IonTitle>\n        </IonToolbar>\n      </IonHeader>\n      <IonContent>\n        <IonLabel>User</IonLabel>\n      </IonContent>\n    </IonPage>\n  );\n};\n\nexport default UserPage;\n","export const PROJECT_SERVICE = '';\nexport const PROJECT_INDEX_SERVICE = 'ch';\nexport const SYSTEM_DOC = 'sys';\n\nexport const LASTCHAR = String.fromCharCode(65535);\nexport const DIV = '.';\nexport const DOUBLE_DIV = '..';\n\nexport class Doc {\n  public id: string|undefined = undefined;\n  name: string = '';\n  public deleted?: boolean;\n  public created?: number = Date.now();\n  public updated?: number = Date.now();\n  public creator?: string;\n  public type: string = 'doc';\n  public dirty?: number = 0;\n  public rev = 1;\n  constructor(values: Object = {}) {\n      Object.assign(this, values);\n  }\n\n}\n\nexport class ProjectItem extends Doc {\n  public id:string;\n  public name: string = '';\n  public note?: string;\n  public access = [];\n\n  constructor(values: Object = {}) {\n    super();\n    Object.assign(this, values);\n    this.id = values['id'];\n    if(!this.id)\n      this.id = ''; \n  }\n}\n\n\n\n\n\n\n\n\n\n","import  ulog from 'ulog';\nulog.level = ulog.TRACE;\n\nexport const FIRST_DAY_OF_WEEK = 'Monday';\n\n\n\nconst dev = {\n  \n  \n}\n\nconst prod = {\n  SYNC_SERVER: 'https://auth.mlflabs.com',\n  AUTH_API_URL: 'https://auth.mlflabs.com',\n}\nconst detail = process.env.REACT_APP_STAGE === 'production' ? prod: dev;\nexport const env = {...{\n  APP_ID: 'hv',\n  //myenvoy settings\n  ACCESS_META_KEY: 'access',\n  SERVER_ACCESS_META_KEY: 'ch',\n  MOMENT_DATE_FORMAT: 'YYYYMMDD',\n\n  //gamify \n  GAMIFY_HABIT_GOLD_BASE_REWARD:  5,\n  GAMIFY_HABIT_EXPERIENCE_BASE_REWARD:  2,\n\n\n  HABIT_REWARDS_GOLD_BASE: 5,\n  HABIT_REWARDS_GOLD_PERCENTAGE_INCREASE: 0.2,\n  HABIT_REWARDS_EXPERIENCE_BASE: 3,\n  HABIT_REWARDS_EXPERIENCE_PERCENTAGE_INCREASE: 0.2,\n  HABIT_REWARDS_NEW_GOLD: 5,\n  HABIT_REWARDS_NEW_EXPERIENCE: 2,\n\n\n  TODO_NEW_GOLD_REWARDS: 1,\n  TODO_DONE_GOLD_REWARDS: 3,\n  TODO_NEW_EXPERIENCE_REWARDS: 2,\n  TODO_DONE_EXPERIENCE_REWARDS: 5,\n\n\n  //messages\n  MESSAGE_DURATION: 2000,\n\n  //Auth\n  TOKEN_EXPIRATION: 300, // how many days\n  SYNC_SERVER: 'https://auth.mlflabs.com',\n  AUTH_API_URL: 'https://auth.mlflabs.com',\n  //SYNC_SERVER: 'http://localhost:3002',\n  //AUTH_API_URL: 'http://localhost:3002',\n}, ...detail}\n\n//Serial: F17XL0MBKXLJ · UDID: 00008020-00036DD93AF2002E · Model: iPhone11,8","import { Habit, MOMENT_DATE_FORMAT, HabitAction } from './models';\nimport moment from 'moment';\nimport { FIRST_DAY_OF_WEEK, env } from '../../env';\nimport ulog from 'ulog';\n\nconst log = ulog('utils');\n\nexport interface GamifyRewards {\n  gold:number,\n  experience: number,\n  items:any[]\n}\n\nexport const mergeRewards = (rewards1: GamifyRewards, \n                             rewards2: GamifyRewards): GamifyRewards => {\n  return Object.assign({\n    gold: rewards1.gold + rewards2.gold,\n    experience: rewards1.experience + rewards2.experience,\n    items: [...rewards1.items, ...rewards2.items]\n  });\n}\n\n\n\nexport const getInitGamifyRewards =  (base?:GamifyRewards):GamifyRewards =>  {\n  return {...{ gold: 0, experience: 0, items:[] }, ...base};\n}\n\n\nconst sortByDate = (a, b) =>{\n  if(a.date > b.date) return 1;\n  return -1;\n}\n\nexport const calculateCurrentStreak = (habit: Habit, actions: HabitAction[]) => {\n    //loop through actions and add up rewards\n    let r ={habit: Object.assign(habit), rewards: getInitGamifyRewards()};\n    let rewards: GamifyRewards = getInitGamifyRewards();\n    actions.sort(sortByDate).forEach(action => {\n      //make sure we don't have future day, or past last calculated date day\n      if(r.habit.lastCalculatedDate){\n        if(moment(action.date).isBefore(moment(r.habit.lastCalculatedDate)))\n          throw new Error('Action date is too old, can not modify this action');\n        if(moment(action.date).isSame(moment(r.habit.lastCalculatedDate)))\n          throw new Error('Action for this date already submitted.');\n      }\n      if(moment(action.date).isAfter(moment()))\n        throw new Error('Action date is in the future, cannot modify this action');\n      \n      if(r.habit.regularityInterval === 'day')\n        r = calculateDailyChallengeStreak(r.habit, action)\n      else if(habit.regularityInterval === 'week')\n        r = calculateWeeklyChallengeStreak(r.habit, action)\n      else if(r.habit.regularityInterval === 'month')\n        r = calculateMonthlyChallengeStreak(r.habit, action)\n      else {\n        throw new Error('Challenge has incorrect regularityInterval, ' + \n          r.habit.regularityInterval )\n      }\n      rewards = mergeRewards(r.rewards, rewards);\n      \n    });\n    return {habit: r.habit, rewards};\n}\n\n\n//from action and back\nconst calculateDailyChallengeStreak = (habit: Habit, action: HabitAction) => {\n  \n\n  if(!habit.lastCalculatedDate) {\n    habit.actions = {};\n    habit.lastCalculatedDate = moment(action.date).subtract(1,'d').format(MOMENT_DATE_FORMAT);\n    habit.biggestStreak = 0;\n    habit.currentStreak = 0;\n  }\n\n  habit.actions[action.date] = action;\n\n  let currentAction;\n  let currentDateMoment = moment(habit.lastCalculatedDate).add(1, 'd');\n\n  //run this after going action/lastcalculateddate logic\n  while(currentDateMoment.isSameOrBefore(moment(action.date))) {\n    currentAction = habit.actions[currentDateMoment.format(MOMENT_DATE_FORMAT)];\n\n    //see if its null, no action or if contains values\n    if(currentAction) {\n      //do we have a value\n      if(currentAction.value >= habit.regularityEachDayGoal){\n        //success\n        habit.currentStreak++;\n      }\n      else {\n        //we have an action, but not a success\n        habit.currentStreak = 0;\n      }\n    }\n    else {\n        //currentAction is null, failed\n        habit.currentStreak = 0;\n    }\n    if(habit.currentStreak > habit.biggestStreak)\n      habit.biggestStreak = habit.currentStreak;\n\n    currentDateMoment.add(1, 'day');\n  }\n\n  habit.lastCalculatedDate = action.date;\n\n  //calculate rewards\n  let rewards = getInitGamifyRewards();\n  if(habit.currentStreak === 0){\n    rewards.gold = Math.floor(env.GAMIFY_HABIT_GOLD_BASE_REWARD * \n                        (action.value / habit.regularityEachDayGoal));\n    rewards.experience = Math.floor(env.GAMIFY_HABIT_EXPERIENCE_BASE_REWARD * \n                        (action.value / habit.regularityEachDayGoal));\n  }\n  else {\n    rewards.gold = calculateGoldByStreak(habit.currentStreak, \n                                          habit.difficulty,\n                                          env.GAMIFY_HABIT_GOLD_BASE_REWARD);\n    rewards.experience = calculateExperienceByStreak(habit.currentStreak,\n                                          habit.difficulty,\n                                          env.GAMIFY_HABIT_EXPERIENCE_BASE_REWARD);\n  }\n  return {habit: Object.assign(habit), rewards};\n}\n\n\n\nconst analizeDay = (currentAction: HabitAction, \n                     habit:Habit):{habit:Habit, \n                                   rewards:GamifyRewards} => {\n   //see if its null, no action or if contains values\n   let rewards = getInitGamifyRewards();\n   if(currentAction) {\n    //do we have a value\n    if(currentAction.value >= habit.regularityEachDayGoal){\n      //success\n      if(habit.currentTimeperiedStreak < habit.regularityIntervalGoal){\n        habit.currentTimeperiedStreak++;\n        habit.currentStreak++;\n        rewards.gold = calculateGoldByStreak(habit.currentStreak, \n          habit.difficulty,\n          env.GAMIFY_HABIT_GOLD_BASE_REWARD);\n        rewards.experience = calculateExperienceByStreak(habit.currentStreak,\n          habit.difficulty,\n          env.GAMIFY_HABIT_EXPERIENCE_BASE_REWARD);\n      }\n      else\n      {\n        //we made it, but we are over the goal value, just give basic bonus\n        //make it half of even a non streak one\n        rewards.gold = Math.floor(env.GAMIFY_HABIT_GOLD_BASE_REWARD/2);\n        rewards.experience = Math.floor(env.GAMIFY_HABIT_EXPERIENCE_BASE_REWARD/1.5);\n      }\n    } \n    else {\n      //we didn't make it this day, just give a basic, fraction of base reward\n      rewards.gold = calculateGoldByStreak(habit.currentStreak, \n        habit.difficulty,\n        env.GAMIFY_HABIT_GOLD_BASE_REWARD);\n      rewards.experience = calculateExperienceByStreak(habit.currentStreak,\n        habit.difficulty,\n        env.GAMIFY_HABIT_EXPERIENCE_BASE_REWARD);\n    }\n  }\n   \n  if(habit.currentStreak > habit.biggestStreak)\n    habit.biggestStreak = habit.currentStreak;\n  \n  return {habit: Object.assign(habit), rewards};\n}\n\n//from action and back\nconst calculateMonthlyChallengeStreak = (h: Habit, action: HabitAction) => {\n  let habit = Object.assign(h);\n  if(!habit.lastCalculatedDate) {\n    habit.actions = {};\n    habit.lastCalculatedDate = moment(action.date).subtract(1,'d').format(MOMENT_DATE_FORMAT);\n    habit.biggestStreak = 0;\n    habit.currentStreak = 0;\n    habit.currentTimeperiedStreak = 0;\n    habit.currentTimeperiodLastDay = moment(habit.lastCalculatedDate).date(1)\n                                        .add(1, 'month').format(MOMENT_DATE_FORMAT);\n  }\n\n  habit.actions[action.date] = action;\n\n  let currentAction;\n\n  let nextTimeperiodFirstDay = moment(habit.currentTimeperiodLastDay);\n  let currentDateMoment = moment(habit.lastCalculatedDate).add(1, 'd');\n  let rewards = getInitGamifyRewards();\n  //run this after going action/lastcalculateddate logic\n  while(currentDateMoment.isSameOrBefore(moment(action.date))) {\n    currentAction = habit.actions[currentDateMoment.format(MOMENT_DATE_FORMAT)];\n\n    //are we in the same week\n    if(currentDateMoment.isBefore(nextTimeperiodFirstDay)) {\n      const res = analizeDay(currentAction, habit)\n      habit = res.habit;\n      rewards = res.rewards;\n\n    }\n    else{ \n      //starting new timeperiod\n      //see if we made it last period\n      if(habit.currentTimeperiedStreak < habit.regularityIntervalGoal){\n        //we didn't make it, clear the streak\n        habit.currentStreak = 0;\n      }\n      nextTimeperiodFirstDay.add(1, 'month');\n      habit.currentTimeperiodLastDay = nextTimeperiodFirstDay.format(MOMENT_DATE_FORMAT);\n      //if we are before action date, its an error, too big of time span\n      if(currentDateMoment.isAfter(nextTimeperiodFirstDay)){\n        throw new Error('Action dates are too much apart.');\n      }\n      habit.currentTimeperiedStreak = 0;\n      const res = analizeDay(currentAction, habit);\n      habit = res.habit;\n      rewards = res.rewards;\n    }\n    currentDateMoment.add(1, 'day');\n  }\n\n  habit.lastCalculatedDate = action.date;\n  return {habit, rewards};\n}\n\n\n\nconst calculateWeeklyChallengeStreak = (h:Habit, action:HabitAction) => {\n  let habit = h;\n  if(!habit.lastCalculatedDate) {\n    habit.lastCalculatedDate = moment(action.date).subtract(1,'d').format(MOMENT_DATE_FORMAT);\n    habit.biggestStreak = 0;\n    habit.currentStreak = 0;\n    habit.currentTimeperiedStreak = 0;\n    habit.currentTimeperiodLastDay = moment(habit.lastCalculatedDate).day(FIRST_DAY_OF_WEEK)\n                                          .add(1, 'week').format(MOMENT_DATE_FORMAT);\n                                          habit.actions = {};\n  }\n\n  habit.actions[action.date] = action;\n\n  let currentAction;\n\n  let nextWeekFirstDay = moment(habit.currentTimeperiodLastDay);\n  let currentDateMoment = moment(habit.lastCalculatedDate).add(1, 'd');\n  let rewards = getInitGamifyRewards();\n  //run this after going action/lastcalculateddate logic\n  while(currentDateMoment.isSameOrBefore(moment(action.date))) {\n    currentAction = habit.actions[currentDateMoment.format(MOMENT_DATE_FORMAT)];\n\n    //are we in the same week\n    if(currentDateMoment.isBefore(nextWeekFirstDay)) {\n      const res = analizeDay(currentAction, habit)\n      rewards = res.rewards;\n      habit = res.habit;\n    }\n    else{ \n      //starting new timeperiod\n      //see if we made it last period\n      if(habit.currentTimeperiedStreak < habit.regularityIntervalGoal){\n        //we didn't make it, clear the streak\n        habit.currentStreak = 0;\n      }\n      nextWeekFirstDay.add(1, 'week');\n      habit.currentTimeperiodLastDay = nextWeekFirstDay.format(MOMENT_DATE_FORMAT);\n      //if we are before action date, its an error, too big of time span\n      if(currentDateMoment.isAfter(nextWeekFirstDay)){\n        throw new Error('Action dates are too much apart.');\n      }\n      habit.currentTimeperiedStreak = 0;\n      const res = analizeDay(currentAction, habit);\n      habit = res.habit;\n      rewards = res.rewards;\n    }\n    currentDateMoment.add(1, 'day');\n  }\n\n  habit.lastCalculatedDate = action.date;\n  return {habit, rewards};\n}\n\n\nconst calculateExperienceByStreak = (streak, difficulty,  baseXP) => {\n  let exponent = 0.7 + difficulty/5;\n  return Math.floor(baseXP + (streak * exponent))\n  \n}\n\nconst calculateGoldByStreak = (streak, difficulty,  baseXP) => {\n  let exponent = 1 + difficulty/5;\n  return Math.floor(baseXP + (streak * exponent))\n  \n}\n\n","import { PROJECT_SERVICE, DIV, PROJECT_INDEX_SERVICE, ProjectItem, Doc } from './models';\nimport shortid from 'shortid';\nimport { env } from '../../env';\n\nexport const TYPE_SETTINGS = 'set';\n\nexport function generateUserChannelId(userid): string {\n  return 'u' + env.APP_ID + userid;\n}\n\nexport function getDefaultProject(userid): ProjectItem {\n  const uuid = 'u' + env.APP_ID + userid;\n  return {\n    id: generateProjectUUID(uuid, ''),\n    rev: 1,\n    name: 'default',\n    access:[],\n    type: TYPE_SETTINGS,\n    updated: 0, //Date.now(),\n    [env.ACCESS_META_KEY]: genrateMetaData(userid), \n  }\n}\n\nexport function generateUUID():string {\n  let id;\n  let ok = false;\n  while (!ok) {\n    id = shortid.generate();\n    if(id.substring(0,1)!== '_' && id.substring(0,1)!== '-')\n      ok = true;\n  }\n\n  return id;\n}\n\nexport function isThisUserProject(id:string|undefined, userid): boolean {\n  return (getChannelFromProjectId(id) === generateUserChannelId(userid));\n}\n\nexport function getChannelNameFromId(id:string|undefined) {\n  if(id === undefined) throw new Error('Id cannot be undefined');\n  return id.split(DIV)[0];\n}\n\nexport function getProjectChildId(id:string|undefined): string {\n  if(id === undefined) throw new Error('Id can not be undefined');\n  let length = PROJECT_INDEX_SERVICE.length + DIV.length;\n  return id.substring(0, id.length-length);\n}\n\nexport function getChannelFromProjectId(id: string|undefined):string {\n  return getProjectChildId(id);\n}\n\nexport function generateProjectUUID(id = generateUUID(), app = env.APP_ID):string {\n  return app + id +  DIV + PROJECT_INDEX_SERVICE;\n}\n\nexport function generateProjectChildId(projectId: string, type: string, id = generateUUID()):string {\n  return PROJECT_SERVICE+ DIV + projectId.split(DIV)[1] + DIV + type +\n          DIV + id;\n}\n\nexport function generateCollectionId(projectid: string, collection, id = generateUUID()): string {\n  //eliminate dots from id, not allowed\n  id = id.replace('.','');\n  \n  if(projectid === undefined) throw new Error(\"Project can't be underfined\");\n  const length = PROJECT_INDEX_SERVICE.length;\n  return projectid.substring(0, projectid.length-length)+collection+ DIV +id; \n}\n\nexport const waitMS = (ms) => {\n  return new Promise((resolve) => {\n    setTimeout(resolve, ms);\n  });\n};\n\n\nexport function saveIntoArray(item: Object, ary: Array<any> = [], idKey: string = 'id'): Array<any> {\n  let i = getIndexById(item[idKey], ary, idKey);\n  if (i === -1) {\n    i = ary.length;\n  }\n  return [...ary.slice(0, i),\n  Object.assign({}, item),\n  ...ary.slice(i + 1)];\n}\n\nexport function genrateMetaData(userid:string):string[]{\n    return [ 'u'+ env.APP_ID + userid,]; \n}\n\n\n\nexport function getIndexById(id: string, ary: any, idKey: string = 'id'): number {\n  for (let i = 0; i < ary.length; i++) {\n    if (id === ary[i][idKey]) {\n      return i;\n    }\n  }\n  // if we don't have a match return null\n  return -1;\n}\n\nexport const extractTypeCollectionFromDocId = (id) => {\n  return id.split(DIV)[2];\n}\n\nexport const extractChannelNameFromDocId = (id) => {\n  return id.split(DIV)[0];\n}\n\n\n//rights functions\n/*\n    Rights, each digit represents different right\n    0.  0 - Not admin 1- Admin, can change everything\n    1.  (Project item) 0 - can't see, 1 - can see, 2 - can edit\n    2.  (Project children) 0 - can't see, 1 - can see own, 2 - can see all items\n    3.  (Project children edit) 0 -can't edit, 1 can edit/make own, 2 can edit all \n*/\n\nexport const getDocumentRights = (id: string|undefined, user):string|undefined => {\n  const channel = getChannelNameFromId(id);\n  return user[env.ACCESS_META_KEY][channel];\n}\n\nexport const canEditProject = (id, user): boolean => {\n  const rights = getDocumentRights(id, user);\n  if(!rights) return false;\n  return canEditProjectByRights(rights);\n} \n\nexport const canEditProjectByRights = (rights: string): boolean => {\n  if(rights.substring(0,1) === '1') return true;\n  if(rights.substring(1,2) === '2') return true;\n  return false;\n}\n\n\nexport const canEditDoc= (doc:Doc, user): boolean => {\n  const rights = getDocumentRights(doc.id, user);\n  if(!rights) return false;\n  return canEditItemByRights(rights, doc.creator === user.id);\n} \n\nexport const canEditOwnedItemByRights = (rights: string): boolean => {\n  if(rights.substring(0,1) === '1') return true;\n  if(rights.substring(3,4) === '1') return true;\n  if(rights.substring(3,4) === '2') return true;\n  return false;\n}\n\nexport const canEditOthersItemByRights = (rights: string): boolean => {\n  if(rights.substring(0,1) === '1') return true;\n  if(rights.substring(3,4) === '2') return true;\n  return false;\n}\n\nexport const canEditItemByRights = (rights: string, myItem:boolean): boolean => {\n  return (myItem)? canEditOwnedItemByRights(rights) : canEditOthersItemByRights(rights);\n}\n\n","import { Doc } from '../../modules/data/models'\nimport { GamifyRewards, getInitGamifyRewards } from '../habits/utilsHabits';\nimport { getProjectChildId } from '../../modules/data/utilsData';\n\nexport const TYPE_TODO = 'todo';\nexport const TYPE_TODO_LIST = 'todolist';\nexport const TYPE_TODO_FOLDER = 'todoFolder';\nexport const TYPE_TODO_TAG = 'todoTag';\n\nexport const FOLDER_BASE_POSITION = 'base';\n\nexport const getDefaultTodoList = (name:string = 'tasks', projectid:string):TodoList => {\n  const project = getProjectChildId(projectid);\n  return new TodoList({\n    id: undefined,\n    folder: undefined,\n    type: TYPE_TODO_LIST,\n    icon: 'check',\n    secondaryType: TYPE_TODO_LIST,\n    name,\n    fullname: project + name,\n  })\n}\n\nexport class TodoList extends Doc {\n  folder: string = FOLDER_BASE_POSITION;\n  type: string = TYPE_TODO_LIST;\n  project?: string;\n  icon?:string;\n  color?:string;\n  _new?: boolean;\n  fullname:string;\n  secondaryType:'todolist'|'todoFolder'  = TYPE_TODO_LIST\n\n  constructor(values: Object = {}) {\n    super();\n    Object.assign(this, values);\n    this.fullname = values['fullname'];\n  }\n}\n\nexport const getDefaultTodoTag = (name:string = 'tasks', icon:string ='check'):TodoTag => {\n  return new TodoTag({\n    id: undefined,\n    type: TYPE_TODO_TAG,\n    icon,\n    name,\n  })\n}\n\nexport class TodoTag extends Doc {\n  type: string = TYPE_TODO_TAG;\n  icon?:string;\n  animatedIcon?:any;\n  color?:string;\n  _new?: boolean;\n  constructor(values: Object = {}) {\n    super();\n    Object.assign(this, values);\n    //this.fullname = values['fullname'];\n  }\n}\n\nexport class Todo extends Doc {\n  note?: string;\n  type: string = TYPE_TODO;\n\n  done: boolean;\n  date: number|null;\n  list: string = 'default';\n  tags: string[];\n\n\n  _new?: boolean; // for saving new docs, temp solution\n    //sub tasks\n  parent: string | null;\n  subTodos: string[];\n  showSubTodos: boolean;\n  showDone: boolean;\n\n  newRewards: GamifyRewards;\n  doneRewards: GamifyRewards;\n  \n  constructor(values: Object = {}) {\n    super();\n    this.done = false;\n    this.date = null;\n    this.tags = [];\n    this.parent = null;\n    this.subTodos = [];\n\n    this.showSubTodos = false;\n    this.showDone = false;\n\n    this.newRewards = getInitGamifyRewards();\n    this.doneRewards = getInitGamifyRewards();\n    \n    Object.assign(this, values);\n\n  }\n}","import React, { useState } from 'react'\nimport Lottie from 'react-lottie';\nimport './default.css'\n\nexport const waitMS = (ms: number) => {\n  return new Promise((resolve) => {\n    setTimeout(resolve, ms);\n  });\n};\n\n\nfunction AnimatedIcon({iconsvg, actionFunc}:\n    {iconsvg:any, actionFunc:Function}) {\n  const [state, setState] = useState({isStopped:true, isPaused:true})\n\n\n  const defaultOptions = {\n    loop: true,\n    autoplay: false, \n    render: 'svg',\n    animationData: iconsvg,\n    rendererSettings: {\n      clearCanvas: true,\n      scaleMode: 'noScale',\n      preserveAspectRatio: 'xMidYMid slice'\n    }\n  }; \n\n  const actionHandler = async() => {\n    setState({isStopped:false, isPaused:false});\n    \n\n    await waitMS(1000);\n    actionFunc();\n    setState({isStopped:true, isPaused:true});\n  }\n\n  return (\n    <div onClick={() => actionHandler()} className =\"animatedfunction\">\n      <Lottie  options={defaultOptions}\n          height={25}\n          width={25}\n          isStopped={state.isPaused}\n          isPaused={state.isStopped}/>\n    </div>\n  )\n}\n\nexport default AnimatedIcon;\n","import { Doc, ProjectItem } from \"../data/models\";\n\nexport const TYPE_PARTY = 'party';\n\nexport enum ChallengeState {\n  finished = 'finished',\n  current = 'current',\n  future = 'future',\n  waiting = 'waiting',\n  resting = 'resting',\n}\n\nexport enum ChallengeDifficulty {\n  trivial, easy, medium, hard, extreme\n}\n\nexport enum ChallengeIntervals {\n  day = 'day',\n  week = 'week',\n  month = 'month'\n}\n\nexport interface PartyMember {\n  id: string,\n  username: string,\n  rights: string,\n  score: {exp: number},\n  scoreHistory: {[key:string]: {exp:number}};\n}\n\nexport interface ChallengeRewards {\n  score: number,\n  item?: any,\n}\n\nexport interface ChallengeAction {\n  date: string,\n  value: number, \n  reward: ChallengeRewards,\n}\nexport interface ChallengeMember {\n  id: string,\n  username: string,\n  score: {exp: number},\n  scoreHistory: {[key:string]: {exp:number}};\n  joinDate: number,\n  actions: { [key:string]: ChallengeAction },\n  lastCalculatedDate?: string,\n  currentStreak?: number,\n  biggestStreak?: number,\n\n}\n\n\nexport class PartyProject extends ProjectItem {\n  type: string = TYPE_PARTY\n  secondaryType: string = 'project'\n  creator: string = '';\n  dirty: number = 0;\n  members: PartyMember[]  = []\n\n  moneyTypeSingle: string = 'Ruby';\n  moneyTypeMultiple: string =  'Rubies';\n  moneyColor: string = '#ff0000'\n\n\n  constructor(values: Object = {}) {\n    super()\n    Object.assign(this, values);\n  }\n}\n\nexport class Challenge extends Doc {\n  name: string = 'New Challenge';\n  note?: string;\n  type:string = TYPE_PARTY;\n  access: string = ''\n  secondaryType: string = 'challenge'\n  state: ChallengeState = ChallengeState.waiting;\n  difficulty:ChallengeDifficulty = ChallengeDifficulty.medium;\n  //regularity\n  regularityInterval:ChallengeIntervals = ChallengeIntervals.day;\n  regularityIntervalGoal: number = 1;\n  regularityEachDayGoal: number = 1;\n\n  //members\n  members: ChallengeMember[]  = []\n\n  constructor(values: Object = {}) {\n    super()\n    Object.assign(this, values);\n  }\n}\n","import Dexie from 'dexie';\nimport { BehaviorSubject, Subject } from 'rxjs';\nimport { DataChangeEvent } from '../dataService';\nimport { Subscription } from 'rxjs';\nimport { env } from '../../../env';\nimport ulog from 'ulog';\n\nconst log = ulog('dexie');\n\nexport interface DatabaseScheme {\n  name: string,\n  version: number,\n  tables: TableScheme[],\n}\n\nexport interface TableScheme {\n  name: string,\n  columns: string,\n  sync: boolean,\n}\n\n\nexport default class DexieAdapter {\n\n  private db;\n  private _ready = false;\n  public ready$ = new BehaviorSubject(this._ready);\n  private _subscriptions:Subscription[] = [];\n\n  public changes$ = new Subject<DataChangeEvent>();\n\n  constructor(scheme: DatabaseScheme) {\n    this.db = new Dexie(env.APP_ID +  scheme.name+ '_dexie');\n    const stores = {};\n    scheme.tables.forEach(t => {\n      stores[t.name] = t.columns;\n    });\n    this.db.version(scheme.version).stores(stores);\n    this._init();\n  }\n\n  private async _init() {\n    try {\n      await this.db.open();\n      this._ready = true;\n      this.ready$.next(true);\n    }\n    catch(e) {\n      log.error(e);\n    }\n  }\n\n  public async destroy() {\n    this._subscriptions.forEach(sub => {\n      if(sub)sub.unsubscribe();\n    })\n  }\n\n  public async getDoc(id: string, collection: string): Promise<any> {\n    //const res = await this.db[collection].where('id').equals(id).first();\n    const res = await this.db[collection].get({id});\n    if(res) return res;\n    return null;\n  }\n\n  public async getBulk(ids: string[], collection: string): Promise<any> {\n    const res = await this.db[collection].bulkGet(ids);\n    return res.filter(doc => doc !== undefined)\n  }\n\n  public async queryByProperty(field: string, operator: string, \n      value: any, collection: string): Promise<any> {\n    switch(operator) {\n      case 'equals':\n        const docs = await this.db[collection].where(field).equals(value).toArray();\n        return docs;\n      case 'startsWith':\n        return await this.db[collection].where(field).startsWith(value).toArray();\n      case 'notEqual':\n        return await this.db[collection].where(field).notEqual(value).toArray();\n      default:\n        throw new Error('Missing proper operator, given: '+ operator);\n    }\n  }\n\n  public async getProjectItems(projectid: string, collection: string) {\n    const res = await this.db[collection].where('id').startsWith(projectid).toArray();\n    return res;\n  }\n\n  public async save(doc: any, collection: string, setDirty = true){\n    if(setDirty)\n      doc.dirty = 1;\n    const res = await this.db[collection].put(doc);\n    if(res) {\n      this.changes$.next({doc});\n      return true\n    }\n    return false;\n  }\n\n  public async saveFromSync(docs: any[], collection: string){\n    const res = await this.db[collection].bulkPut(docs);\n    if(res) {\n      docs.forEach(doc => {\n        this.changes$.next({doc});\n      })\n      return true\n    }\n    return false;\n  }\n\n\n}","\n\nclass LocalStorageService {\n  \n  async getItem(id: string){\n    return localStorage.getItem(id);\n  }\n\n  async getString(id: string):Promise<string>{\n    let val:string;\n    val = localStorage.getItem(id) || '';\n    return val;\n  }\n\n  async getObject(id: string):Promise<object|null> {\n    const val = localStorage.getItem(id);\n    if(!val)return null;\n    return JSON.parse(val);\n\n  }\n\n  async setObject(id: string, val: object):Promise<boolean> {\n    try {\n      const str = JSON.stringify(val);\n      await localStorage.setItem(id, str);\n      return true;\n    }\n    catch(e){\n      console.log(e);\n      return false;\n    }\n    \n\n  }\n\n\n\n  async setString(id: string, val: string) {\n    localStorage.setItem(id, val);\n  }\n  \n}\n\nconst localStorageService = new LocalStorageService();\n\nexport default localStorageService;","import moment from 'moment';\nimport ulog from 'ulog'\n\nconst log = ulog('utils');\n\nexport const capitalize = (s: string) => {\n  if (typeof s !== 'string') return ''\n  return s.charAt(0).toUpperCase() + s.slice(1)\n}\n\nexport const printDateRelative = (timestamp: number) => {\n  try {\n    const m = moment(timestamp);\n\n    if(moment().diff(m, 'd') < 3){\n      return m.fromNow();\n    }\n    else {\n      return m.format('DD-MM-YYYY');\n    }\n  }\n  catch(e){\n    log.error(e);\n  }\n}\n\nexport function getNested(obj: any, ...args: string[]) {\n  return args.reduce((obj, level) => obj && obj[level], obj)\n}\n\nexport const waitMS = (ms: number) => {\n  return new Promise((resolve) => {\n    setTimeout(resolve, ms);\n  });\n};\n\nexport function getAction(todo:string, data = {}){\n  return {type:todo, data:data};\n}\n\nexport function printCleanNote(text: string) {\n  const t = text.replace(/(\\r\\n|\\n|\\r)/gm,\" \");\n  if(t.length > 40)\n    return t.substring(0,37)+'...';\n  return t;\n}\n\nexport function saveIntoArray(item: Object, ary: Array<any> = [], idKey: string = 'id'): Array<any> {\n  let i = getIndexById(item[idKey], ary, idKey);\n  if (i === -1) {\n    i = ary.length;\n  }\n  return [...ary.slice(0, i),\n          Object.assign({}, item),\n          ...ary.slice(i + 1)];\n}\n\nexport function saveIntoDocList(item: Object, ary: Array<any> = [], idKey: string = 'id'): Array<any> {\n  if(item['deleted']){\n    return ary.filter(d => d[idKey] !== item[idKey])\n  }\n  let i = getIndexById(item[idKey], ary, idKey);\n  if (i === -1) {\n    i = ary.length;\n  }\n  return [...ary.slice(0, i),\n          Object.assign({}, item),\n          ...ary.slice(i + 1)];\n}\n\nexport function getIndexById(id: string, ary: any, idKey: string = 'id'): number {\n  for (let i = 0; i < ary.length; i++) {\n    if (id === ary[i][idKey]) {\n      return i;\n    }\n  }\n  return -1;\n}\n\nexport function findById(id:any, ary: any[], idKey: string = \"id\"): any {\nfor (let i = 0; i < ary.length; i++) {\n    if (id === ary[i][idKey]) {\n      return ary[i];\n    }\n  }\n  return null;\n}\n\nexport function removeFromArrayById(id: any, ary:Array<any>, idKey = 'id') {\n  return ary.filter(o => o[idKey] !== id);\n}\n\nexport function clamp(val:number, max:number, min:number = 0): number {\n  if(val > max) return max;\n  if(val < min) return min;\n  return val;\n}","import axios from 'axios';\nimport { getNested } from '../../utils';\nimport { loadingService } from '../loading/loadingService';\nimport ulog from 'ulog';\n\nconst log = ulog('ajax');\n\n\nexport interface ajaxResponse {\n  success: boolean,\n  data: any,\n  status?: number,\n  errors?: errorMessage[]\n}\n\n\nexport const getAjaxMessage = (success:boolean, data:any, \n    status:number = 0, errors: errorMessage[] = []): ajaxResponse => {\n  return {success, data, status, errors}\n}\n\nexport const getAjaxErrorMessage = (errorMessage: string, \n  location='system', status:number = 404 ) => {\n    return getAjaxMessage(false, null, status, \n      [{location, msg:errorMessage}])\n}\n\nexport interface errorMessage {\n  location: string,\n  msg: string\n}\n\nexport interface postRequest {\n  url: string,\n  type: string,\n  form: object,\n  options?: object,\n}\n\nexport interface getRequest {\n  url: string,\n  type: string,\n  form: object,\n  options?: object,\n}\n\nexport const getPostRequest = (url:string, form:object, options:object = {}, ) => {\n    return {url, type:'post', form, options};\n}\n\n\n\nexport const getErrorMessage = (msg: string, location:string = \"Server\"):errorMessage => {\n  return {msg, location};\n}\n\nexport const post = async (req: postRequest, showLoading = true, loadingMessage=\"Loading...\"):Promise<ajaxResponse> => {\n  try {\n    if(showLoading)\n      loadingService.showLoading(loadingMessage);\n    const res = await axios.post(req.url, req.form, req.options);\n\n    loadingService.hideLoading();\n    log.info(res);\n    return getAjaxMessage(true, res.data, 200);\n  }\n  catch(err) {\n    loadingService.hideLoading();\n    const response = getNested(err, 'response');\n    if(!response || !response.status) {\n      return getAjaxMessage(false, null, 503, [getErrorMessage(\"Service is temporarly unavailable\")]);\n    }\n    else if(response.status === 422){\n      return getAjaxMessage(false, null, response.data.status, response.data.errors);\n    }\n    else if(response.status === 404) {\n      return getAjaxMessage(false, null, 404, [getErrorMessage(\"Could not connect to server\")]);\n    }\n    else {\n      return getAjaxMessage(false, null, response.status, [getErrorMessage(\"Could not connect to server\")]);\n    }\n  }\n}\n","import { Subject } from 'rxjs';\nimport { ajaxResponse } from '../ajax/ajax';\nimport { toast } from 'react-toastify';\n\nexport interface ToastMessage {\n  message: string,\n  duration: number,\n  key?: number,\n}\n\nexport enum ToastType {\n  default = \"default\", \n  info = \"info\", \n  success = \"success\", \n  warning = \"warning\", \n  error = \"error\"\n}\n\n\nexport class ToastService {\n\n  public messages$ = new Subject<ToastMessage>();\n\n  showMessage(message: string, type:ToastType = ToastType.default, milliseconds: number = 3000) {\n    toast(message, {\n      type: type,\n      autoClose: milliseconds,\n    })\n  }\n\n  printSimpleError (msg:string, duration = 2000) {\n    toast( msg, {type: ToastType.error, autoClose: duration})\n  }\n\n  //TODO: for now only prints the first error\n  printServerErrors (res:ajaxResponse) {\n    const errors = res.errors || [];\n    if(errors.length > 0){\n      errors.forEach(err => this.showMessage(err.msg, ToastType.error))\n    }\n  }\n\n\n\n}\nexport const toastService = new ToastService();\n\n\n","\nimport { BehaviorSubject, Subject } from 'rxjs';\nimport * as moment from 'moment';\nimport { isEqual } from 'lodash';\nimport localStorageService from '../localStorage/localStorageService';\nimport {env} from '../../env';\nimport  { getPostRequest, post, ajaxResponse } from '../ajax/ajax';\nimport { toastService } from '../toast/toastService';\nimport ulog from 'ulog';\n\nconst log =  ulog('auth');\n\nexport enum AuthStatus {\n  Loading, \n  Guest, //not loged in\n  User // loged in\n}\n\nexport const GUEST = 'Guest';\nexport const AUTH_USER_KEY = 'auth-user-key';\nexport interface AuthEvent {\n  success: boolean;\n  code: number;\n  data: any;\n}\n\nexport interface User {\n  id: string,\n  username: string;\n  email: string|null;\n  token: string|null;\n  token_expiery: number|null;\n  access: any[];\n}\n\n\n\nexport const getUser = (values: any):User => {\n  if(values == null)\n    return {\n      id: 'guest',\n      username: GUEST,\n      email: null,\n      token: null,\n      token_expiery: null,\n      access: []\n    }\n\n  return {\n    id: values.id || 'guest',\n    username: values.username || GUEST,\n    email: values.email||null,\n    token: values.token||null,\n    token_expiery: values.token_expiery||values.expires||null,\n    access: values.access || []\n  }\n}\n\nexport const isGuest = (user:User) => {\n  return user.username === GUEST;\n}\n\nexport function getGuestUser(username:string = 'Guest'):User {\n  return getUser({ username });\n}\n\n\nexport class AuthService {\n  private _user:User = getGuestUser('null');\n  private _authStatus = AuthStatus.Loading;\n  public authStatus$ = new BehaviorSubject(this._authStatus);\n  public username$ = new Subject<string>();\n\n  constructor() {\n    this.loadAuth();\n  }\n\n  getIsAuthenticated():boolean { return this._authStatus === AuthStatus.User; }\n  getUsername() { return this._user.username; }\n  getEmail() { return this._user.email;}\n  getUser() { return this._user };\n\n\n  async updateUser(user: User, forceLogout = false) {\n    // log.info('Userupdate: ', user, forceLogout, this._authStatus);\n    log.info('Update User:: ', user);\n    if(!isGuest(user) || this._user.username ==='null') {\n\n      if(this._authStatus !== AuthStatus.User) {\n        this.setAuthStatus(AuthStatus.User);\n      }\n\n      if(user.username !== this._user.username){\n        this._user = user;\n        await localStorageService.setObject(AUTH_USER_KEY, user)\n        this.username$.next(user.username);\n      }\n      if(!isEqual(this._user, user)) {\n        log.info('New user object, save it', user);\n        this._user = user;\n        await localStorageService.setObject(AUTH_USER_KEY, user)\n      }\n      \n      return;\n    }\n\n    if(this._authStatus !== AuthStatus.Guest){\n      this.setAuthStatus(AuthStatus.Guest)\n  \n      if(forceLogout){\n        await localStorageService.setObject(AUTH_USER_KEY, getGuestUser);\n      }\n    }\n  }\n\n\n\n\n  async loadAuth() {\n    try {\n      const user = getUser(await localStorageService.getObject(AUTH_USER_KEY));\n      log.info('LOADED USER', user);\n\n      if(!user.token || !user.token_expiery) {\n        return this.updateUser(getGuestUser());\n      }\n      const exp = moment.unix(user.token_expiery);\n      if(exp.isAfter(moment.now())) {\n        return this.updateUser(user);\n      }\n      else {\n        log.warn('TOKEN is old');\n        return this.updateUser(getGuestUser())\n      }\n    }\n    catch(e) {\n      log.error(e);\n      return this.updateUser(getGuestUser())\n    }\n  }\n\n\n  public async loginAndRedirect(id: string, password: string, history, location) {\n    const res = await post( getPostRequest(env.AUTH_API_URL+'/auth/login',\n      { id, password, app: env.APP_ID },), true,  'Login in, please wait');\n      if(res.success) {\n        this.updateUser(getUser(res.data))\n        let next;\n        if(location && location.state && location.state.prev){\n          next = location.state.prev.startsWith('/auth/')? '/': location.state.prev;\n        }\n\n        history.push(next || '/');\n      }\n      else {\n        toastService.printServerErrors(res);\n      }\n  }\n\n  public async logout() {\n    \n  }\n\n  public async login(id: string, password: string):Promise<ajaxResponse> {\n    const res = await post( getPostRequest(env.AUTH_API_URL+'/auth/login',\n      { username: id, password: password, app: env.APP_ID }, {}), true,  'Login in, please wait');\n\n    return res;\n  }\n\n\n  public async renewToken() {\n    const res = await post(getPostRequest(env.AUTH_API_URL+'/auth/renewToken',\n                          {token: this._user.token}), false);\n    log.info('Renewed Token: ', res);\n    if(res.success){\n      await this.updateUser({...this._user, ...{token: res.data.token, \n                                [env.ACCESS_META_KEY]: res.data[env.SERVER_ACCESS_META_KEY],\n                                token_expiery: res.data.expires}})\n      return true;\n    }\n    else {\n      //is it bad token, or just no internet\n      if(res.status && res.status === 422){\n        await this.updateUser(getGuestUser());\n        return false;\n      }\n    }\n\n\n  }\n\n  public async register(username:string, email: string, password: string): Promise<boolean> {\n    const res = await post( getPostRequest(env.AUTH_API_URL+'/auth/register',\n                      { username, password, email }),\n                      true,  'Registering, please wait');\n    if(res.success) {\n        return true;\n    }\n    else {\n      toastService.printServerErrors(res);\n      return false;\n    }\n  }\n\n  public async forgotPassword() {\n    //const res = await this.http.post(environment.auth_api+'/auth/forgotpassword'\n  }\n\n\n  private setAuthStatus(status:AuthStatus){\n    this._authStatus = status;\n    this.authStatus$.next(status);\n  }\n\n  public getAuthStatus():AuthStatus {\n    return this._authStatus;\n  }\n\n  public getToken():string {\n    return this._user.token || '';\n  }\n\n  public get userid(): string {\n    return this._user.id || '';\n  }\n\n\n\n}\nexport const authService = new AuthService();\n\n","import { post, getPostRequest } from '../ajax/ajax';\nimport { DIV } from './models';\nimport localStorageService from '../localStorage/localStorageService';\nimport ulog from 'ulog';\n\nconst log = ulog('sync');\n\nexport interface SyncDataChannel {\n  name: string,\n  docs: any[],\n}\n\n\nexport const organizeData = async (data: any[]) => {\n  const channels = {};\n  let channel;\n\n  data.forEach(doc => {\n    channel = doc.id.split(DIV)[0];\n    if(!channels[channel]) channels[channel] = [];\n    channels[channel].push({...{}, ...doc});\n\n  });\n  //now load channel checkpoints\n  const checkpoints = await localStorageService.getObject('channel_checkpoints') || {};\n  return {channels: channels, checkpoints};\n}\n\nexport const syncData = async (props:{  data:any[],\n                                        syncurl: string, \n                                        token: string, \n                                        checkpoint: number,\n                                        requestMaxSize:number}) => {\n  //TODO: check our size of docs, if its bigger than max size\n  try {\n    //get checkpoint\n    const data =  await organizeData(props.data);\n    const res = await post(getPostRequest(props.syncurl + '/sync/sync', {\n      token: props.token,\n      checkpoint: props.checkpoint,\n      data,\n    }),false,'');\n\n    if(res) {\n      //merge the 2 checkpoints\n      const chpoints = await localStorageService.getObject('channel_checkpoints') || {};\n      await localStorageService.setObject('channel_checkpoints',{...chpoints, ...res.data.checkpoints})\n      return res.data.types;\n    }\n    return null;\n  }\n  catch(e){\n    log.error(e);\n   }\n}\n\n","import { Observable, Subject, BehaviorSubject } from 'rxjs';\nimport { map, filter, throttleTime } from 'rxjs/operators';\nimport { getProjectChildId, generateCollectionId, \n  TYPE_SETTINGS, waitMS, getChannelFromProjectId } from './utilsData';\n\nimport { ProjectItem, DIV } from './models';\nimport _ from 'lodash';\nimport DexieAdapter, { DatabaseScheme } from './adapters/dexie';\nimport { TYPE_HABBIT } from '../../pages/habits/models';\nimport { TYPE_TODO, TYPE_TODO_LIST, TYPE_TODO_TAG } from '../../pages/todo/models';\nimport { TYPE_PARTY } from '../parties/models';\nimport { TYPE_MSG } from '../messages/models';\nimport { env } from '../../env';\nimport { authService } from '../auth/authService';\nimport localStorageService from '../localStorage/localStorageService';\nimport { syncData } from './sync';\nimport { post, getPostRequest } from '../ajax/ajax';\nimport ulog from 'ulog';\nimport { TYPE_SOCIAL } from '../social/models';\n\nconst log = ulog('dataService');\n\nexport interface DataChangeEvent {\n  doc: any,\n  old?: any,\n}\n\nconst databaseScheme: DatabaseScheme =  {\n  name: 'guest_dx',\n  version: 21,\n  tables: [\n    {\n      name: TYPE_SETTINGS,\n      columns: 'id, dirty',\n      sync: true\n    },\n    {\n      name: TYPE_PARTY,\n      columns: 'id, dirty, party, type, secondaryType',\n      sync: true\n    },\n    {\n      name: TYPE_TODO,\n      columns: 'id, *tags, list ,dirty',\n      sync: true\n    },\n    {\n      name: TYPE_TODO_LIST,\n      columns: 'id, dirty, folder, secondaryType, fullname',\n      sync: true\n    },\n    {\n      name: TYPE_TODO_TAG,\n      columns: 'id, name, dirty',\n      sync: true\n    },\n    {\n      name: TYPE_HABBIT,\n      columns: 'id, dirty',\n      sync: true\n    },\n    {\n      name: TYPE_MSG,\n      columns: 'id, messageType, dirty',\n      sync: true\n    },\n    {\n      name: TYPE_SOCIAL,\n      columns: 'id, name, dirty, secondaryType',\n      sync: true\n    },\n  ]\n}\n\n\n\nclass DataService {\n  private db;\n  private authId:string = '';\n  private _ready = false;\n  public _ready$ = new BehaviorSubject(this._ready);\n  public addSyncCall$ = new Subject(); // do we need to sync with server\n\n  constructor() {\n    //subscriptions\n    this.addSyncCall$.pipe(\n      throttleTime(5000),\n    ).subscribe(() => {\n        log.info('Syncing.......')\n        this._syncRemote();\n      })\n  }\n\n  async getDoc(id: string|undefined,  collection: string): Promise<any> {\n    if(id === undefined){\n      throw new Error('Doc Id cannot be undefined, check logic.');\n    }\n    return await this.db.getDoc(id, collection);\n  }\n\n  async getBulk(ids: string[], collection: string): Promise<any> {\n   return await this.db.getBulk(ids, collection);\n  }\n\n  //operators: equals, startsWith, above, below, notEqual\n  async queryByProperty(field:string, operator: 'equals'|'startsWith'|'notEqual', \n      value: any, collection: string): Promise<any> {\n    return await this.db.queryByProperty(field, operator, value, collection);\n  }\n\n  async getAllByProject(projectid, collection): Promise<any> {\n    return await this.db.getProjectItems(getProjectChildId(projectid) + DIV, collection);\n  }\n\n  async getAllByChannel(channel, collection): Promise<any> {\n    return await this.db.getProjectItems(channel + DIV, collection);\n  }\n\n  //save without making it diryt\n  async saveFromServer(doc:any, type:string) {\n    await this.db.save(doc, type, false);\n  }\n\n  async save(doc:any, collection: string, props:{projectid?: string, \n    oldDoc?: any,remoteSync?:boolean} = {}): Promise<any> {  \n      log.info('SAVING DOC', doc, props, collection);\n      if(!props) props = {remoteSync: true};\n      if(props.remoteSync === undefined) props.remoteSync = true;\n    \n      try {\n        let oldDoc = {};\n        if (doc.id && props.oldDoc == null) {\n          oldDoc = await this.getDoc(doc.id, collection);\n        }\n        if (_.isEqual(oldDoc, doc)) {\n          return false; \n        }\n    \n        if(!doc.id) {\n          if(!props.projectid) throw new Error('Saving new doc requires valid props.project')\n            // @ts-ignore:  we made this check at the begining\n          doc.id = generateCollectionId(props.projectid, collection);\n          doc.created = Date.now();\n        }\n        doc.dirty = true;\n        if(!doc.rev)doc.rev = 1;\n        doc.rev ++;\n        const res = await this.db.save(doc, collection);\n        if (props.remoteSync)\n          this.addSyncCall$.next();\n        if (res.ok)\n          return res;\n        else\n          return false;\n        }\n      catch (e) {\n        log.error('DEXIE error: ', e);\n        return false;\n      }\n  }\n\n  \n\n  \n\n\n  async saveNewProject(project:ProjectItem, collection: string): Promise<any> {\n    const res = await post(getPostRequest(env.AUTH_API_URL +'/channels/addNewChannel',\n                      {token: authService.getToken(), \n                       doc: project,\n                       name: project.name}, {} ),  false) ;\n    log.info('Making new project, ajax result: ', res);\n    if(!res.success)\n      return res;\n\n    const channel = res.data.channel;\n    let gotNewRightsToken = false;\n    while(!gotNewRightsToken){\n      const user = authService.getUser();\n      if(user[env.ACCESS_META_KEY][channel]){\n        gotNewRightsToken = true;\n      }\n      else {\n        await waitMS(2000);\n      }\n    }\n    return await this.db.save(res.data.doc, collection, false);\n  }\n\n  async saveSystemDoc(doc: any, project:ProjectItem, collection: string): Promise<any> {\n    const doc2 = {}\n    if(!doc.type) \n      throw new Error('Saving system doc requires doc to have type property');\n    if(doc.secondaryType)\n      doc2['secondaryType'] = doc.secondaryType;\n\n    const res = await post(getPostRequest(env.AUTH_API_URL +'/channels/addNewSystemDoc',\n                      {...{ token: authService.getToken(), \n                        doctype: doc.type,\n                        channelname: getChannelFromProjectId(project.id),\n                        doc: doc }, ...doc2}, {} ), false) ;\n    if(!res.success)\n      return res;\n\n    return await this.db.save(res.data.doc, collection, false);\n  }\n\n\n\n\n  public async remove(id: string, collection: string, remoteSync:boolean = true) {\n    try {\n      const doc = await this.getDoc(id, collection);\n      if(!doc) return false;\n      log.warn('Deleting doc: ',id);\n      log.warn(doc);\n      const res =  this.db.save({...doc, ...{deleted: true}}, collection);\n      log.info(res);\n      if (remoteSync)\n        this.addSyncCall$.next();\n      return res;\n    }\n    catch(e) {\n      log.error(e);\n      return null;\n    }\n  }\n\n  public async removeProject() {\n\n    /*\n    try {\n      //load all project children and remove them\n      //TODO, on server side, if notice project deleted, make sure all server children are also deleted\n      const res = await this._pouch.allDocs({\n        include_docs: true,\n        startkey: getProjectChildId(project._id),\n        endkey: getProjectChildId(project._id) + LASTCHAR\n      });\n      const docs = res.rows.map(row => Object.assign(\n        row.doc, { _deleted: true, updated: Date.now() }));\n\n      docs.push(Object.assign(project, { _deleted: true, updated: Date.now() }));\n      const res2 = await this._pouch.bulkDocs(docs);\n\n      if (syncRemote)\n        this.addSyncCall$.next();\n\n      return res2;\n    }\n    catch (e) {\n      console.log('Remove Project Error: ', e);\n    }\n    */ return false;\n  }\n\n\n\n  // streams\n\n  subscribeChanges(): Observable<any> {\n    return this.db.changes$.asObservable().pipe(\n      map((change:DataChangeEvent) => change.doc )\n    );\n  }\n  \n\n  subscribeDocChanges(id: string): Observable<any> {\n    return this.db.changes$.asObservable().pipe(\n      filter((change: DataChangeEvent) => change.doc.id === id),\n      map((change: DataChangeEvent) => change.doc)\n    );\n  }\n\n\n  subscribeByPropertyChange(\n    property: string,\n    value: any): Observable<any> {\n    return this.db.changes$.asObservable().pipe(\n      filter((change: DataChangeEvent) => { \n        return (change.doc[property] === value);\n      }),\n      map((change: DataChangeEvent) => change.doc)\n    ); \n  }\n\n  subscribeProjectTypeChanges(projectid: string|undefined, type: string): Observable<any> {\n    if(projectid === undefined) \n      throw new Error('Project id, can not be undefined, can not subscribe to id') ;\n    const projectChildId = getProjectChildId(projectid);\n    return this.db.changes$.asObservable().pipe(\n      filter((change: DataChangeEvent) => { \n        return change.doc.id.startsWith(projectChildId + DIV + type + DIV);\n      }),\n      map((change: DataChangeEvent) => change.doc)\n    ); \n  }\n\n  //project id and channel only difference is the suffic at end of proejctid\n  subscribeChannelTypeChanges(channel: string|undefined, type: string): Observable<any> {\n    if(channel === undefined) \n      throw new Error('Channel can not be undefined, can not subscribe to id') ;\n    return this.db.changes$.asObservable().pipe(\n      filter((change: DataChangeEvent) => { \n        return change.doc.id.startsWith(channel + DIV + type + DIV);\n      }),\n      map((change: DataChangeEvent) => change.doc)\n    ); \n  }\n\n\n  public get ready() {\n    return this._ready;\n  }\n\n  public getReadySub() {\n    return this._ready$;\n  }\n\n  public set ready(value: boolean) {\n    this._ready = value;\n    if(value)\n      this._ready$.next(value);\n  }\n\n\n  public async init(authid: string , syncRemote = true) {\n    log.info('Init DB')\n    const scheme = databaseScheme;\n    scheme.name = authid;\n    this.db = new DexieAdapter(scheme);\n    const dbSub = this.db.ready$.subscribe(ready => {\n      log.info('Dexie Sub: ', ready);\n      if(!ready) return;\n\n      this.ready = true;\n      if (syncRemote)\n        this.addSyncCall$.next();\n\n      dbSub.unsubscribe();\n      \n    });\n  }\n\n  private async _syncRemote() {\n    let ck = Number(await localStorageService.getItem('SYNC_CHECKPOINT'));\n    if(!ck) ck = 0; \n    \n    let docs: any[] = [];\n    for(let i = 0; i < databaseScheme.tables.length; i++) {\n      if(!databaseScheme.tables[i].sync){\n        continue;\n      }\n      const res = await this.db.queryByProperty('dirty', 'equals', 1, databaseScheme.tables[i].name);\n      docs.push(...res);\n    }\n    const res = await syncData({  data: docs, \n                                  syncurl: env.SYNC_SERVER,\n                                  token: authService.getToken(),\n                                  checkpoint: 0,\n                                  requestMaxSize: 1000});\n    //save checkpoint\n    if(res) {\n      const keys = Object.keys(res);\n      for(let i = 0; i < keys.length; i++){\n        await this.db.saveFromSync(\n          res[keys[i]].map(doc => Object.assign(doc, {dirty: 0})), \n          keys[i]);\n      }\n    }\n\n  }\n\n\n\n}\n\nexport const dataService = new DataService();\n","\n\nexport const TYPE_MSG = 'msg';\n\nexport interface Msg {\n  id:string,\n  to:string, \n  from:string, \n  type:string, \n  messageType: string,\n  message:string, \n  data: any\n  replied?: {accepted: boolean, date:number},\n  deleted?: boolean\n}","import { Doc } from \"../data/models\";\n\nexport const TYPE_SOCIAL = 'social';\n\n\n\nexport class Friend extends Doc {\n  username!: string;\n  id!: string;\n  secondaryType?: string;\n\n\n  constructor(values: Object = {}) {\n    super()\n    Object.assign(this, values);\n    if(!values['username']) throw new Error('Friend Doc username required')\n    if(!values['id']) throw new Error('Friend Doc id required')\n  }\n}\n\n\n","import { Todo } from \"../../pages/todo/models\";\nimport moment from 'moment';\nimport { env } from \"../../env\";\n\n\nexport const calculateLevelExperience = (level:number): number => {\n  let exp = 0;\n    for(let x = 1; x < level; x++){\n      exp += Math.floor((x+100) * Math.pow(2,(x/7)))\n    }\n  return Math.floor(exp/4);\n}\n\n\nexport const calculateDoneTodoGold = (todo:Todo): number => {\n  let days = 0;\n  //how many days past\n  if(todo.date)\n    days = moment(todo.date).diff(moment(),'hour');\n  const rew = env.TODO_DONE_GOLD_REWARDS + (env.HABIT_REWARDS_GOLD_PERCENTAGE_INCREASE * days);\n  return Math.floor(rew);\n}\n\nexport const calculateDoneTodoExperience = (todo:Todo): number => {\n  let days = 0;\n  //how many days past\n  if(todo.date)\n    days = moment(todo.date).diff(moment(),'hour');\n  const rew =env.TODO_DONE_EXPERIENCE_REWARDS + \n    (env.HABIT_REWARDS_EXPERIENCE_PERCENTAGE_INCREASE * days);\n  return Math.floor(rew);\n\n\n}\n\n\n","import { BehaviorSubject } from 'rxjs';\nimport { toast } from 'react-toastify';\nimport { Todo } from '../../pages/todo/models';\nimport { Habit } from '../../pages/habits/models';\nimport { dataService } from '../data/dataService';\nimport { calculateLevelExperience, calculateDoneTodoGold, calculateDoneTodoExperience } from './utilsGamify';\nimport { throttleTime } from '../../../node_modules/rxjs/operators';\nimport { isEqual } from 'lodash';\nimport { getInitGamifyRewards, GamifyRewards } from '../../pages/habits/utilsHabits';\nimport { generateCollectionId, genrateMetaData, TYPE_SETTINGS, getDefaultProject } from '../data/utilsData';\nimport { env } from '../../env';\nimport { authService } from '../auth/authService';\nimport ulog from 'ulog';\n\nconst log = ulog('gamify');\n\n\nexport interface GamifyState {\n  health:number,\n  maxHealth: number,\n  experience: number,\n  maxExperience: number,\n  level: number,\n  gold: number,\n\n  items: any[],\n}\n\nexport const getInitGamifyState = () => {\n  return {\n    health: 50,\n    maxHealth: 50,\n    experience: 0,\n    maxExperience: 20,\n    level: 1,\n    gold: 0,\n\n    items:[]\n  }\n}\n\nexport class GamifyService {\n\n  private _userId = '';\n  private _subscriptions:any[] = [];\n  private _state: GamifyState = getInitGamifyState();\n  \n  public state$ = new BehaviorSubject<GamifyState>(this._state);\n  \n\n  public async init(userid: string) {\n    this.unsubscribe();\n    this._userId = userid;\n    const dataSub = dataService.getReadySub().subscribe(async (ready) => {\n      if(!ready) return;\n      const doc = await this.loadInitDocs(userid);\n      const sub = this.state$.pipe(throttleTime(10000)).subscribe(()=>{\n        this._save();\n      })\n  \n      const sub2 = dataService.subscribeDocChanges(this.getGamifyDocId())\n        .subscribe(doc => {\n          const equal = isEqual(this._state, doc.state);\n          if(!equal)\n            this.state = doc.state;\n        });\n  \n      this._subscriptions.push(sub);\n      this._subscriptions.push(sub2);\n      //load the init stae\n      if(doc)\n        this.state = doc.state;\n\n      dataSub.unsubscribe();\n    })\n  }\n\n\n\n  private unsubscribe() {\n    this._subscriptions.forEach(s=>{\n      if(s)s.unsubscribe();\n    })\n  }\n\n  public calculateFinishedTodoRewards = (todo: Todo): Todo => {\n    if(!todo.doneRewards || !todo.doneRewards.gold){\n      todo.newRewards = getInitGamifyRewards({\n        gold: calculateDoneTodoGold(todo),\n        experience: calculateDoneTodoExperience(todo),\n        items: []\n      });\n    }\n\n    if(todo.done){\n      this.addGold(todo.newRewards.gold);\n      this.messageReceivedGold(todo.newRewards.gold);\n      this.addExperience(todo.newRewards.experience);\n      this.messageReceivedExperience(todo.newRewards.experience)\n    }\n    else {\n      this.addGold(todo.newRewards.gold * -1);\n      this.messageLostGold(todo.newRewards.gold);\n      this.addExperience(todo.newRewards.experience * -1);\n      this.messageLostExperience(todo.newRewards.experience);\n    }\n\n    return {...{}, ...todo};\n  }\n\n  public calculateNewTodo = (todo: Todo): Todo => {\n    todo.newRewards = getInitGamifyRewards({\n      gold: env.TODO_NEW_GOLD_REWARDS,\n      experience: env.TODO_NEW_EXPERIENCE_REWARDS,\n      items: [],\n    });\n\n    this.addGold(todo.newRewards.gold);\n    this.messageReceivedGold(todo.newRewards.gold)\n    this.addExperience(todo.newRewards.experience);\n    this.messageReceivedExperience(todo.newRewards.experience)\n\n    return {...{} ,...todo};\n  }\n\n  public calculateNewHabitRewards = (habit:Habit): Habit => {\n    habit.newRewards = getInitGamifyRewards({\n      gold: env.HABIT_REWARDS_NEW_GOLD,\n      experience: env.HABIT_REWARDS_NEW_EXPERIENCE,\n      items: [],\n    });\n\n    this.addGold(habit.newRewards.gold);\n    this.messageReceivedGold(habit.newRewards.gold)\n    this.addExperience(habit.newRewards.experience);\n    this.messageReceivedExperience(habit.newRewards.experience)\n\n    return {...{}, ...habit};\n  }\n\n  private addGold(value:number, save = true) {\n    this._state = {...this._state, ...{gold: this._state.gold + value}};\n    if(save)this.state = this._state;\n  }\n\n  private addExperience(value: number, save = true) {\n    let experience = this._state.experience + value;\n    \n    if(experience > this._state.maxExperience){\n      experience = (this._state.maxExperience - experience) * -1;\n      this._state = {...this._state, \n        ...{maxExperience: calculateLevelExperience(this._state.level+1),\n            level: this._state.level + 1}}\n    }\n    this._state = {...this._state, ...{experience}}\n    if(save) this.state = this._state;\n  }\n\n  public addRewards = (rewards:GamifyRewards) => {\n    if(rewards.gold > 0) {\n      this.messageReceivedGold(rewards.gold);\n      this.addGold(rewards.gold, false);\n    }\n    if(rewards.experience > 0){\n      this.messageReceivedExperience(rewards.experience);\n      this.addExperience(rewards.experience, false)\n    }\n\n    if(rewards.gold > 0 && rewards.experience > 0) {\n      this.state = this._state;\n    }\n  }\n\n  private messageReceivedGold(gold: number, preMessage?:string, postMessage?:string) {\n    if(!preMessage) preMessage = '';\n    if(!postMessage) postMessage = '';\n    toast.success(preMessage+' You have received ' + gold + ' gold '+postMessage,{autoClose: env.MESSAGE_DURATION});\n  }\n\n  private messageLostGold(gold:number, preMessage?:string, postMessage?:string) {\n    if(!preMessage) preMessage = '';\n    if(!postMessage) postMessage = '';\n    toast.error(preMessage+' You have lost ' + gold + ' gold'+postMessage, {autoClose: env.MESSAGE_DURATION});\n  }\n\n  private messageReceivedExperience(exp: number, preMessage?:string, postMessage?:string) {\n    if(!preMessage) preMessage = '';\n    if(!postMessage) postMessage = '';\n    toast.success(preMessage+' You have received ' + exp + ' experience'+postMessage,{autoClose: env.MESSAGE_DURATION});\n  }\n\n  private messageLostExperience(exp:number, preMessage?:string, postMessage?:string) {\n    if(!preMessage) preMessage = '';\n    if(!postMessage) postMessage = '';\n    toast.error(preMessage+' You have lost ' + exp + ' experience'+postMessage, {autoClose: env.MESSAGE_DURATION});\n  }\n  \n  private async _save() {\n    try{\n      const doc = await dataService.getDoc(this.getGamifyDocId(), TYPE_SETTINGS);\n\n      if(!doc){\n        return;\n      }\n\n      const equal = isEqual(this._state, doc.state);\n      //make sure we are not saving the init state\n      const initEqual = isEqual(this.state, getInitGamifyState());\n      if(!equal && !initEqual && doc.userid ===  this._userId) {\n        dataService.save({...doc, ...{state: this._state}}, TYPE_SETTINGS);\n      }\n    }\n    catch(e) {\n      log.error(e);\n    }\n    \n  }\n\n  private getGamifyDocId(): string {\n    const defaultProject = getDefaultProject(authService.userid);\n    const id =  generateCollectionId(defaultProject.id, 'gamify', '');\n    return id.substring(0, id.length-1);\n  }\n\n  private async loadInitDocs(id: string): Promise<any> {\n    try {\n      const s = await dataService.getDoc(this.getGamifyDocId(), TYPE_SETTINGS);\n      if(s) return s;\n      const ts = Date.now();   \n      if(id === this._userId){  //half second pased, see if state changed\n        const res = await dataService.save({\n          id: this.getGamifyDocId(),\n          state: getInitGamifyState(),\n          type: TYPE_SETTINGS,\n          [env.ACCESS_META_KEY]: genrateMetaData(id),\n          userid: id,\n          created: ts,\n          updated: ts\n        }, TYPE_SETTINGS)\n      return res;\n      }\n    }\n    catch(e) {\n      log.error(e.red, id);\n    }    \n  }\n\n  public get state(): GamifyState {\n    return this._state;\n  }\n  public set state(value: GamifyState) {\n    this._state = value;\n    this.state$.next(value);\n  }\n\n}\nexport const gamifyService = new GamifyService();\n\n\n","\nimport { Todo, TYPE_TODO, TodoList, TYPE_TODO_LIST, TodoTag, getDefaultTodoList, getDefaultTodoTag, TYPE_TODO_TAG } from './models';\nimport { BehaviorSubject, Subscription } from 'rxjs';\nimport { dataService } from '../../modules/data/dataService';\nimport { waitMS, getProjectChildId } from '../../modules/data/utilsData';\nimport _ from 'lodash';\nimport { gamifyService } from '../../modules/gamify/gamifyService';\nimport ulog from 'ulog';\nimport { toastService } from '../../modules/toast/toastService';\n\n\nconst log = ulog('todo');\n\n\nexport interface TodoState {\n  selectedTodo: Todo|null,\n  list: TodoList|undefined,\n  tag: TodoTag|undefined,\n  docs: Todo[],\n  tagDocs: TodoTag[],\n  doneTodos: boolean,\n  orderFilter: string,\n  orderAsync: number,\n  showNewTagFilter: boolean,\n}\n\nexport const getInitTodoState = (): TodoState => {\n  return {\n    selectedTodo:null,\n    list: undefined,\n    tag: undefined,\n    docs: [],\n    tagDocs: [],\n    doneTodos: false,\n    orderFilter: 'created',\n    orderAsync: 1,\n    showNewTagFilter: false,\n  }\n}\n\nexport class TodoService {\n  \n  // @ts-ignore: it will be initialized in init\n  private _projectid: string;\n  private _state: TodoState = getInitTodoState();\n  public state$ = new BehaviorSubject(this._state);\n  private _subscription: Array<Subscription> = [];\n\n  public init(projectid: string, list:string|undefined, tag:string|undefined) {\n    log.warn(projectid, list, tag);\n    //first unsubscribe\n    this.unsubscribe();\n    const dataSub = dataService.getReadySub().subscribe( async (ready) => {\n      if(!ready) return;\n      \n      this._init(projectid, list, tag);\n\n      await waitMS(1000);\n      dataSub.unsubscribe();\n    });\n  }\n\n  async _init(projectid: string, listName: string|undefined, tagName: string|undefined) {\n\n    if(this._projectid  === projectid && \n        this._state.list?.fullname === listName && \n        this._state.tag?.name === tagName) return;\n\n    let list, tag\n    if(!listName && !tagName){\n      list = getDefaultTodoList('default', projectid)     \n    }\n    if(listName)\n      list = getDefaultTodoList(listName, projectid)    \n    if(tagName)\n      tag = getDefaultTodoTag(tagName, projectid);\n\n    this._state = {...this.state, ...{\n      tag, \n      list,\n      tagDocs: this.getTags()}};\n    \n      log.warn(this._state);\n    \n    this._projectid = projectid;\n    \n    log.info(this.state);\n\n    this.reloadTodos();\n\n    const sub = dataService.subscribeProjectTypeChanges(projectid,TYPE_TODO)\n      .subscribe((doc: Todo) => {\n        log.log(\"TodoService subscription: \", doc); \n        this.reloadTodos();\n      });\n    this._subscription.push(sub);\n\n  }\n\n  async reloadTodos() {\n    log.info('RELOADING TODOS::: ', this.state)\n      let docs;\n    if(this.state.list){\n        log.info('Todo Query by List')\n        docs = await dataService.queryByProperty(\n          'list', 'equals', this.state.list.fullname, TYPE_TODO);\n    }\n     else if(this.state.tag){\n        log.info('Todo Query by Tags')\n        docs = await dataService.queryByProperty(\n          'tags', 'equals', this.state.tag.name, TYPE_TODO);\n    }\n\n    this.filterAndSaveTodos(docs);\n   \n  }\n\n  public async getTagsByStartingName(value){\n    return await dataService.queryByProperty(\n      'name', 'startsWith', value, TYPE_TODO_TAG); \n  }\n\n  private filterAndSaveTodos(docs: Todo[]):Todo[] {\n    const filtered = docs.filter(doc => this.filterDoneParentFunction(doc))\n                        .sort((a,b) => this.orderFunction(a,b));\n    this.state = {...this.state, ...{docs: filtered}};\n    return filtered;\n  }\n\n  private orderFunction(a:Todo, b:Todo) {\n    return (a[this._state.orderFilter] > b[this._state.orderFilter])?\n     (1 * this._state.orderAsync) : (-1 * this._state.orderAsync)\n  }\n\n\n  private filterDoneParentFunction(doc:Todo) {\n      if (doc.done !== this._state.doneTodos) return false;\n      return true;\n  }\n\n\n \n  public get state(): TodoState {\n    return this._state;\n  }\n  public set state(value: TodoState) {\n    this._state = value;\n    this.state$.next(this._state);\n  }\n\n  public async addSubTodoToParent (todoId: string, parentId: string) {\n    try {\n      const parentTodo: Todo = await dataService.getDoc(parentId, TYPE_TODO);\n      if (parentTodo) {\n        if(!parentTodo.subTodos) parentTodo.subTodos = [];\n        parentTodo.subTodos = _.concat(parentTodo.subTodos, todoId);\n        this.save(parentTodo);\n      }\n    }\n    catch(e) {\n      log.error(e);\n    }\n  }\n\n  public async removeSubTodoFromParent (todoId: string, parentId) {\n    try {\n      const parentTodo: Todo = await dataService.getDoc(parentId, TYPE_TODO);\n      if (parentTodo) {\n        if(!parentTodo.subTodos) parentTodo.subTodos = [];\n        parentTodo.subTodos = _.filter(parentTodo.subTodos, t=>t!== todoId);\n        this.save(parentTodo);\n      }\n    }\n    catch(e) {\n      log.error(e);\n    }\n  }\n\n\n  public async save(doc:Todo, parentId: string|null = null) {\n    log.info(\"Save: \", doc, this._projectid, TYPE_TODO);\n    //see if its new\n    if(doc._new) {\n      delete(doc._new);\n      \n      if(this.state.list)\n        doc.list = this.state.list.fullname;\n      else\n        doc.list = getProjectChildId(this._projectid)+'default'\n      if(!doc.tags){\n        doc.tags = [];\n      }\n      await this.saveNewTags(doc.tags);\n      doc = gamifyService.calculateNewTodo(doc);\n    }\n    const res = await dataService.save({...{done: false}, ...doc}, TYPE_TODO, {projectid: this._projectid});\n    if(parentId && doc.id) {\n      this.addSubTodoToParent(doc.id, parentId)\n    }\n    return res;\n\n  }\n\n  public async saveNewTags(tags:string[]) {\n    console.log('Tags::: ', tags);\n    let tagDoc;\n    for(let i = 0; i < tags.length; i++) {\n      console.log(tags[i]);\n      tagDoc = await dataService.queryByProperty('name', 'equals', tags[i], TYPE_TODO_TAG);\n      console.log(tagDoc);\n      if(tagDoc.length === 0) {\n        //save new tag\n        await dataService.save(new TodoTag({\n          name: tags[i], \n        }), TYPE_TODO_TAG, {projectid: this._projectid, remoteSync:true });\n      }\n    }\n  }\n\n  public async saveList(doc:TodoList) {\n    log.info('Save New TodoList: ', doc);\n    if(doc._new) {\n      //make sure its not a duplicate\n      const res = await dataService.getDoc(doc.id, TYPE_TODO_LIST);\n      if(res){\n        //error, its a duplicate\n        toastService.printSimpleError('List Already Exists');\n        return;\n      }\n      delete doc._new;;\n      const saveRes = await dataService.save(doc, TYPE_TODO_LIST);\n      log.info(saveRes);\n      return saveRes;\n    }\n  }\n\n  public async deleteList(list:TodoList) {\n    //get all docs that are in this list\n    log.warn(list);\n    const docs = await dataService.queryByProperty('list', 'equals', list.fullname,TYPE_TODO);\n    log.warn(docs);\n    //delete all items\n    for(let i = 0; i < docs.length; i ++){\n      dataService.remove(docs[i].id, TYPE_TODO);\n    }\n    if(list.id)\n      dataService.remove(list.id, TYPE_TODO_LIST);\n  }\n\n  public async remove(id: string) {\n    //see if this doc has parent\n    try {\n      const todo: Todo = await dataService.getDoc(id, TYPE_TODO);\n      if (todo) {\n        if(todo.parent) {\n          this.removeSubTodoFromParent(id, todo.parent);\n        }\n      }\n    }\n    catch(e) {\n      log.error(e);\n    }\n    dataService.remove(id, TYPE_TODO);\n  }\n\n  public select(doc:Todo | null) {\n    this.state = {...this._state, ...{ selectedTodo: doc} };\n  }\n\n  public changeDoneFilter(done: boolean) {\n    if(done === this._state.doneTodos) return;\n    this._state = {...this._state, ...{ doneTodos: done} };\n    this.reloadTodos();\n  }\n\n  public showNewTagFilter(show) {\n    this.state = {...this.state, ...{showNewTagFilter: show}};\n  }\n\n  public changeOrderFilter(filter: string) {\n    if(this._state.orderFilter === filter){\n      this._state = {...this._state, ...{ orderFilter: filter, \n        orderAsync: (this._state.orderAsync === 1)? -1:1} };\n    }\n    else {\n      this._state = {...this._state, ...{ orderFilter: filter} };\n    }\n    this.reloadTodos();\n  }\n\n  public getTags():TodoTag[] {\n    const tags =  [\n      new TodoTag({\n        id: undefined,\n        icon: 'sun.svg',\n        name: 'today',\n        fullname: 'today',\n      }),\n      new TodoTag({\n        id: undefined,\n        icon: 'star.svg',\n        name: 'important',\n        fullname: 'important',\n      })\n      //getDefaultTodoTag('today', projectid, 'sun.svg'), \n      //getDefaultTodoTag('important', projectid, 'star.svg')];\n    ]\n    return tags;\n  }\n\n\n  public selectList(list:TodoList) {\n    if(list === this._state.list) return;\n    this._state = {...this._state, ...{ list } };\n    this.reloadTodos();\n  }\n\n  public unsubscribe() {\n    if(!this) return;\n    this._subscription.forEach(sub => {\n      if(sub)\n        sub.unsubscribe();\n    });\n  }\n\n}\n\n\n\nexport  const todoService = new TodoService(); ","import React, { useRef, useReducer, useEffect } from 'react';\nimport { Todo, TYPE_TODO, TodoList, getDefaultTodoList, TodoTag } from './models';\nimport {IonInput, IonButton, IonIcon} from '@ionic/react';\nimport { generateCollectionId } from '../../modules/data/utilsData';\nimport ulog from 'ulog'\nimport { waitMS } from '../../components/animatedIcon';\nimport { todoService } from './todo.service';\nimport { Subject } from 'rxjs';\nimport { debounceTime, distinctUntilChanged, switchMap, filter } from 'rxjs/operators';\nimport { COLOR_SECONDARY } from '../../colors';\nimport './todo.component.css';\n\nconst log = ulog('todo');\n\n\n\nconst TodoNewComp = ({list, tag, focus, closeFunc, saveFunc, projectId}:\n  {list:TodoList|undefined, focus: boolean, \n    tag:string|undefined, closeFunc:Function,\n    projectId: string, saveFunc: Function}) => {\n\n  const reducer = (state, {type, payload}) => {\n      switch(type) {\n        case 'setTitle': \n          //see if we have a tag\n          if(payload[payload.length -1] === '#'){\n            return {...state, ...{title:payload, showTags: true}};\n          }\n          if(payload[payload.length -1] === ' ' && state.showTags === true){\n            return {...state, ...{title:payload, showTags: false}};\n          }\n          return {...state, ...{title:payload}};\n        case 'setFocus':\n          return {...state, ...{focus:payload}};\n        case 'setCloseFocus':\n          console.log('setCloseFocus, ', payload);\n          return {...state, ...{closeFocus:payload}};\n        case 'setState':\n          return payload;\n        case 'setTags':\n          return {...state, ...{tags: payload}};\n        default:\n          log.console.error('Incorrect action, ', type, payload);\n          return state;\n          \n      }\n  }\n    \n  \n  \n  \n    const [state, _dispatch] = useReducer(reducer, {title:'', \n                                                  focus, \n                                                  tags: [],\n                                                  showTags:false,\n                                                  closeFocus: false})\n  const inputEl = useRef(null);\n  const searchTags$ = new Subject<string>();\n\n  useEffect(() => {\n    dispatch('setFocus', focus);\n    if(focus){\n      setDelayedFocusOnInput();\n    }\n  }, [focus])\n\n  const setDelayedFocusOnInput = async () => {\n    await waitMS(200);\n    if(inputEl.current){\n      console.log('Setting focus to input')\n      // @ts-ignore: current is pointing to input\n      inputEl.current.setFocus();\n    }\n  }\n\n\n  const dispatch = (type: 'setTitle'|\n                          'setFocus'|\n                          'setTags'|\n                          'setState'|\n                          'setCloseFocus', payload:any = {}) => {\n    _dispatch({type, payload});\n  }\n\n  //TODOS: testing....\n  const setNewTitle = (e) => {\n    dispatch('setTitle', e.detail.value);\n    if(state.showTags) {\n      const index = e.detail.value.lastIndexOf('#');\n      searchTags$.next(e.detail.value.substring(index));\n       \n    }\n  }\n\n\n  const searchTags = async (value) => {\n    console.log('tags searching, ', value);\n    return await todoService.getTagsByStartingName(value);\n    //use todo service to load tags here\n  }\n\n  searchTags$.pipe(\n    debounceTime(300),\n    distinctUntilChanged(),\n    filter(value => value.length > 2),\n    switchMap(term => searchTags(term.substring(1)))\n  ).subscribe(res => {\n    console.log('SEARCH TAGS:::::: ', res);\n    dispatch('setTags', res);\n  });\n\n\n\n  const onKeyPress = (e) => {\n    if(e.key === 'Enter'){\n      save();\n      dispatch('setTitle', '');\n    }\n  }\n\n  const save = async () => {\n    let fullname;\n    if(!list){\n      fullname = getDefaultTodoList('tasks', projectId).fullname;\n    }\n    else {\n      fullname = list.fullname;\n    }\n\n     //do we have tags in the title\n     const regex = /\\#\\w+\\b/\n     let tag2 = state.title.match(regex);\n     let name = state.title;\n     let otherTags = {};\n     while(tag2) {\n       console.log(tag2);\n       otherTags[tag2[0].substring(1)] = '';\n       name = name.substring(0, tag2.index) + name.substring(tag2.index+tag2[0].length).trim();\n       console.log(name);\n       tag2 = name.match(regex);\n     }\n\n     if(tag){\n      otherTags[tag] = ''\n    }\n    \n    const id = generateCollectionId(projectId, TYPE_TODO)\n    const newDoc = new Todo({\n      id, \n      name: name, \n      list: fullname,\n      tags: Object.keys(otherTags),\n      _new: true});\n\n     await saveFunc(newDoc);\n  };\n\n\n\n  const onInputFocus = async(e) => {\n    await waitMS(510);\n    console.log('Focus', e);\n    dispatch('setFocus', true);\n  }\n\n  const onInputBlur = (e) => {\n    closeToolbar();\n    dispatch('setCloseFocus', true);\n    console.log('Blur ', state,  e);\n  }\n\n  const onSubAction = (type:string, payload:any = {}) => {\n    switch(type) {\n      case 'tag':\n        dispatch('setState', {...state, ...{title: state.title+' #',  closeFocus: false}})\n        break;\n      case 'tagString':\n        console.log(payload);\n        const index = state.title.lastIndexOf('#');\n        dispatch('setState', {...state, ...{\n            title: state.title.substring(0, index+1) + payload + ' ',  \n            closeFocus: false}})\n        break;\n      case 'addTag':\n        dispatch('setState', {...state, ...{\n          title: state.title.trim() + ' ' + payload + ' ',  \n          closeFocus: false}})\n        break;\n      \n    }\n    \n    dispatch('setCloseFocus', false);\n    console.log('Action: ', type, inputEl)\n    if(inputEl){\n      console.log('Setting focus to input')\n      // @ts-ignore: current is pointing to input\n      inputEl.current.setFocus();\n    }\n      \n  }\n\n  const closeToolbar = async () => {\n    //wait 1 sec, if nothing is presssed, then \n    await waitMS(500)\n    console.log('CloseToolbar Focus: ', state);\n    if(state.closeFocus)\n      closeFunc()\n    \n     \n  }\n\n\n  const printSmallTagFromName = (tag:TodoTag) => {\n    if(tag.icon) {\n      return <IonIcon  \n                key={tag.name}\n                size=\"small\" \n                color='success' \n                src={\"/assets/icons/\"+tag.icon} />\n    }\n\n    return <IonIcon  \n                key={tag.name}\n                size=\"small\" \n                color='success' \n                src={\"/assets/icons/tag.svg\"} >\n          {tag.name}  \n          </IonIcon>\n  }\n\n\n  return (\n    <>\n    {state.showTags? (\n      <div>\n        {state.tags.map((tag:TodoTag) => (\n          <IonButton \n            fill=\"clear\"\n            color={COLOR_SECONDARY}\n            onClick={() => onSubAction('tagString', tag.name)}\n            key={tag.name} >\n            {printSmallTagFromName(tag)}\n            {tag.name}\n          </IonButton>\n\n        ))}\n      </div>\n    ) : (<></>)}\n    {state.focus? (\n      <div>\n        <IonButton class=\"newTodoCloseButton\" onClick={() => closeToolbar()} fill=\"clear\" >Close</IonButton>\n        <IonButton onClick={() => onSubAction('tag')} fill=\"clear\" >Tag #</IonButton>\n        <IonButton onClick={() => onSubAction('addTag', '#today')} fill=\"clear\" >\n              <IonIcon  \n                  key={'today'}\n                  size=\"small\" \n                  color='success' \n                  src={\"/assets/icons/sun.svg\"} />\n\n        </IonButton>\n        <IonButton onClick={() => onSubAction('addTag', '#important')} fill=\"clear\" >\n              <IonIcon  \n                  key={'important'}\n                  size=\"small\" \n                  color='success' \n                  src={\"/assets/icons/star.svg\"} />\n\n        </IonButton>\n        <IonInput\n            autofocus={true}\n            ref={inputEl}\n            className=\"new-todo\"\n            placeholder=\"What needs to be done?\"\n            onKeyPress={onKeyPress}\n            onIonChange={setNewTitle}\n            value={state.title}\n            onIonBlur={onInputBlur}\n            onIonFocus={onInputFocus}/>\n      </div>\n    ) : (<></>)}\n    \n    </>\n  )\n\n\n}\n\nexport default TodoNewComp;","export const COLOR_PRIMARY = 'primary';\nexport const COLOR_SECONDARY = 'secondary';\nexport const COLOR_TERTIARY = 'tertiary';\nexport const COLOR_SUCCESS = 'success';\nexport const COLOR_WARNING = 'warning';\nexport const COLOR_DANGER = 'danger';\nexport const COLOR_LIGHT = 'light';\nexport const COLOR_MEDIUM = 'medium';\nexport const COLOR_DARK = 'dark';","import React, { useState, useEffect } from 'react';\nimport { Todo, TodoTag } from './models';\nimport { DataFunctions } from './hooks/todos.hook';\nimport _ from 'lodash';\nimport ulog from 'ulog';\nimport { IonLabel, IonTextarea, IonButton, IonIcon, IonAlert } from '@ionic/react';\nimport './todo.edit.component.css';\nimport { trash, close } from '../../../node_modules/ionicons/icons';\n\n\nconst log = ulog('todo');\n\nconst getDefaultState = (todo:Todo, tagDocs:TodoTag[]) =>  {\n  return {\n  todo: todo,\n  tagDocs,\n  showDeleteWarrning: false,\n  text: mergeText(todo.name, todo.note)\n}}\n\nconst mergeText = (name: string|undefined, note: string|undefined): string => {\n  if(!name) name= '';\n  if(!note) \n    note = '';\n  else\n    note = '\\n'+note;\n  return name + note;\n}\n\n\n\nconst TodoEditInlineComponent = ({todo, tagDocs, dataFunctions}: \n        {todo:Todo,  tagDocs:TodoTag[], dataFunctions: DataFunctions}) => {\n  log.warn(\"Edit Todo Render::: \", todo, tagDocs, tagDocs);\n\n  const [state, setState] = useState(getDefaultState(todo, tagDocs));\n\n  useEffect(() => {\n    setState(getDefaultState(todo, tagDocs));\n  }, [todo, tagDocs])\n\n  const handleTitleChange = (e) => {\n    const text = e.detail.value;\n    var match = /\\r|\\n/.exec(text);\n    if(match){\n      const name = text.substring(0, match.index);\n      const note = text.substring(match.index+1);\n      const newDoc = {...state.todo, ...{name: name, note: note}}\n      const newState = {...state, ...{todo: newDoc, text: text}};\n      setState(newState);\n    }\n    else {\n      const newDoc = {...state.todo, ...{name: text, note: ''}}\n      const newState = {...state, ...{todo: newDoc, text: text}};\n      setState(newState);\n    }\n  }\n\n  const handleBlur = () => {\n    dataFunctions.save(state.todo);\n  }\n\n  const showRemoveWarrning = () => {\n    setState({...state, ...{showDeleteWarrning: true}});\n  }\n\n\n  const hideRemoveWarrning = () => {\n    setState({...state, ...{showDeleteWarrning: false}});\n  }\n\n  const remove = () => {\n    hideRemoveWarrning();\n    if(state.todo.id)\n      dataFunctions.remove(state.todo.id);\n  }\n\n  const printTag = (tag: TodoTag) => {\n    let color;\n    if(_.includes(state.todo.tags,tag.name)){\n      color = 'success';\n    }\n    else {\n      color = 'light';\n    }\n    return  <IonButton \n                fill=\"clear\"\n                size=\"default\" \n                color={color} \n                key={tag.name + 'editicon'}  \n                onClick={() => handleTagChange(tag)}>\n              <IonIcon  src={\"/assets/icons/\"+tag.icon} /></IonButton>\n  }\n\n\n  const handleTagChange = (tag: TodoTag) => {\n    log.error(tag, tagDocs);\n    if(!state.todo.tags) state.todo.tags = [];\n    const res = state.todo.tags.find(t=>t===tag.name);\n    let newtags;\n    if(res === undefined){\n      newtags = _.concat(state.todo.tags, tag.name);\n    }\n    else {\n      newtags = _.filter(state.todo.tags, t=>t!==tag.name);\n    }\n    dataFunctions.save(Object.assign(state.todo, {tags: newtags}));\n  }\n\n\n  return (\n\n    <div className=\"\">\n        \n        \n        <div key=\"todoEditInlineIconScrollParent\" className=\"todoEditInlineIconScrollParent\">\n          { tagDocs.map(tag => printTag(tag)) }\n        </div>\n        <IonTextarea \n            placeholder=\"Enter todo title and note here\"\n            name=\"note\"\n            class=\"todoEditInlineTextArea\"\n            autoGrow={true}\n            onIonBlur={handleBlur}\n            onIonChange={handleTitleChange}\n            value={state.text}></IonTextarea>\n        \n        \n        <div>\n          <div className=\"todoButtonsLeftAlign\">\n              <IonButton size=\"small\"  fill=\"clear\" color=\"secondary\" onClick={()=>{dataFunctions.select(null)}}>\n                  <IonIcon  icon={close} /><IonLabel>Close</IonLabel>\n              </IonButton>\n          </div>\n          <div className=\"todoButtonsRightAlign\">\n              <IonButton size=\"small\"  fill=\"clear\" color=\"danger\" onClick={showRemoveWarrning}>\n                  <IonIcon  icon={trash} /><IonLabel>Delete</IonLabel>\n              </IonButton>\n          </div>\n        </div>\n        <div className=\"todoInlineEditPadding\"> </div>   \n\n        <IonAlert\n            isOpen={state.showDeleteWarrning}\n            onDidDismiss={() => hideRemoveWarrning}\n            header={'Warrning!!!'}\n            message={'Are you sure you want to <strong>delete</strong> this task and its sub-tasks?'}\n            buttons={[\n              {\n                text: 'Cancel',\n                role: 'cancel',\n                cssClass: 'secondary',\n                \n              },\n              {\n                text: 'Yes Im Sure',\n                handler: () => remove()\n              }\n            ]}\n          />\n    </div>\n\n  );\n\n}\n\nexport default TodoEditInlineComponent;","import React, { useEffect, useReducer } from 'react';\nimport { IonLabel, IonRow, IonCol, \n        IonIcon, IonGrid, IonItem, IonText, IonAvatar } from '@ionic/react';\nimport { Todo, TodoTag } from './models';\nimport _ from 'lodash';\nimport './todo.component.css'\nimport { DataFunctions } from './hooks/todos.hook';\nimport TodoEditInlineComponent from './todo.edit.inline.component';\nimport { gamifyService } from '../../modules/gamify/gamifyService';\nimport ulog from 'ulog'\nimport check from '../../icons/check.json';\nimport restart from '../../icons/restart.json'\nimport AnimatedIcon from '../../components/animatedIcon';\nimport { COLOR_SUCCESS } from '../../colors';\n\nconst log = ulog('todo');\n\nexport interface TodoState {\n  todo: Todo,\n}\n\n\nconst reducer = (state, {type, payload}): TodoState => {\n  switch(type) {\n    case 'updateTodo':\n      return {...state, ...{todo:payload}};\n    \n    default:\n      return state;\n  }\n}\n\n\n//Component Start\nconst TodoListItemComp = ({todo, tagDocs, selectedTodo, dataFunctions}:\n  {todo:Todo, tagDocs:TodoTag[], lastChild: boolean,  selectedTodo: Todo|null,  dataFunctions: DataFunctions}) => {\n  \n\n  const [state, _dispatch] = useReducer(reducer, \n    {todo: todo, })\n\n  useEffect(() => {\n    dispatch('updateTodo', todo);\n  }, [todo])\n  \n  const dispatch = (type:'updateTodo'|\n                          'any', \n                    payload:any = {}) => {\n    _dispatch({type, payload});\n  }\n  \n  const doneHandler = () => {\n    const newDoc = gamifyService.calculateFinishedTodoRewards(\n        {...state.todo, ...{done: !state.todo.done}});\n    dispatch('updateTodo', newDoc);\n    dataFunctions.save(newDoc);\n  }\n\n  const handleSelectTodo = () => {\n    if(selectedTodo && state.todo.id === selectedTodo.id){\n      dataFunctions.select(null);\n    }\n    else {\n      dataFunctions.select(state.todo);\n    }\n  }\n\n  \n\n  const printSmallTagFromName = (name:string) => {\n    //log.warn(tagDocs);\n    const tag = tagDocs.find(t => t.name === name);\n    if(tag && tag.icon) {\n      return <IonIcon  \n                class=\"todoListItemTagIcon\"\n                key={tag.name}\n                size=\"small\" \n                color='success' \n                src={\"/assets/icons/\"+tag.icon} />\n    }\n\n    return <IonText \n              key={name}\n              class=\"todoListItemTag\"\n              color={COLOR_SUCCESS} >\n              <IonIcon  \n                color='success' \n                src={\"/assets/icons/tag.svg\"} />\n          {name}  \n          </IonText>\n  }\n\n  const printTask = () => (\n    <>\n      <IonItem  button \n            color={((selectedTodo && selectedTodo.id === state.todo.id)? 'light' : '')}   \n            lines=\"full\">\n        \n            <IonAvatar onClick={() => {}} slot=\"start\">\n              {state.todo.done? (\n                <AnimatedIcon  iconsvg={restart} actionFunc={doneHandler} />\n              ) : (\n                <AnimatedIcon  iconsvg={check} actionFunc={doneHandler} />\n              )}\n              \n            </IonAvatar>\n              <IonLabel onClick={handleSelectTodo}>\n              <IonText color=\"primary\">\n                  <h2>{state.todo.name}</h2>\n              </IonText>\n              {state.todo.note? (\n                <IonText color=\"secondary\">\n                  <p>{state.todo.note}</p>\n                </IonText> \n              ) : (<></>)}\n               \n              </IonLabel>\n              {state.todo.tags.sort().map(\n                tag=>printSmallTagFromName(tag)\n              )}\n        </IonItem>\n        {printEdit()}\n    </>\n  )\n\n\n  const printEdit = () => {\n    if(!selectedTodo || selectedTodo.id !== state.todo.id) return;\n    return (\n      <IonGrid>\n        <IonRow>\n            <IonCol class=\"todoTitleColumn\" onClick={() => {}}  >\n              <TodoEditInlineComponent \n                          todo={state.todo}\n                          tagDocs={tagDocs}\n                          dataFunctions={dataFunctions} />\n                        \n            </IonCol>\n        </IonRow>\n      </IonGrid>\n    )\n  }\n  \n\n  return printTask();\n};\n\nexport default TodoListItemComp;\n","import { useEffect, useState, useRef } from 'react';\nimport { Subscription } from 'rxjs';\nimport { Todo, TodoList } from '../models';\nimport { TodoService, TodoState, getInitTodoState } from '../todo.service';\nimport ulog from 'ulog';\n\nconst log = ulog('todo');\n\nexport interface DataFunctions {\n  save: {(doc: Todo, parentId?: string|null):Promise<any>},\n  remove: {(id: string)},\n  select: {(doc: Todo | null)},\n  selectList: {(list: TodoList)},\n  changeDoneFilter: {(done:boolean)}\n  changeOrderFilter: {(type: string)},\n  showNewTag: {(show:boolean)}\n}\n\n\n//more simpler then auth hook, just read data\nexport function useTodosCollectionFacade(\n  projectid: string| undefined, list:string|undefined, tag:string|undefined): \n  [TodoState, DataFunctions]{\n  \n  log.warn(projectid, list, tag);\n                           \n  if(!projectid) throw new Error('Projectid can not be undefined');\n  const [state, setState] = useState(getInitTodoState());\n  const todoService = useRef(new TodoService());\n          \n  const dataFunctions = {\n    save: (doc: Todo, parentId?: string|null):Promise<any> => todoService.current.save(doc, parentId),\n    remove: (id) => todoService.current.remove(id), //TODO: allow user to choose, sync or not to sync\n    select: (doc: Todo | null) => todoService.current.select(doc),\n    selectList: (list: TodoList) => todoService.current.selectList(list),\n    changeDoneFilter: (done:boolean) => todoService.current.changeDoneFilter(done),\n    changeOrderFilter: (filter:string) => todoService.current.changeOrderFilter(filter),\n    showNewTag: (show:boolean) => todoService.current.showNewTagFilter(show),\n  }\n\n  useEffect(() => {\n    todoService.current.init(projectid, list, tag)\n    return todoService.current.unsubscribe;\n  }, [projectid, list, tag])\n\n  useEffect(() => {\n    const subscriptions: Subscription[] = [\n      todoService.current.state$.subscribe(state => {\n        setState(state);\n      })\n    ];\n    return () => { subscriptions.map(it => it.unsubscribe()) };\n  },[projectid]);\n\n\n  return [state, dataFunctions];\n}","import { useEffect, useState } from 'react';\nimport { Subscription } from 'rxjs';\nimport { dataService } from '../../data/dataService';\nimport { GUEST, authService } from '../../auth/authService';\nimport { gamifyService } from '../../gamify/gamifyService';\nimport { partyService } from '../../parties/party.service';\nimport ulog from 'ulog';\n\nconst log = ulog('app');\n\nexport enum AppStatus {\n  loading, auth, guest\n}\n\n// username, authenticated, login, logout, renewToken\nexport function useAppStatus(): [{status:AppStatus, dataReady:boolean, username:string}] {\n\n  const [appStatus, setAppStatus] = useState({status: AppStatus.loading, dataReady: false, username: GUEST});\n\n\n  log.info('APP Router Status: ', appStatus);\n\n  useEffect(() => {\n    log.info('App Stats Effect::');\n    const subscriptions: Subscription[] = [\n      dataService.getReadySub().subscribe(ready => {\n        if(ready === appStatus.dataReady) return;\n          setStatusFunction();\n      }),\n      authService.username$.subscribe(async (username) => {\n        //renew token\n        if(authService.getIsAuthenticated()){\n          authService.renewToken();\n        }\n        setStatusFunction();\n        const userid = authService.getUser().id;\n        await dataService.init( userid, username !== GUEST);\n        await gamifyService.init(userid);\n        await partyService.init();\n        dataService.addSyncCall$.next();\n      }),\n\n    ];\n    // usersService.loadAll();\n    return () => { subscriptions.map(it => it.unsubscribe()) };\n  },[]);\n\n\n  const setStatusFunction = () => {\n    const dataReady = dataService.ready;\n    const username = authService.getUsername();\n    if(dataReady === appStatus.dataReady && username === appStatus.username)\n      return;\n    log.info('STATUS:', dataReady, username, appStatus);\n    \n    if(dataReady){\n      if(username === GUEST)\n        setAppStatus({ status:AppStatus.guest, username: username, dataReady: dataReady });\n      else\n        setAppStatus({ status:AppStatus.auth, username: username, dataReady: dataReady });\n    }\n    else {\n      setAppStatus({ status:AppStatus.loading, username: username, dataReady: dataReady });\n    }\n  };\n\n  return [ appStatus ];\n}","import React, { useState, useEffect } from 'react';\nimport { IonHeader, IonIcon, IonBadge } from '@ionic/react';\nimport { Line } from 'rc-progress';\nimport { gamifyService, getInitGamifyState, GamifyState } from '../modules/gamify/gamifyService';\n\n\n\nimport './header.css';\nimport 'rc-progress/assets/index.css';\nimport { heart, star, leaf, logoUsd } from 'ionicons/icons';\n\nconst HeaderWithProgress = ({title}:{title:string}) => {\n\n  const [state, setState] = useState<GamifyState>(getInitGamifyState())\n\n  const {health, maxHealth, experience, maxExperience, level, gold} = state;\n\n  useEffect(() => {\n    const sub = gamifyService.state$.subscribe(s => {\n      setState({...state, ...s});\n    })\n    return () => {\n      sub.unsubscribe();\n    };\n  }, [])\n\n\n  return (\n    <IonHeader className=\"headerWithAvatar\">\n      <div className=\"cityParent\">\n        <img src=\"/assets/pics/hills.svg\" style={{right:'25px'}} className=\"headerHills\" alt=\"Hills\"/>\n        <img src=\"/assets/pics/hills.svg\" style={{right:'200px'}} className=\"headerHills\" alt=\"Hills\"/>\n        <img src=\"/assets/pics/ground.svg\" className=\"headerGround\" alt=\"Ground\"/>\n        <img src=\"/assets/pics/sun.svg\" style={{right:'130px', top: '10px', width:'5%'}} className=\"headerSkyDetail\" alt=\"Hills\"/>\n        <img src=\"/assets/pics/cloud2.svg\" style={{right:'240px', top: '40px'}} className=\"headerSkyDetail\" alt=\"Hills\"/>\n        <img src=\"/assets/pics/cloud1.svg\" style={{right:'60px', top: '40px'}} className=\"headerSkyDetail\" alt=\"Hills\"/>\n        <img src=\"/assets/pics/cloud2.svg\" style={{right:'140px', top: '15px'}} className=\"headerSkyDetail\" alt=\"Hills\"/>\n      </div>\n      <div className=\"statsParent\" >\n        <div className=\"statsBarParent\" >\n          <IonIcon class=\"statsBarIcon\" icon={heart} style={{color: \"#C20114\"}} />\n          <Line trailWidth={0} percent={health/maxHealth * 100} \n                className=\"statsBarLine\"\n                strokeWidth={4} strokeColor=\"#C20114\" />\n          <IonBadge class=\"statsBarBadge\" \n                    color=\"danger\" >{health}/{maxHealth}</IonBadge>\n        </div>\n        <div className=\"statsBarParent\" >\n        <IonIcon class=\"statsBarIcon\" icon={leaf} style={{color: \"#157F1F\"}} />\n          <Line trailWidth={0}  percent={experience/maxExperience * 100} \n                className=\"statsBarLine\"\n                strokeWidth={4} strokeColor=\"#157F1F\" />\n          <IonBadge class=\"statsBarBadge\" \n                    color=\"success\" >{experience}/{maxExperience}</IonBadge>\n        </div>\n        <div className=\"statsBarMoneyParent\" >\n          <IonBadge class=\"statsBarMoneyBadge\" \n                    color=\"warning\" >Gold: {gold}</IonBadge>\n          <IonBadge class=\"statsBarMoneyBadge\" \n                    color=\"success\" >Level: {level}</IonBadge>\n        </div>\n      </div>\n        \n      <h1>{title}</h1>\n    </IonHeader>\n  )\n}\n\nexport default HeaderWithProgress;","import React from 'react';\nimport {\n  IonPage,\n  IonContent,\n  IonList,\n  IonItem,\n  IonButton,\n  IonToolbar,\n  IonChip,\n  IonIcon,\n  IonLabel,\n  IonFab,\n  IonFabButton} from '@ionic/react';\nimport { Plugins, KeyboardInfo } from '@capacitor/core';\n\nimport TodoNewComp from './todo.new.component';\nimport TodoListItemComp from './Todo.listitem.component';\nimport { useTodosCollectionFacade } from './hooks/todos.hook';\nimport './todos.page.css';\nimport HeaderWithProgress from '../../components/HeaderWithProgress';\nimport { useParams, useLocation } from 'react-router-dom';\nimport { capitalize } from '../../utils';\nimport { getDefaultProject } from '../../modules/data/utilsData';\nimport { authService } from '../../modules/auth/authService';\nimport ulog from 'ulog';\nimport { checkmarkCircleOutline, radioButtonOff, arrowDownOutline, arrowUpOutline, add } from 'ionicons/icons';\n\nconst log = ulog('todo');\nconst { Keyboard, Device } = Plugins;\n\n\nconst TodosPage  = () => {\n\n  const project = getDefaultProject(authService.userid);\n  const location = useLocation();\n  \n\n  let list, tag;\n  const params = useParams();\n  log.info(params, location);\n  if(location.pathname.startsWith('/todos/tag/')){\n   tag = params['tag']\n  }\n  else {\n    list = params['list']\n  }\n\n  const [state, dataFunc] = useTodosCollectionFacade(project.id, list, tag)\n  const { docs, selectedTodo, tagDocs } = state;\n\n  const printTitle = ():string => {\n    if(state.list){\n      return 'Todos: ' + capitalize(state.list.name);\n    }\n    return 'Todos';\n  }\n\n  const setKeyboard = async () => {\n    const devInfo = await Device.getInfo();\n    if(devInfo.operatingSystem !== 'ios' &&\n       devInfo.operatingSystem !== 'android') return;\n\n    Keyboard.addListener('keyboardWillShow', (info: KeyboardInfo) => {\n      console.log('keyboard will show with height', info.keyboardHeight);\n    });\n    \n    Keyboard.addListener('keyboardDidShow', (info: KeyboardInfo) => {\n      console.log('keyboard did show with height', info.keyboardHeight);\n    });\n    \n    Keyboard.addListener('keyboardWillHide', () => {\n      console.log('keyboard will hide');\n    });\n    \n    Keyboard.addListener('keyboardDidHide', () => {\n      console.log('keyboard did hide');\n    });\n  }\n\n  const drawActiveInactiveChip = () => {\n    const label = 'Switch View';\n\n    return <IonChip>\n            <IonIcon onClick={() => {dataFunc.changeDoneFilter(!state.doneTodos)}}\n                     icon={radioButtonOff}\n                     color={(state.doneTodos)? 'light':'success'}  />\n            <IonLabel onClick={() => {dataFunc.changeDoneFilter(!state.doneTodos)}}>\n              {label}</IonLabel>\n            <IonIcon \n                      color={(!state.doneTodos)? 'light':'success'} \n                      icon={checkmarkCircleOutline}\n                      onClick={() => {dataFunc.changeDoneFilter(!state.doneTodos)}}/>\n          </IonChip>\n\n  }\n\n  setKeyboard();\n  \n  return (\n    <IonPage>\n      <HeaderWithProgress title={printTitle()} />\n      <IonContent id=\"todoContent\">\n        <div>\n          <IonButton  color={(!state.doneTodos)? 'light':'success'} \n                      class=\"todoHeaderIcons\" \n                      onClick={() => {dataFunc.changeDoneFilter(true)}}\n                      fill=\"clear\">\n                      <IonIcon icon={checkmarkCircleOutline} />\n          </IonButton>\n          <IonButton  color={(state.doneTodos)? 'light':'success'} \n                      class=\"todoHeaderIcons\" \n                      onClick={() => {dataFunc.changeDoneFilter(false)}}\n                      fill=\"clear\">\n                      <IonIcon icon={radioButtonOff} />\n          </IonButton>\n          <IonButton  color={(state.orderFilter!== 'created')? 'light':'success'} \n                      class=\"todoHeaderButtons\" \n                      onClick={() => {dataFunc.changeOrderFilter('created')}}\n                      fill=\"clear\">Date\n                      {(state.orderFilter === 'created')? (\n                        <IonIcon \n                          icon={((state.orderAsync === -1)? arrowDownOutline : arrowUpOutline)}/>\n                      ) : (<></>) }\n          </IonButton>\n          <IonButton  color={(state.orderFilter !== 'name')? 'light':'success'} \n                      class=\"todoHeaderButtons\" \n                      onClick={() => {dataFunc.changeOrderFilter('name')}}\n                      fill=\"clear\">Name\n                      {(state.orderFilter === 'name')? (\n                        <IonIcon \n                          icon={((state.orderAsync === -1)? arrowDownOutline : arrowUpOutline)}/>\n                      ) : (<></>) }\n          </IonButton>\n        </div>\n        <IonList>\n            {docs.map(todo => (\n              <TodoListItemComp   todo={todo} \n                                  tagDocs={tagDocs}\n                                  lastChild = {false}\n                                  selectedTodo={selectedTodo}                                 \n                                  dataFunctions={dataFunc}\n                                  key={todo.id} />\n            ))}\n        </IonList>\n        <IonFab vertical=\"top\" horizontal=\"end\" slot=\"fixed\" edge>\n          <IonFabButton onClick={() => dataFunc.showNewTag(true)} >\n            <IonIcon icon={add} />\n          </IonFabButton>\n        </IonFab>\n      </IonContent>\n      <IonToolbar>\n          <TodoNewComp \n            list = {state.list}\n            focus = {state.showNewTagFilter}\n            closeFunc = {() => dataFunc.showNewTag(false)}\n            tag = {tag}\n            projectId={project.id||''} \n            saveFunc={dataFunc.save} />\n      </IonToolbar>\n    </IonPage>\n  );\n};\n\nexport default TodosPage;\n\n","import React from 'react';\nimport { IonHeader, IonToolbar, IonPage, IonTitle, IonContent, IonLabel } from '@ionic/react';\n\n\n\nconst IntroPage: React.FC = () => {\n  return (\n    <IonPage>\n      <IonHeader>\n        <IonToolbar>\n          <IonTitle>Loading</IonTitle>\n        </IonToolbar>\n      </IonHeader>\n      <IonContent>\n        <IonLabel>Loading.....</IonLabel>\n      </IonContent>\n    </IonPage>\n  );\n};\n\nexport default IntroPage;\n","import { Subscription, BehaviorSubject } from \"rxjs\";\nimport { PartyProject, TYPE_PARTY, Challenge, ChallengeState } from \"./models\";\nimport { getPostRequest, post } from '../ajax/ajax';\nimport { env } from \"../../env\";\nimport { loadingService } from \"../loading/loadingService\";\nimport { toastService, ToastType } from \"../toast/toastService\";\nimport { dataService } from \"../data/dataService\";\nimport { waitMS, getChannelFromProjectId } from '../data/utilsData';\nimport { Msg, TYPE_MSG } from \"../messages/models\";\nimport moment from \"moment\";\nimport { saveIntoDocList } from \"../../utils\";\nimport ulog from 'ulog';\nimport { authService } from \"../auth/authService\";\n\nconst log = ulog('parties');\n\nexport interface PartyState {\n  docs: PartyProject[],\n}\n\nexport const initPartyState = {\n  docs: []\n}\n\nexport class PartyService {\n  private _subscription: Array<Subscription> = [];\n  \n  private _state: PartyState = initPartyState;\n  public state$ = new BehaviorSubject(this._state);\n  \n  async init(){\n    this.unsubscribe();\n\n\n    const sub1 = dataService.subscribeChanges().subscribe(doc => {\n      if(doc.type === 'party' && doc.secondaryType === 'project'){\n        const docs = saveIntoDocList(doc, this._state.docs);\n        this.state = {...this._state, ...{docs}};\n      }\n    });\n    this._subscription.push(sub1);\n    const docs = await dataService.queryByProperty('secondaryType', 'equals', 'project', TYPE_PARTY);\n    this.state = {...this._state , ...{docs}};\n\n\n  }\n\n  /*\n    Rights, each digit represents different right\n    0.  0 - Not admin 1- Admin, can change everything\n    1.  (Project item) 0 - can't see, 1 - can see, 2 - can edit\n    2.  (Project children) 0 - can't see, 1 - can see own, 2 - can see all items\n    3.  (Project children edit) 0 -can't edit, 1 can edit/make own, 2 can edit all \n  */\n  public async addUser(id:string, party: PartyProject) {\n    try {\n      const res = await post(getPostRequest(env.AUTH_API_URL +'/channels/sendAddMemberRequest',\n                      { token: authService.getToken(), \n                        channelid: getChannelFromProjectId(party.id),\n                        id: id,\n                        rights: '0121' //see all, edit own items \n                      }), \n                      true, 'Adding member, please wait');\n\n      if(!res.success){\n        return toastService.printServerErrors(res);\n      }\n\n      toastService.showMessage('Member invitation sent', ToastType.success);\n      waitMS(3000);\n      dataService.addSyncCall$.next();\n    }\n    catch (e) {\n      log.error(e);\n    }\n    \n  }\n\n  public saveParty(partyProject: PartyProject){\n    if (!partyProject.id) {\n      this._createParty(partyProject);\n    }\n  }\n\n  //make new party ajax\n  private async _createParty(partyProject: PartyProject) {\n    log.info('Saving party Project::: ', partyProject);\n    loadingService.showLoading('Creating party, please wait, ' +\n                'internet connection required');\n    const res = await dataService.saveNewProject(partyProject, TYPE_PARTY);\n    if(!res.success){\n      return toastService.printServerErrors(res);\n    } \n    loadingService.hideLoading();\n  }\n\n  public saveChallenge(challenge:Challenge, party:PartyProject){\n    if(!challenge.id) {\n      this._createChallenge(challenge, party);\n    }\n  }\n\n  private async _createChallenge(challenge:Challenge, partyProject: PartyProject) {\n    log.info('Saving System Doc::: ', partyProject);\n    loadingService.showLoading('Adding Challenge, please wait, ' +\n                'internet connection required');\n    const res = await dataService.saveSystemDoc(challenge,partyProject, TYPE_PARTY);\n    if(!res.success){\n      return toastService.printServerErrors(res);\n    }\n    loadingService.hideLoading();\n  }\n\n\n  public async acceptPartyInvitation(msg:Msg){\n    //lets send a request\n    try {\n      const res = await post(getPostRequest(env.AUTH_API_URL +'/channels/acceptChannelInvitation',\n                      { token: authService.getToken(), msgId: msg.id,}, {} ), \n                      true, 'Accept Reply sent, waiting for reply.');\n      if(!res.success){\n        return toastService.printServerErrors(res);\n      }\n\n      toastService.showMessage('Pary Membership request sent. Please wait for app update.', ToastType.success);\n      await waitMS(2000);\n      dataService.addSyncCall$.next();\n      msg.replied = {accepted: true, date: Date.now()};\n      dataService.save(msg, TYPE_MSG);\n    }\n    catch (e) {\n      log.error(e);\n    }\n  }\n\n  public async acceptFriendInvitation(msg:Msg){\n    //lets send a request\n    try {\n      const res = await post(getPostRequest(env.AUTH_API_URL +'/social/acceptFriendInvitation',\n                      { token: authService.getToken(), msgId: msg.id,}, {} ), \n                      true, 'Accept Reply sent, waiting for reply.');\n      if(!res.success){\n        return toastService.printServerErrors(res);\n      }\n\n      toastService.showMessage('Friend acceptance reply sent. Please wait for app update.', \n        ToastType.success);\n\n      await waitMS(2000);\n\n      dataService.addSyncCall$.next();\n\n      msg.replied = {accepted: true, date: Date.now()};\n      dataService.save(msg, TYPE_MSG);\n    }\n    catch (e) {\n      log.error(e);\n    }\n  }\n\n  public async rejectPartyInviation(msg:Msg) {\n    const newMsg = {...msg, ...{replied:{accepted: false, date: Date.now()}}}\n    dataService.save(newMsg, TYPE_MSG);\n  }\n\n  public async rejectFriendInviation(msg:Msg) {\n    const newMsg = {...msg, ...{replied:{accepted: false, date: Date.now()}}}\n    dataService.save(newMsg, TYPE_MSG);\n  }\n\n  public async changeChallengeState(challengeid: string|undefined, state:ChallengeState){\n    if(!challengeid) throw new Error('Challengeid cannot be undefined');\n    try {\n      const res = await post(getPostRequest(env.AUTH_API_URL +'/habits/changeChallengeState',\n                      { token: authService.getToken(), \n                        challengeid, state}, {} ), \n                      true, 'Saving challenge, please wait.');\n      if(!res.success){\n        return toastService.printServerErrors(res);\n      }\n      await dataService.saveFromServer(res.data.doc, TYPE_PARTY);\n\n      toastService.showMessage('Challenge saved.', \n        ToastType.success);\n\n      await waitMS(2000);\n      dataService.addSyncCall$.next();\n      await waitMS(2000);\n      dataService.addSyncCall$.next();\n    }\n    catch (e) {\n      log.error(e);\n    }\n  }\n\n  public async submitChallengeActions(challengeid: string|undefined, value:number){\n    if(!challengeid) throw new Error('Challengeid cannot be undefined');\n    try {\n      const actions = [{date: moment().format(env.MOMENT_DATE_FORMAT), value}]\n      const res = await post(getPostRequest(env.AUTH_API_URL +'/habits/submitChallengeActions',\n                      { token: authService.getToken(), \n                        challengeid, actions}, {} ), \n                      true, 'Saving challenge, please wait.');\n      if(!res.success){\n        return toastService.printServerErrors(res);\n      }\n      log.trace(res);\n      \n      if(res.data && res.data.challenge)\n        dataService.saveFromServer(res.data.challenge, TYPE_PARTY);\n\n      if(res.data && res.data.rewards)\n        toastService.showMessage('You have recieved '+res.data.rewards+' points', \n          ToastType.success);\n      await waitMS(2000);\n      dataService.addSyncCall$.next();\n      await waitMS(2000);\n      dataService.addSyncCall$.next();\n    }\n    catch (e) {\n      log.error(e);\n    }\n  }\n\n  public async acceptChallenge(challenge:Challenge){\n    //lets send a request\n    try {\n      const res = await post(getPostRequest(env.AUTH_API_URL +'/habits/acceptChallenge',\n                      { token: authService.getToken(), challengeid: challenge.id}, {} ), \n                      true, 'Accept Reply sent, waiting for reply.');\n      if(!res.success){\n        return toastService.printServerErrors(res);\n      }\n\n      toastService.showMessage('Challenge acceptance request sent. Please wait for update.', \n        ToastType.success);\n      await waitMS(2000);\n      dataService.addSyncCall$.next();\n    }\n    catch (e) {\n      log.error(e);\n    }\n  }\n\n\n  public get state(): PartyState {\n    return this._state;\n  }\n  public set state(value: PartyState) {\n    console.log('State: ', value);\n    this._state = value;\n    this.state$.next(this._state);\n  }\n\n  public unsubscribe() {\n    if(!this) return;\n    this._subscription.forEach(sub => {\n      if(sub)\n        sub.unsubscribe();\n    });\n  }\n\n}\n\nexport const partyService = new PartyService();","import { Subscription, BehaviorSubject } from \"rxjs\";\nimport { getPostRequest, post } from '../ajax/ajax';\nimport { env } from \"../../env\";\nimport { authService } from '../auth/authService';\nimport { toastService, ToastType } from \"../toast/toastService\";\nimport { dataService } from \"../data/dataService\";\nimport { waitMS } from '../data/utilsData';\nimport { Friend } from \"./models\";\n\nexport interface SocialState {\n  friends: Friend[],\n}\n\nexport const initSocialState = {\n  friends: []\n}\n\n\n\nexport class SocialService {\n  private _subscription: Array<Subscription> = [];\n  private _userid = ''\n  private _state: SocialState = initSocialState;\n  public state$ = new BehaviorSubject(this._state);\n  \n  async init(userid){\n    if(userid === this._userid) return;\n    this._userid = userid;\n    this.unsubscribe();\n    this._init();\n  }\n\n  private async _init() {\n\n  }\n\n  public async addFriend(username?:string) {\n    try {\n      const res = await post(getPostRequest(env.AUTH_API_URL +'/social/sendAddFriendRequest',\n                      { token: authService.getToken(), \n                        username,\n                      }), \n                      true, 'Sending invitatin request, please wait');\n      if(!res.success){\n        return toastService.printServerErrors(res);\n      }\n\n      toastService.showMessage('Friend invitation sent', ToastType.success);\n\n      waitMS(3000);\n\n      dataService.addSyncCall$.next();\n    }\n    catch (e) {\n      console.log(e);\n    }\n    \n  }\n\n\n  public get state(): SocialState {\n    return this._state;\n  }\n  public set state(value: SocialState) {\n    this._state = value;\n    this.state$.next(this._state);\n  }\n\n\n\n  public unsubscribe() {\n    if(!this) return;\n    this._subscription.forEach(sub => {\n      if(sub)\n        sub.unsubscribe();\n    });\n  }\n\n}\n\nexport const socialService = new SocialService();","import React, { useReducer } from 'react';\nimport { IonCard, IonCardTitle, IonCardHeader, IonCardContent, IonList, IonItem, IonAlert, IonFooter, IonButton, IonLabel } from '@ionic/react';\nimport  ulog from 'ulog';\nimport { Friend } from '../models';\nimport { socialService } from '../social.service';\nconst log = ulog('social');\n\nexport interface FriendsState {\n  showAddModal: boolean,\n  friends: Friend[],\n}\n\n\nconst reducer = (state, action): FriendsState => {\n  switch(action.type) {\n    case 'showAddMemberModal':\n      return {...state, ...{showAddModal: true}};\n    case 'hideAddMemberModal':\n      return {...state, ...{showAddModal: false}};\n\n    default:\n      log.error('Action type is not a match');\n      return state;\n  }\n}\n\nconst FriendsListComponent = () => {\n  const [state, _dispatch] = useReducer(reducer, {\n    showAddModal: false,\n    friends: [],\n  })\n\n  const dispatch = (type: 'showAddMemberModal'|\n                          'hideAddMemberModal', \n                    data:any = {}) => {\n    _dispatch({type, data});\n  }\n\n  const addFriend = () => {\n    dispatch(\"showAddMemberModal\");\n    \n  }\n\n  const hideAddUser = () => {\n    dispatch('hideAddMemberModal');\n  }\n\n  return (\n    <IonCard>\n      <IonCardHeader>\n        <IonCardTitle>Friends</IonCardTitle>\n      </IonCardHeader>\n      <IonCardContent>\n        <IonList>\n            {state.friends.map(member => (\n              <IonItem  button \n                        key={member.id}\n                        onClick={() => {}}>\n              <IonLabel>\n                {member.username}\n              </IonLabel>\n            </IonItem>\n            ))}\n        </IonList>\n        \n      </IonCardContent>\n        <IonFooter>\n          <IonButton onClick={()=>addFriend()} fill=\"clear\">Add Friend</IonButton>\n        </IonFooter>\n      <IonAlert \n        isOpen={state.showAddModal}\n        onDidDismiss={() => hideAddUser()}\n        header=\"Friend's Username:\"\n        inputs={[\n          {\n            name: 'username',\n            type: 'text',\n            id: 'username',\n\n\n          }\n        ]}\n        buttons={[\n          {\n            text: 'Cancel',\n            role: 'cancel',\n            cssClass: 'secondary',\n            handler: () => {\n              hideAddUser();\n            }\n          },\n          {\n            text: 'Invite User',\n            handler: (data) => {\n              socialService.addFriend(data.username);\n              hideAddUser();\n            }\n          }\n        ]}\n      />\n    </IonCard>\n  )\n\n}\nexport default FriendsListComponent;","import React, { useReducer, useEffect } from 'react';\nimport { IonCard, IonCardTitle, IonCardHeader, IonCardContent, IonList, IonItem, IonLabel, IonAvatar, IonIcon, IonText, IonButton } from '@ionic/react';\nimport  ulog from 'ulog';\nimport { Msg } from '../../messages/models';\nimport { dataService } from '../../data/dataService';\nimport { TYPE_MSG } from '../models';\nimport { mail, personAdd, happy, sad, peopleCircle } from 'ionicons/icons';\nimport { printDateRelative, saveIntoArray } from '../../../utils';\nimport { partyService } from '../../parties/party.service';\nimport { COLOR_SUCCESS, COLOR_WARNING } from '../../../colors';\nconst log = ulog('messages');\n\nexport interface MessagesState {\n  messages: Msg[],\n}\n\n\nconst reducer = (state, {type, payload}): MessagesState => {\n  switch(type) {\n    case 'setMessages':\n      return {...state, ...{messages: payload}};\n      case 'updateMessage':\n        return {...state, ...{messages: saveIntoArray(payload, state.messages)}};\n    default:\n      log.error('Action type is not a match');\n      return state;\n  }\n}\n\nconst MessagesListComponent = ({channel}:{channel:string}) => {\n  const [state, _dispatch] = useReducer(reducer, {\n    messages: [],\n  })\n\n  useEffect(() => {\n    loadMsgs()\n    const sub = dataService.subscribeChannelTypeChanges(channel, TYPE_MSG)\n                    .subscribe(doc => {\n                        log.info(doc);\n                        dispatch('updateMessage', doc);\n                    });\n    return () => {\n      sub.unsubscribe();\n    };\n  // eslint-disable-next-line react-hooks/exhaustive-deps\n  }, [channel])\n\n  const dispatch = (type: 'setMessages'|\n                          'updateMessage', \n                    payload:any = {}) => {\n    _dispatch({type, payload});\n  }\n\n  const loadMsgs = async () => {\n    log.info('Get all by project, type', channel, TYPE_MSG);\n    const msgs = await dataService.getAllByChannel(channel, TYPE_MSG);\n    dispatch('setMessages', msgs.sort((a,b)=>{\n      if(a.updated < b.updated) return 1;\n      return -1;\n    }))\n    log.info(msgs, channel);\n  }\n\n  const printMessageIcon = (msg) => {\n    if(msg.messageType === 'event'){\n      return <IonIcon icon={mail}  slot=\"start\" />\n    }\n    else if(msg.messageType === 'channelinvite') {\n      return <IonIcon icon={peopleCircle}  slot=\"start\" />\n    }\n    else if(msg.messageType === 'friendinvite') {\n      return <IonIcon icon={personAdd}  slot=\"start\" />\n    }\n  }\n\n  const printReplyStatus = (msg:Msg) => {\n    if((msg.messageType === 'channelinvite' || msg.messageType === 'friendinvite')\n        && msg.replied !== undefined) {\n      if(msg.replied) {\n        return <IonIcon icon={happy} size='large' \n                        slot=\"end\"\n                        color={COLOR_SUCCESS} />\n      }\n      else {\n        return <IonIcon icon={sad} size='large' \n                        slot=\"end\"\n                        color={COLOR_WARNING} />\n      }\n    }\n  }\n\n  const printClubRequestAcceptRejectButtons = (msg:Msg) => {\n    if(msg.messageType === 'channelinvite' && msg.replied === undefined){\n      return (\n        <div>\n          <IonButton onClick={() => partyService.acceptPartyInvitation(msg)} >\n            Accept</IonButton>\n          <IonButton onClick={() => partyService.rejectPartyInviation(msg)}> \n            Reject</IonButton>\n        </div>\n      )\n    }\n  }\n\n  const printFriendRequestAcceptRejectButtons = (msg:Msg) => {\n    if(msg.messageType === 'friendinvite' && msg.replied === undefined){\n      return (\n        <div>\n          <IonButton onClick={() => partyService.acceptFriendInvitation(msg)} >\n            Accept</IonButton>\n          <IonButton onClick={() => partyService.rejectFriendInviation(msg)}> \n            Reject</IonButton>\n        </div>\n      )\n    }\n  }\n\n  const printMessage = (msg) => {\n    if(msg.messageType === 'event'){\n      return <IonItem  button \n                key={msg.id}\n                onClick={() => {}}>\n        {printMessageIcon(msg)}\n        <IonLabel className=\"ion-text-wrap\">\n          <h3>{msg.message}</h3>\n          <IonText color=\"secondary\">\n              <p>{printDateRelative(msg.updated)}</p>\n          </IonText>\n        </IonLabel>\n      </IonItem>\n    }\n    else if(msg.messageType === 'channelinvite') {\n      return <IonItem  button \n                key={msg.id}\n                onClick={() => {}}>\n        {printMessageIcon(msg)}\n        <IonLabel className=\"ion-text-wrap\">\n          <h2>{msg.from} has invited you to join his club, \n          <strong>{msg.data.name}</strong></h2>\n          <IonText  color=\"secondary\">\n            {printDateRelative(msg.updated)}\n          </IonText>\n            {printClubRequestAcceptRejectButtons(msg)}\n          \n        </IonLabel>\n        {printReplyStatus(msg)}\n      </IonItem>\n    }\n    else if(msg.messageType === 'friendinvite') {\n      return <IonItem  button \n                key={msg.id}\n                onClick={() => {}}>\n        {printMessageIcon(msg)}\n        <IonLabel className=\"ion-text-wrap\">\n            <h2>You have received friend request from \n            <strong> {msg.from}</strong></h2>\n            <IonText  color=\"secondary\">\n              {printDateRelative(msg.updated)}\n            </IonText>\n              {printFriendRequestAcceptRejectButtons(msg)}\n        </IonLabel>\n        {printReplyStatus(msg)}\n      </IonItem>\n    }                        \n  }\n\n\n  return (\n    <IonCard>\n      <IonCardHeader>\n        <IonCardTitle>Messages</IonCardTitle>\n      </IonCardHeader>\n      <IonCardContent>\n        <IonList>\n            {state.messages.map(msg=> printMessage(msg))}\n        </IonList>\n        \n      </IonCardContent>\n    </IonCard>\n  )\n\n}\nexport default MessagesListComponent;","import {\n  IonPage,\n  IonContent} from '@ionic/react';\nimport React, { useReducer, useEffect } from 'react';\nimport './Home.css';\nimport HeaderWithProgress from '../components/HeaderWithProgress';\nimport FriendsListComponent from '../modules/social/components/Friends.list.component';\nimport MessagesListComponent from '../modules/messages/components/Messages.list.component';\nimport ulog from 'ulog';\nimport { generateUserChannelId } from '../modules/data/utilsData';\nimport { authService } from '../modules/auth/authService';\n\nconst log = ulog('home');\n\n\nexport interface HomeState {\n  userid: string;\n}\n\nconst reducer = (state, {type, payload}:{type:string, payload:any}): HomeState => {\n  switch(type) {\n    case 'setUserid':\n      return {...state, ...{userid: payload}};\n    default:\n      log.error('Action Type is incorrect, default called', type, payload);\n      return state;\n  }\n}\n\nconst Home: React.FC = () => {\n\n  const [state, _dispatch] = useReducer(reducer, {\n    userid:''\n  })\n\n  const dispatch = (type:'setUserid', \n                    payload: any = {}) => {\n    _dispatch({type, payload});\n  }\n\n\n  useEffect(() => {\n    const sub = authService.username$.subscribe(() => {\n      log.info('Userid update, ', authService.userid);\n      dispatch('setUserid', authService.userid);\n    });\n    log.info('HOME, ', authService.userid);\n    dispatch('setUserid', authService.userid);\n    log.info('Home State', authService.userid);\n    return () => {\n      sub.unsubscribe();\n    };\n  }, [])\n\n  return (\n    <IonPage>\n      <HeaderWithProgress title=\"HabitVille\" />\n      <IonContent >\n        <FriendsListComponent />\n        <MessagesListComponent channel={generateUserChannelId(state.userid)} />\n      </IonContent>\n    </IonPage>\n  );\n};\n\nexport default Home;\n\n","import {\n  IonPage,\n  IonContent,\n  IonHeader,\n  IonTitle,\n  IonToolbar} from '@ionic/react';\nimport React, {  } from 'react';\n\n\nconst NotFound: React.FC = () => {\n\n  return (\n    <IonPage>\n      <IonHeader>\n        <IonToolbar>\n          <IonTitle>habits</IonTitle>\n        </IonToolbar>\n      </IonHeader>\n      <IonContent >\n        <div style={{padding:'20px'}}>\n          This page does not exist\n        </div>\n      </IonContent>\n    </IonPage>\n  );\n};\n\nexport default NotFound;\n\n","import React from 'react'\nimport {  IonInput, IonLabel, IonItem,\n  IonNote, IonText } from '@ionic/react';\n\n\nconst MyInput = ({data, updateFunction}) => {\n\n\n\n  //const [_data, setData] = useState<FormValueItem>(data); \n\n  /*\n  useEffect(() => {\n    props.attachToForm({name:props.name, value: props.value});\n\n    return props.detachFromForm({name:props.name, value:props.value});\n  },[props]);\n  */\n\n  //console.log(\"MY Input DATA: \", data);\n\n  const handleChange = (event) => {\n    updateFunction({...data, ...{value: event.target.value, dirty: true}});\n  };\n\n  const handleBlur = (event) => {\n    if(data.dirty === true) return;\n    updateFunction({...data, ...{value: event.target.value, dirty: true}});\n  }\n\n  const printErrors = () => {\n    if(data.dirty){\n      const errors =data.errors.map(m => (\n        <IonNote key={m} color=\"danger\">{m}</IonNote>\n      ))\n      return errors;\n    }\n  }\n\n\n  return (\n    <IonItem>\n      <IonLabel position=\"stacked\">\n        {data.displayName}\n        { data.hasValidation?(\n          <IonText color=\"danger\">*</IonText>\n        ):null}\n      </IonLabel>\n      <IonInput \n        name={data.id}\n        value={data.value}\n        type={data.type}\n        onIonBlur={handleBlur}\n        onIonChange={handleChange}></IonInput>\n        {data.messages.map(m => (\n          <IonNote key={m}>{m}</IonNote>\n        ))}\n        {printErrors()}\n    </IonItem>\n  )\n}\n\nexport default MyInput;","import React, { useEffect, useState } from 'react'\nimport MyInput from './myInput';\nimport { saveIntoArray, findById } from '../../utils';\nimport { IonButton } from '@ionic/react';\nimport validator from 'validator';\n\n\n// use to generate form, usually from outside form passed into here\n// so far we can use, ones that have stars have been tested\n// \"text\", \"password\", \"email\", \"number\", \"search\", \"tel\", and \"url\"\nexport interface FormItem { \n  id: string;\n  displayName?: string;\n  type: string;\n  messages?: string[];\n  validators?: any[];  \n  default?: any;\n}\n\nexport interface ValidatorItem {\n  type: string;\n  message?: string|null;\n  options?: any;\n}\n\n\n// use to hold form state\nexport interface FormValueItem {\n  id: string;\n  displayName: string;\n  type: string;\n  value: string;\n  messages: string[];\n  errors: string[];\n  dirty: boolean;\n  hasValidation:boolean;\n  //status: number; //0: untouched, 1: valid, 2: not valid\n}\n\nexport interface OptionsItem {\n  submitButtonText: string;\n}\n\nexport const defaultOptions:OptionsItem = {\n  submitButtonText: \"Submit\",\n}\n\nexport const getFormOptions = (settings:{}) => {\n  return {...defaultOptions, ...settings};\n}\n\nexport interface Props {\n  items: FormItem[],\n  submitFunction: Function,\n  options?: OptionsItem\n}\n\nexport interface State {\n  items: FormValueItem[],\n  valid: boolean\n}\n\nexport function getValidator(type:string, options:any = null, message:string|null = null):ValidatorItem {\n  return {type, options, message};\n}\n\n\n\nconst MyForm = (props:Props) => {\n  const submitFunction = props.submitFunction;\n  const options = props.options|| defaultOptions;\n\n  const [state, setState] = useState<State>({items:[], valid:false});\n\n  useEffect(() => {\n    initForm(props.items);\n  // eslint-disable-next-line react-hooks/exhaustive-deps\n  },[props.items]);\n\n\n  const initForm = (items) => {\n    let model: FormValueItem[] = [];\n    // go thourgh props and generate our model from schema;\n    if(items) { //no schema, do nothing\n      items.forEach((item:FormItem) => {\n        let messages = item.messages;\n        \n        console.log(typeof(messages));\n        if(typeof(messages) === 'string'){\n          console.log('Messages is string');\n        }\n        else if(Array.isArray(messages)){\n          console.log('messages array');\n        }\n        else {\n          messages = [];\n        }\n\n        model.push(validateItem({\n            id: item.id,\n            displayName: item.displayName || item.id, \n            type: item.type,\n            value: item.default||'', \n            messages,\n            errors: [],\n            dirty:false,\n            hasValidation: (Array.isArray(item.validators) && item.validators.length>0)\n        }));\n      });\n      setState({items: model, valid: validateForm(model)});\n      //console.log(state);\n    }\n  }\n\n  //const updateItem = (id:string, displayName: string, type: string, value:any, messages:string[], hasValidation:boolean, touched:boolean) => {\n  const updateItem = (item:FormValueItem) => {\n    //console.log('Update Item, ', item);\n    const items = saveIntoArray(validateItem(item), state.items, 'id')\n    setState({\n      items: items,\n      valid: validateForm(items)\n    });\n  }\n\n\n\n  const validateItem = (item:FormValueItem): FormValueItem => {\n    const errors: string[] = validate(item.id, item.value);\n    //console.log(item)\n    return {...item, ...{errors}}\n  }\n\n  const validate = (id:string, value:any): string[] => {\n    //console.log(typeof(value));\n\n    if(typeof(value) !== 'string') return [];\n    \n    const item:FormItem = findById(id, props.items, 'id');\n    if(!item.validators)\n      item.validators = [];\n\n    const messages: string[] = [];\n    item.validators.forEach((val:ValidatorItem) => {\n      if(val.type === 'isEmpty') {\n        if(validator.isEmpty(value)){\n          messages.push(val.message || 'Value cannot be empty')\n        }\n      }\n      if(val.type === 'isLength'){\n        if(!validator.isLength(value, val.options)){\n          messages.push(val.message || 'Value length is not valid');\n        }\n      }\n      if(val.type === 'isEmail'){\n        if(!validator.isEmail(value, val.options)){\n          messages.push(val.message || 'Valid Email required');\n        }\n      }\n    });\n\n    //lastly check the whole form\n\n    //if(messages.length === 0)\n    //  validateForm();\n\n    return messages;\n  }\n\n\n  const submit = () => {\n    const form = {};\n    state.items.forEach(item => {\n      form[item.id] = { value: item.value };\n    });\n    submitFunction(form);\n    console.log(state);\n  }\n\n  const validateForm = (items = state.items) => {\n    let errors = 0;\n    items.forEach(item => {\n      errors += item.errors.length;\n    });\n\n    return errors === 0;\n  }\n  \n\n  return (\n    <div>\n        { Object.values(state.items).map((i) => (\n          <MyInput key={i.id} data={i} updateFunction={updateItem} />\n        ))}\n          <IonButton  \n            key={'submitButton'}\n            onClick={submit} \n            disabled={!state.valid}\n            color=\"primary\">{options.submitButtonText}</IonButton>\n    </div>\n  )\n\n};\n\nexport default MyForm;\n\n\n\n/*\n  const attachToForm = (component) => {\n    setInputs({...inputs, ...{[component.props.name]: component}});\n    setModel({...model, ...{[component.props.name]: component.state.value}});\n  };\n\n  const detachFromForm = (component) => {\n    const i = Object.assign({}, inputs);\n    delete i[component.props.name]\n    setInputs(i);\n\n    const m = Object.assign({}, model);\n    delete m[component.props.name];\n    setModel(m);\n  }\n\n  const updateModel = () => {\n    const m = Object.assign({}, model);\n    Object.keys(inputs).forEach((name) => {\n      m[name] = inputs[name].state.value;\n    });\n\n    setModel(m);\n  }\n\n  const submit = (event) => {\n    event.preventDefault();\n    updateModel();\n    console.log(model);\n  }\n\n  const getElement = (type) => {\n    if(type === 'string'){\n      return (\n        <div>type</div>\n      )\n    }\n  }\n*/","import React from 'react';\nimport { IonButton } from '@ionic/react';\nimport './auth.css';\nimport { useLocation, useHistory } from 'react-router-dom';\n\n\n\n\n\nconst AuthMenuComponent = ({page}: {page:string}) => {\n  const location = useLocation();\n  const history = useHistory();\n  \n  const push = (url:string) => {\n    if(location.pathname && url !== location.pathname){\n      history.push(url);\n    }\n  }\n\n  return (\n    <div className=\"authMenuParent\" >\n      <IonButton  onClick={() => push('/auth/login')}\n                  size=\"small\"  \n                  color={(page==='login')? 'success':'light'}\n                  fill=\"clear\">\n          Login\n      </IonButton>\n      <IonButton   onClick={() => push('/auth/register')}\n                  size=\"small\"  \n                  color={(page==='register')? 'success':'light'}\n                  fill=\"clear\">\n          Register\n      </IonButton>\n\n    </div>\n  );\n}\nexport default AuthMenuComponent;","import React from 'react';\nimport {\n  IonIcon,\n  IonHeader,\n  IonToolbar,\n  IonTitle,\n  IonContent,\n  IonPage\n} from \"@ionic/react\";\nimport { logIn} from 'ionicons/icons';\nimport MyForm, { getValidator, FormItem, getFormOptions } from '../../forms/myForm';\nimport { authService } from '../authService';\nimport { useLocation, useHistory } from 'react-router';\nimport AuthMenuComponent from './auth.menu.component';\nimport './auth.css';\n\nconst LoginPage  = () => {\n  const location = useLocation();\n  const history = useHistory();\n  const options = getFormOptions({\n    submitButtongText: \"Login\"\n  });\n  \n  const form: FormItem[] = [\n    {\n      id: 'id',\n      displayName: 'ID (Username or Email): ',\n      type: 'string',\n      validators: [\n        getValidator('isLength', {min:3, max:50}, 'ID needs to be between 3 to 50 characters')\n  \n      ],\n    },\n    {\n      id: 'password',\n      displayName: \"Password: \",\n      type: 'password',\n      validators: [\n        getValidator('isLength', {min:3, max:50}, 'ID needs to be between 3 to 50 characters')\n      ]\n    },\n    \n  ]\n  \n  const submit = async (form) => {\n    authService.loginAndRedirect(\n        form['id'].value, \n        form['password'].value,\n        history,\n        location);\n  }\n\n\n\n  return (\n    <IonPage>\n      <IonHeader>\n        <IonToolbar color=\"primary\">\n          <IonTitle>Login</IonTitle>\n        </IonToolbar>\n      </IonHeader>\n      <IonContent>\n        <div style={{paddingTop:'50px'}} className=\"ion-text-center\">\n          <IonIcon icon={logIn} color=\"primary\" className=\"iconFormCenter\" />\n        </div>\n        <AuthMenuComponent page=\"login\" />\n        <div style={{padding:'20px'}}>\n          <MyForm  items={form} options={options} submitFunction={submit} /> \n        </div>\n      </IonContent>\n    </IonPage>\n  );\n};\n\nexport default LoginPage;\n","import React, {  } from 'react';\n\nimport {\n  IonIcon,\n  IonHeader,\n  IonToolbar,\n  IonTitle,\n  IonContent,\n  IonPage\n} from \"@ionic/react\";\nimport { logIn} from 'ionicons/icons';\nimport MyForm, { getValidator, FormItem, getFormOptions } from '../../forms/myForm';\nimport { authService } from '../authService';\nimport { useLocation, useHistory } from 'react-router';\nimport AuthMenuComponent from './auth.menu.component';\nimport './auth.css';\n\nconst RegisterPage  = () => {\n  const location = useLocation();\n  const history = useHistory();\n  const options = getFormOptions({\n    submitButtongText: \"Login\"\n  });\n  \n  const form: FormItem[] = [\n    {\n      id: 'username',\n      displayName: 'Username: ',\n      type: 'string',\n      validators: [\n        getValidator('isLength', {min:3, max:20}, 'Username needs to be between 3 to 20 characters')\n  \n      ],\n    },\n    {\n      id: 'email',\n      displayName: 'Email: ',\n      type: 'string',\n      validators: [\n        getValidator('isEmail',{}, 'Email is not valid')\n  \n      ],\n    },\n    {\n      id: 'password',\n      displayName: \"Password: \",\n      type: 'password',\n      validators: [\n        getValidator('isLength', {min:3, max:50}, 'Password needs to be between 3 to 50 characters')\n      ]\n    },\n    \n  ]\n  \n  const submit = async (form) => {\n    const res = await authService.register(\n                        form['username'].value, \n                        form['email'].value,\n                        form['password'].value);\n    if(res){\n      authService.loginAndRedirect(\n                        form['username'].value, \n                        form['password'].value,\n                        history,\n                        location)\n    }\n  }\n\n  return (\n    <IonPage>\n      <IonHeader>\n        <IonToolbar color=\"primary\">\n          <IonTitle>Register</IonTitle>\n        </IonToolbar>\n      </IonHeader>\n      <IonContent>\n        <div style={{paddingTop:'50px'}} className=\"ion-text-center\">\n          <IonIcon  color=\"primary\"\n                    icon={logIn} \n                    className=\"iconFormCenter\" />\n        </div>\n        <AuthMenuComponent page=\"register\" />\n        <div style={{padding:'20px'}}>\n          <MyForm  items={form} options={options} submitFunction={submit} /> \n        </div>\n\n        \n      </IonContent>\n    </IonPage>\n  );\n};\n\nexport default RegisterPage;\n","import React, { FunctionComponent } from \"react\";\nimport { Route, Redirect, useLocation } from \"react-router-dom\";\nimport LoginPage from './components/login.page';\nimport RegisterPage from './components/register.page';\n\n\nconst UnauthenticatedRoute = ({ exact, path }: \n  { component: FunctionComponent<{}>, exact: boolean, path: string }) => {\n\n  \n  const location = useLocation();\n  // const history = useHistory();\n  // const params = useParams();\n  // const path = location.pathname;\n  \n  // console.log(\"Location:::: \", location);\n  // console.log('HISTORY:::: ', history);\n  // console.log('PARAMS:::: ', params);\n\n\n  const getRoute = () => {\n    if(location.pathname === '/auth/register'){\n      return <Route path={path} \n                    component={RegisterPage} \n                    exact={exact} />;\n    }\n    else if(location.pathname === '/auth/login'){\n      return <Route\n                path='/auth/login'\n                render={() => <LoginPage />}\n              />\n    }\n    else {\n      return <Redirect to={{\n              pathname: \"/auth/login\",\n              state: {prev: location.pathname}\n            }}/>;\n    }\n  }\n  \n\n  return (\n    getRoute()\n  );\n}\n\n\n\n\n\n/*\n\n\n\n\nconst  PrivateRoute = ({ component: Component, ...rest }) => {\n\n  const [authenticated] = useUserFacade();\n  //const location = useLocation();\n\n  //console.log(location);\n\n\n  return (\n    <Route\n      {...rest}\n      render={props =>\n        authenticated ? (\n          <Component {...props} />\n        ) : (\n          <Redirect\n            to={{ pathname: \"/auth/login\"}}\n          />\n        )\n      }\n    />\n  );\n}\n*/\nexport default UnauthenticatedRoute;","\nimport { Habit, habitStage, TYPE_HABBIT } from './models';\nimport { BehaviorSubject, Subscription } from 'rxjs';\nimport { dataService } from '../../modules/data/dataService';\nimport { saveIntoArray, isThisUserProject } from '../../modules/data/utilsData';\nimport { ProjectItem } from '../../modules/data/models';\nimport { gamifyService } from '../../modules/gamify/gamifyService';\nimport _ from 'lodash';\nimport { authService } from '../../modules/auth/authService';\nimport ulog from 'ulog';\n\nconst log = ulog('habits');\n\nexport interface habitsState {\n  selected: Habit | null,\n  habits: Habit[],\n  stageFilter: habitStage\n}\n\nexport const getInitHabitsState = (): habitsState => {\n  return {\n    selected: null,\n    habits: [],\n    stageFilter: habitStage.current\n  }\n}\n\nexport class HabitsService {\n\n  // @ts-ignore:  we force init later on in init function\n  private _project: ProjectItem;\n  public getProject():ProjectItem {return this._project}\n  private _state: habitsState = getInitHabitsState();\n\n  public state$ = new BehaviorSubject(this._state);\n\n  private _docs: Habit[] = [];\n\n  public docs$ = new BehaviorSubject(this._docs);\n\n  private _subscription: Array<Subscription> = [];\n\n  public init(project: ProjectItem) {\n    const dataSub = dataService.getReadySub().subscribe(async (ready) => {\n      if (!ready) return;\n      const equals = _.isEqual(project, this._project);\n      if (equals) return;\n\n      await this._init(project);\n\n      dataSub.unsubscribe();\n    });\n\n  }\n\n  async _init(project: ProjectItem) {\n    if (this._project && this._project.id === project.id) return;\n    this._project = project;\n    this._docs = await dataService.getAllByProject(project.id, TYPE_HABBIT);\n    this.filterhabits();\n\n    //manage changes\n\n    const sub = dataService.subscribeProjectTypeChanges(project.id, TYPE_HABBIT)\n      .subscribe(doc => {\n        if (doc.deleted)\n          this._docs = this._docs.filter(d => d.id !== doc.id);\n        else {\n          this._docs = saveIntoArray(doc, this._docs);\n        }\n        this.filterhabits();\n        //TODO: need to optimize this, maybe start using the view query, see bottom of file\n      });\n    this._subscription.push(sub);\n  }\n\n\n\n  private filterhabits() {\n    const filtered = this._docs.filter(doc => this.filterFunction(doc));\n    this.state = { ...this._state, ...{ habits: filtered } };\n  }\n\n  private filterFunction(doc: Habit) {\n    return (doc.stage === this._state.stageFilter)\n  }\n\n\n\n  public get state(): habitsState {\n    return this._state;\n  }\n  public set state(value: habitsState) {\n    this._state = value;\n    this.state$.next(this._state);\n}\n\n  public get docs(): Habit[] {\n    return this._docs;\n  }\n  public set docs(value: Habit[]) {\n    this._docs = value;\n    this.docs$.next(this._docs);\n  }\n\n\n\n  public save(doc: Habit) {\n    log.info(\"Save: \", doc, this._project, TYPE_HABBIT);\n\n    //check if its new, no id, its noew\n    if (!doc.id) {\n      if(isThisUserProject(this._project.id, authService.getUser().id)){\n        doc = Object.assign(gamifyService.calculateNewHabitRewards(doc));\n        return dataService.save({ ...{ done: false }, ...doc }, TYPE_HABBIT, { projectid: this._project.id });\n      }\n      else {\n\n      }\n    }\n    else\n      dataService.save({ ...{ done: false }, ...doc }, TYPE_HABBIT, { projectid: this._project.id });\n  }\n\n  public remove(id: string) {\n    dataService.remove(id, TYPE_HABBIT);\n  }\n\n  public select(doc: Habit) {\n    this.state = { ...this._state, ...{ selected: doc } };\n  }\n\n  public changeStageFilter(stage: habitStage) {\n    if (stage === this._state.stageFilter) return;\n    this._state = { ...this._state, ...{ stageFilter: stage } };\n    this.filterhabits();\n\n  }\n\n\n  public unsubscribe() {\n    if (!this) return;\n    this._subscription.forEach(sub => {\n      if (sub)\n        sub.unsubscribe();\n    });\n  }\n\n}\n","import React, { useState, useEffect } from 'react';\nimport { IonItem, IonCard, IonCardHeader, IonCardTitle, IonIcon, IonFab, IonFabButton, IonCardContent, IonGrid, IonRow, IonCol, IonNote, IonBadge, IonLabel } from '@ionic/react';\nimport { COLOR_LIGHT, COLOR_DARK, COLOR_SUCCESS, COLOR_DANGER } from '../../colors';\nimport { radioButtonOff, checkmarkCircleOutline, cog } from '../../../node_modules/ionicons/icons';\nimport moment from 'moment';\nimport { Habit, MOMENT_DATE_FORMAT, HabitAction } from './models';\nimport { habitDataFunctions } from './hooks/habits.hook';\nimport './Habit.listitem.component.css';\nimport { calculateCurrentStreak } from './utilsHabits';\nimport { gamifyService } from '../../modules/gamify/gamifyService';\n\n\n\nconst HabitListItemComponent = ({habit, dataFunctions, showEditModalFunction}:\n  {habit:Habit, dataFunctions: habitDataFunctions, showEditModalFunction:{(habit: Habit)}}) => {\n\n  const [doc, setDoc] = useState(new Habit(habit));\n\n  useEffect(() => {\n    setDoc(habit);\n  }, [habit])\n\n\n  const printDate = (index:number, active = false) => {\n    const day =  moment().subtract(index, 'day');\n    if(active)\n    {\n      return (\n        <IonLabel\n          color=\"primary\"\n        >\n        {day.format('DD')} <br /> {day.format('dd')}\n        </IonLabel>)\n    }\n    return (\n      <>\n      {day.format('DD')} <br /> {day.format('dd')}\n      </>)\n  }\n\n  const printGoal = () => {\n    if(doc.regularityInterval === 'day'){\n      return (\n        <IonItem>\n              <IonNote>\n                Remember, you promised that you will repeat \n                this habit <strong>every day</strong>.\n              </IonNote>\n        </IonItem>\n      )\n    }\n    \n    return (\n      <IonItem>\n        <IonNote>\n          Remember you promised that you will repeat this habit \n          <strong> {doc.regularityIntervalGoal} times {doc.regularityInterval}</strong>\n        </IonNote>\n      </IonItem>\n    )\n  }\n\n\n\n\n  const printDayIcon = (index: number, active=false) => {\n    const day = moment().subtract(index, 'day');\n    let action = doc.actions[day.format(MOMENT_DATE_FORMAT)];\n    if(!action)\n      action = {date: day.format(MOMENT_DATE_FORMAT), value: 0};\n\n    \n    if(active){\n      return (<IonIcon  onClick={() => updatehabit(action)}\n                      size=\"large\" \n                      key={index}\n                      color={ action.value > 0? COLOR_SUCCESS:  COLOR_DARK } \n                      icon={ action.value > 0? checkmarkCircleOutline : radioButtonOff } />)\n    }\n    // @ts-ignore: undefined, but we are forsing assignment just before this\n    return (<IonIcon  \n                      size=\"large\" \n                      key={index}\n                      color={ action.value > 0? COLOR_SUCCESS:  COLOR_DANGER } \n                      icon={ action.value > 0? checkmarkCircleOutline : radioButtonOff } />)\n\n    \n  }\n\n  const updatehabit = (action: HabitAction) => {\n    const {habit, rewards} = calculateCurrentStreak(doc, [action])\n    gamifyService.addRewards(rewards);\n    dataFunctions.save(habit);\n  }\n\n  const print = () => {\n    return (\n        <IonCard>\n          <IonCardHeader>\n            {/*<IonCardSubtitle>Card Subtitle</IonCardSubtitle>*/}\n            <IonCardTitle>{doc.name}</IonCardTitle>\n            <IonBadge class=\"habitBadge\" color=\"success\">{doc.currentStreak}</IonBadge>\n            <IonBadge class=\"habitBadge\" color=\"tertiary\">{doc.biggestStreak}</IonBadge>\n          </IonCardHeader>\n          <IonItem>\n            <IonGrid>\n              <IonRow class=\"datecell\">\n                <IonCol>{printDate(6)}</IonCol>\n                <IonCol>{printDate(5)}</IonCol>\n                <IonCol>{printDate(4)}</IonCol>\n                <IonCol>{printDate(3)}</IonCol>\n                <IonCol>{printDate(2)}</IonCol>\n                <IonCol>{printDate(1)}</IonCol>\n                <IonCol>{printDate(0, true)}</IonCol>\n              </IonRow>\n              <IonRow class=\"datecell\">\n                <IonCol>{printDayIcon(6)}</IonCol>\n                <IonCol>{printDayIcon(5)}</IonCol>\n                <IonCol>{printDayIcon(4)}</IonCol>\n                <IonCol>{printDayIcon(3)}</IonCol>\n                <IonCol>{printDayIcon(2)}</IonCol>\n                <IonCol>{printDayIcon(1)}</IonCol>\n                <IonCol>{printDayIcon(0, true)}</IonCol>\n              </IonRow>\n            </IonGrid>\n          </IonItem>\n          <IonCardContent>\n            {printGoal()}\n          </IonCardContent>\n          <IonFab horizontal=\"end\" vertical=\"bottom\" edge>\n            <IonFabButton size=\"small\" color={COLOR_LIGHT} onClick={() => showEditModalFunction(doc)}>\n              <IonIcon size=\"large\" icon={cog} />\n            </IonFabButton>\n          </IonFab>\n        </IonCard>\n    );\n  }\n  \n  return print();\n};\n\nexport default HabitListItemComponent;\n\n","import React, { useState } from 'react';\nimport { IonItem, IonLabel, IonIcon, IonInput, IonTextarea, IonButton, IonHeader, IonTitle, IonToolbar, IonContent, IonFooter, IonButtons, IonSelect, IonSelectOption, IonRange, IonFab, IonFabButton, IonAlert, IonSegment, IonSegmentButton } from '@ionic/react';\nimport { trash } from '../../../node_modules/ionicons/icons';\nimport { Habit, habitIntervals, habitDifficulty, printDifficulty } from './models';\nimport { capitalize } from '../../utils';\nimport { COLOR_DANGER } from '../../colors';\n\n\n\ninterface habitState {\n  regularity: {\n    interval: habitIntervals,\n    min: number,\n    max: number,\n  }\n  doc: Habit,\n  showDeleteWarrning: boolean\n}\n\nconst getRegularityValues = (interval: habitIntervals) => {\n  switch (interval) {\n    case habitIntervals.day:\n      return {interval: interval, min:1, max: 1}\n    case habitIntervals.week:\n      return {interval: interval, min:1, max: 6}\n    case habitIntervals.month:\n      return {interval: interval, min:1, max: 25}\n  }\n}\n\nconst HabitAddComponent = ({habit, dismissFunc}:\n  {habit:Habit, dismissFunc: {(habit:Habit|null, action: 'save'|'remove'|'none')}}) => {\n  \n    const getDefaultRegularityState: habitState = {\n    regularity: getRegularityValues(habit.regularityInterval),\n    doc: new Habit(),\n    showDeleteWarrning: false\n  }\n\n  const [state, setState] = useState<habitState>({...getDefaultRegularityState, ...{doc: habit}});\n\n  const handleChange = (e) => {\n    const newDoc = {...state.doc, ...{[e.target.name]:e.detail.value}}\n    const newState = {...state, ...{doc: newDoc}};\n    setState(newState);\n  }\n\n  const handlerRegularityValue = (e) => {\n    const newDoc = {...state.doc, ...{regularityIntervalGoal: e.detail.value}};\n    setState({...state, ...{doc: newDoc}});\n  }\n\n  const handlerRegularityIntervalChange = (value) => {\n    value = value || 'day';\n    const newDoc = {...state.doc, ...{regularityInterval: value, regularityIntervalGoal: 1}};\n    const newReg = {...state.regularity, ...getRegularityValues(value)};\n    setState({...state, ...{doc:newDoc, regularity: newReg}});\n  }\n\n  const printRegularityLabel = () => {\n\n    const times = (state.doc.regularityIntervalGoal > 1)? ' times a ': ' time a ';\n    if(state.doc.regularityInterval === 'day'){\n      return 'I will repeat this habit every day.'\n    }\n    \n    return 'I will repeat this habit ' +state.doc.regularityIntervalGoal + times + state.doc.regularityInterval\n  }\n\n  const handleDifficultyChange = (e) => {\n    const newDoc = {...state.doc, ...{difficulty: e.detail.value}};\n    setState({...state, ...{doc: newDoc}});\n  }\n\n  const printDifficultyLabel = (hab: habitDifficulty): string => {\n    switch(hab) {\n      case habitDifficulty.trivial:\n        return 'Easy peasy lemon squeezy';\n      case habitDifficulty.easy:\n        return 'Piece of Cake';\n      case habitDifficulty.medium:\n        return \"Let's Rock\";\n      case habitDifficulty.hard:\n        return 'No Pain, No Gain';\n      case habitDifficulty.extreme:\n        return 'Death Wish';\n    }\n  }\n\n  const showRemoveWarrning = () => {\n    setState({...state, ...{showDeleteWarrning: true}});\n  }\n\n  const hideRemoveWarrning = () => {\n    setState({...state, ...{showDeleteWarrning: false}});\n  }\n\n  const removehabit = () => {\n    hideRemoveWarrning();\n    dismissFunc(state.doc, 'remove');\n  }\n\n\n\n  const print = () => {\n      return (\n      <>\n        <IonHeader>\n          <IonToolbar>\n            {/*\n            <IonButtons slot=\"start\">\n              <IonButton> <IonIcon size=\"large\" icon={arrowBack} /></IonButton>\n            </IonButtons>\n            */}\n            <IonTitle>Add Habit</IonTitle>\n          </IonToolbar>\n        </IonHeader>\n        <IonContent>\n          <IonItem>\n              <IonLabel position=\"floating\">Name</IonLabel>\n              <IonInput \n                  name=\"name\"\n                  placeholder=\"Read book, Go running ...\" \n                  onIonChange={handleChange}\n                  value={state.doc.name} />\n          </IonItem>\n          <IonItem>\n              <IonLabel position=\"floating\">Note</IonLabel>\n              <IonTextarea \n                  placeholder=\"Enter more information here, motivate yourself...\"\n                  name=\"note\"\n                  onIonChange={handleChange}\n                  value={state.doc.note}></IonTextarea>\n          </IonItem>\n          <IonItem>\n            <IonSegment value={state.doc.regularityInterval}\n                        onIonChange={(e) => handlerRegularityIntervalChange(e.detail.value)}>\n              <IonSegmentButton value=\"day\">\n                <IonLabel>Daily</IonLabel>\n              </IonSegmentButton>\n              <IonSegmentButton value=\"week\">\n                <IonLabel>Weekly</IonLabel>\n              </IonSegmentButton>\n              <IonSegmentButton value=\"month\">\n                <IonLabel>Monthly</IonLabel>\n              </IonSegmentButton>\n            </IonSegment>\n          </IonItem>\n\n          {(state.doc.regularityInterval !== 'day')? (\n            <>\n              <IonRange \n                    min={state.regularity.min}\n                    max={state.regularity.max}\n                    debounce={100}\n                    value={state.doc.regularityIntervalGoal}\n                    onIonChange={handlerRegularityValue}\n                    color=\"secondary\" >\n                <IonLabel slot=\"start\">{state.regularity.min}</IonLabel>\n                <IonLabel slot=\"end\">{state.regularity.max}</IonLabel>\n              </IonRange>\n            </>\n          ) : (\n          <></> )}\n          <IonItem>\n            <IonLabel>{printRegularityLabel()}</IonLabel>\n          </IonItem>\n\n          <IonRange min={0} \n                    max={4} \n                    debounce={100}\n                    value={state.doc.difficulty}\n                    onIonChange={handleDifficultyChange}\n                    color=\"secondary\">\n              <IonLabel slot=\"start\">{capitalize(printDifficulty(habitDifficulty.trivial))}</IonLabel>\n              <IonLabel slot=\"end\">{capitalize(printDifficulty(habitDifficulty.extreme))}</IonLabel>\n          </IonRange>\n\n          <IonItem>\n            <IonLabel>{printDifficultyLabel(state.doc.difficulty)}</IonLabel>\n          </IonItem>\n        </IonContent> \n\n        <IonFooter>\n          <IonToolbar>\n            <IonTitle>\n              <IonButton onClick={() => dismissFunc(state.doc, 'save')}>Save</IonButton>\n              <IonButton onClick={() => dismissFunc(null, 'none')}>Cancel</IonButton>\n            </IonTitle>\n          </IonToolbar>\n        </IonFooter>\n        <IonFab horizontal=\"end\" vertical=\"bottom\" >\n          <IonFabButton size=\"small\" color={COLOR_DANGER} onClick={() => showRemoveWarrning()}>\n            <IonIcon size=\"large\" icon={trash} />\n          </IonFabButton>\n        </IonFab>\n        <IonAlert\n          isOpen={state.showDeleteWarrning}\n          onDidDismiss={() => hideRemoveWarrning}\n          header={'Warrning!!!'}\n          message={'Are you sure you want to <strong>delete</strong> this habit?'}\n          buttons={[\n            {\n              text: 'Cancel',\n              role: 'cancel',\n              cssClass: 'secondary',\n              \n            },\n            {\n              text: 'Yes Im Sure',\n              handler: () => removehabit()\n            }\n          ]}\n        />\n      </>\n      );\n  }\n\n  return print();\n};\n\nexport default HabitAddComponent;\n","import React, { useReducer } from 'react';\nimport {\n  IonPage,\n  IonContent,\n  IonList,\n  IonFabButton,\n  IonFab,\n  IonIcon,\n  IonModal} from '@ionic/react';\n\nimport { add } from '../../../node_modules/ionicons/icons';\nimport { useHabitsCollectionFacade } from './hooks/habits.hook';\nimport { Habit } from './models';\nimport HabitListItemComponent from './Habit.listitem.component';\nimport HabitAddComponent from './Habit.add.component';\nimport HeaderWithProgress from '../../components/HeaderWithProgress';\nimport { authService } from '../../modules/auth/authService';\nimport { getDefaultProject } from '../../modules/data/utilsData';\n\n\nexport interface habitPageState {\n  showModal: boolean,\n  modalHabit: Habit|null,\n}\n\nconst reducer = (state, action): habitPageState => {\n  switch(action.type) {\n    case 'showModal':\n      return {...state, ...{showModal: action.data.showModal, modalHabit: action.data.habit} }\n    case 'hideModal':\n      return state;\n    default:\n      return state;\n  }\n}\n\nexport function getAction(todo:'showModal', data = {}){\n  return {type:todo, data:data};\n}\n\n\nconst HabitsPage: React.FC = () => {\n  const [habitsState, dataFunc] = useHabitsCollectionFacade(getDefaultProject(authService.userid));\n  const [state, dispatch] = useReducer(reducer, {\n    showModal:false,\n    modalHabit: null,\n  })\n\n  const { habits } = habitsState;\n\n  const addhabit = (habit:Habit = new Habit()) => {\n    dispatch(getAction('showModal', {showModal: true, habit}));\n  }\n\n  const hidehabitModal = () => {\n    dispatch(getAction('showModal', {showModal: false, habit: null}));\n  }\n\n  const habitDismissFunc = (habit: Habit|null, action:'save'|'remove'|'none') => {\n    dispatch(getAction('showModal', {showModal: false, habit: null}));\n    if(action === 'save' && habit != null){\n      dataFunc.save(habit);\n    }\n    else if(action === 'remove' && habit != null && habit.id){\n      dataFunc.remove(habit.id);\n    }\n  }\n\n\n  return (\n    <IonPage>\n      <HeaderWithProgress title=\"Habits\" />\n      <IonContent>\n        \n      <IonList>\n        {habits.map(habit => (\n              <HabitListItemComponent\n                        habit={habit} \n                        dataFunctions={dataFunc}\n                        key={habit.id} \n                        showEditModalFunction={addhabit}\n              />\n        ))}\n      </IonList>\n      {state.showModal? (\n        <IonModal isOpen={state.showModal} onDidDismiss={() => hidehabitModal()}>\n        <HabitAddComponent habit={state.modalHabit||new Habit()} \n                            dismissFunc = {habitDismissFunc}  />\n        </IonModal>\n      ) : (\n        <></>\n      )}\n      \n\n      <IonFab vertical=\"top\" horizontal=\"end\" slot=\"fixed\" edge>\n        <IonFabButton onClick={()=> addhabit()}>\n          <IonIcon icon={add} />\n        </IonFabButton>\n      </IonFab>\n      </IonContent>\n    </IonPage>\n  );\n};\n\nexport default HabitsPage;\n\n","import { useEffect, useState, useRef } from 'react';\nimport { Subscription } from 'rxjs';\nimport { ProjectItem } from '../../../modules/data/models';\nimport { Habit, habitStage } from '../models';\nimport { habitsState, getInitHabitsState,  HabitsService } from '../habits.service';\nimport _ from 'lodash';\n\nexport interface habitDataFunctions {\n  save: {(doc: Habit)},\n  remove: {(id: string)},\n  select: {(doc: Habit)},\n  changeStageFilter: {(stage: habitStage)}\n}\n\n\n//more simpler then auth hook, just read data\nexport function useHabitsCollectionFacade(project: ProjectItem): \n                                        [habitsState, habitDataFunctions]{\n\n  const [state, setState] = useState(getInitHabitsState());\n\n  const habitsService = useRef(new HabitsService());\n  \n          \n  const dataFunctions = {\n    save: (doc: Habit) => {\n      habitsService.current.save(doc)\n    },\n    remove: (id) => habitsService.current.remove(id), //TODO: allow user to choose, sync or not to sync\n    select: (doc: Habit) => habitsService.current.select(doc),\n    changeStageFilter: (stage: habitStage) => habitsService.current.changeStageFilter(stage),\n  }\n\n  useEffect(() => {\n    if(_.isEqual(habitsService.current.getProject(), project)) \n        return;\n    habitsService.current.init(project)\n\n    return habitsService.current.unsubscribe;\n  }, [project])\n\n  useEffect(() => {\n    const subscriptions: Subscription[] = [\n      habitsService.current.state$.subscribe(state => {\n        setState(state);\n      })\n    ];\n    return () => { subscriptions.map(it => it.unsubscribe()) };\n  },[project]);\n\n\n  return [state, dataFunctions];\n}","import React, {  } from 'react';\nimport { IonHeader } from '@ionic/react';\n\n\n\n\nconst MenuHeaderWithProgress = () => {\n\n  \n  return (\n    <IonHeader className=\"menuHeaderWithAvatar\">\n      \n      <h1>Menu</h1>\n    </IonHeader>\n  )\n}\n\nexport default MenuHeaderWithProgress;","import React, { useState } from 'react';\nimport { IonInput } from '@ionic/react';\nimport { ProjectItem } from '../../modules/data/models';\nimport { generateCollectionId, getProjectChildId } from '../../modules/data/utilsData';\nimport { TYPE_TODO_LIST, TodoList } from './models';\nimport ulog from 'ulog';\nimport { todoService } from './todo.service';\n\nconst log = ulog('todo');\n\n\nconst ListAddInlineComponent = ({projectid}:{projectid: string}) => {\n\n  const [state, setState] = useState({name:''});\n\n  const setNewTitle = (e) => {\n    setState({name: e.detail.value});\n  }\n  \n  const onKeyPress = (e) => {\n    if(e.key === 'Enter'){\n      save();\n      setState({name: ''});\n    }\n  }\n\n  const save = async () => {\n    const id = generateCollectionId(projectid, TYPE_TODO_LIST, encodeURI(state.name));\n    const newList = new TodoList({\n      id,\n      name: state.name,\n      secondaryType: TYPE_TODO_LIST,\n      //folder??\n      project: getProjectChildId(projectid),\n    })\n    newList._new = true;\n\n    log.info('NEW TODO LIST::::::::::::::: ', newList)\n    const res = await todoService.saveList(newList);\n    log.info(res);\n  };\n\n  return (\n    <IonInput\n      className=\"new-todo\"\n      placeholder=\"Add new List?\"\n      onKeyPress={onKeyPress}\n      onIonChange={setNewTitle}\n      value={state.name}\n    />\n  )\n}\n\nexport default ListAddInlineComponent;","import React, { useState } from 'react'\nimport { IonItem } from '@ionic/react'\nimport Lottie from 'react-lottie';\nimport sun from '../../icons/sun.json';\nimport star from '../../icons/star.json';\nimport './todo.menu.css';\n\nexport const waitMS = (ms: number) => {\n  return new Promise((resolve) => {\n    setTimeout(resolve, ms);\n  });\n};\n\nconst TodoMenuItemButtonComponet = ({name, color, icon, actonFunc}:\n  {name: string, icon: string, color:string, actonFunc:Function}) => {\n  \n  const [state, setState] = useState({isStopped:true, isPaused:true})\n  \n  \n  const defaultOptions = {\n    loop: true,\n    autoplay: true, \n    animationData: (icon === 'today')? sun : star,\n    rendererSettings: {\n      clearCanvas: true,\n      scaleMode: 'noScale',\n      preserveAspectRatio: 'xMidYMid slice'\n    }\n  }; \n  \n  const actionHandler = async() => {\n    setState({isStopped:false, isPaused:false});\n    actonFunc();\n\n    await waitMS(1000);\n    setState({isStopped:true, isPaused:true});\n  }\n  \n  \n  \n  return (\n    <IonItem  button \n        onClick={() => actionHandler()}\n        color={color}  \n        routerLink={encodeURI('/todos/tag/' + icon)} \n        routerDirection=\"none\"\n        lines=\"none\">\n    <div className =\"lottieicon\">\n      <Lottie  options={defaultOptions}\n          height={25}\n          width={25}\n          isStopped={state.isPaused}\n          isPaused={state.isStopped}/>\n    </div>\n    {name} \n</IonItem>\n  )\n}\n\nexport default TodoMenuItemButtonComponet","import React, { useReducer, useEffect } from 'react';\nimport ListAddInlineComponent from './list.inline.add.component';\nimport ulog from 'ulog';\nimport { TodoTag, TodoList, TYPE_TODO_LIST, TYPE_TODO_TAG } from './models';\nimport { dataService } from '../../modules/data/dataService';\nimport { saveIntoArray } from '../../modules/data/utilsData';\nimport { authService } from '../../modules/auth/authService';\nimport { IonList, IonItem, IonLabel, IonItemDivider, IonItemGroup, IonItemSliding, IonItemOptions, IonItemOption, IonAlert, IonIcon } from '@ionic/react';\nimport { useLocation } from 'react-router';\nimport { todoService } from './todo.service';\nimport TodoMenuItemButtonComponet from './todo.menu.item';\nimport { list } from 'ionicons/icons';\n\nconst log = ulog('todo');\n\nconst initialState:{\n  tags:TodoTag[],\n  tagsOpen: boolean\n  lists:TodoList[],\n  openLists: string[],\n  showDeleteListAlert: boolean,\n  deleteList: TodoList,\n} = {\n  tags:[],\n  tagsOpen: false,\n  lists:[],\n  openLists:[],\n  showDeleteListAlert: false,\n  deleteList: new TodoList(),\n}\n\nconst reducer =  (state = initialState, { type, payload }:{type:string, payload:any}) => {\n  switch (type) {\n\n    case 'hideDeleteAlert':\n      return { ...state, ...{ showDeleteListAlert: false} }\n\n    case 'showDeleteAlert': \n    return { ...state, ...{ showDeleteListAlert: true, deleteList: payload } }\n\n    case 'setTodoList': \n      if(payload.deleted)\n      return { ...state, ...{lists: state.lists.filter(l => l.id !== payload.id)} };\n      else\n        return { ...state, ...{lists: saveIntoArray(payload, state.lists)} };\n\n    case 'setTodoLists':\n      //find todos page\n      return { ...state, ...{ lists: payload } };\n    case 'setTags':\n      return {...state, ...{tags: payload}};\n    case 'setTag': \n      if(payload.deleted)\n        return { ...state, ...{tags: state.tags.filter(t => t.id !== payload.id)} };\n      else\n        return { ...state, ...{tags: saveIntoArray(payload, state.tags)\n                                    .sort((a,b) => (a.name > b.name)? 1 : -1)} };\n\n    default:\n      log.error('REDUCER GOT UNHANDLED TYPE ', type, payload);\n      return state\n  }\n}\n\n\nconst TodoMenuListComponent = ({projectid}: {projectid:string}) => {\n  const location = useLocation();\n  const path = location.pathname;\n  const [state, _dispatch] = useReducer(reducer, initialState)\n\n  const dispatch = (type: 'setTodoLists'|\n                          'setTags'|\n                          'setTag'|\n                          'hideDeleteAlert'|\n                          'showDeleteAlert'|\n                          'setTodoList', payload = {}) => {\n    _dispatch({type, payload});\n  }\n\n\n  useEffect(() => {\n    const subTodoList = dataService.subscribeProjectTypeChanges(\n      projectid, TYPE_TODO_LIST ).subscribe(change => {\n        log.info('Menu Change: ', change);\n        dispatch('setTodoList', change);\n      })\n    loadInitTodoLists(projectid);\n    const tagsList = dataService.subscribeByPropertyChange('type',\n      'todoTag' ).subscribe(change => {\n        log.info('Tags Changed: ', change);\n         dispatch('setTag', change);\n      })\n    loadInitTags();\n    return () => {\n      subTodoList.unsubscribe();\n      tagsList.unsubscribe();\n    };\n  // eslint-disable-next-line react-hooks/exhaustive-deps\n  }, [authService.userid])\n\n  const loadInitTodoLists = async (projectid:string) => {\n    const todolists = await dataService.getAllByProject(projectid,TYPE_TODO_LIST);\n    log.info(todolists);\n    dispatch('setTodoLists', todolists);\n  }\n\n  const loadInitTags = async () => {\n    const tags = await dataService.queryByProperty('name', 'startsWith', '', TYPE_TODO_TAG);\n    log.info(tags);\n    dispatch('setTags', tags);\n  }\n\n  const deleteList = () => {\n      todoService.deleteList(state.deleteList)\n  }\n\n\n  const tagButtonClickHandler = (tag) => {\n    console.log(tag);\n  }\n\n  return (\n    <IonList>\n      {/*}\n       <IonItem  button \n                color={(path ==='/todos/tag/today'? 'light' : '')}  \n                routerLink={encodeURI('/todos/tag/today')} \n                routerDirection=\"none\"\n                lines=\"none\">\n       \n              <IonIcon\n                size=\"large\"\n                src=\"assets/icons/sun.svg\"></IonIcon>\n            Today\n          </IonItem>\n      */}\n      <IonItemGroup key=\"listsGroup\">\n          <TodoMenuItemButtonComponet \n            name=\"Today\"\n            icon=\"today\"\n            color={(path ==='/todos/tag/today'? 'light' : '')}  \n            actonFunc = {() => tagButtonClickHandler('today')}\n          /> \n          <TodoMenuItemButtonComponet \n            name=\"Important\"\n            icon=\"important\"\n            color={(path ==='/todos/tag/important'? 'light' : '')}  \n            actonFunc = {() => tagButtonClickHandler('important')}\n          /> \n            \n          <IonItemGroup>\n            <h2>Lists</h2>\n          </IonItemGroup>    \n        {state.lists.map( listItem => (\n          <IonItemSliding key={listItem.name+'list'}>\n            <IonItem  button \n                      color={(path ==='/todos/'+listItem.name? 'light' : '')}  \n                      routerLink={encodeURI('/todos/'+listItem.name)} \n                      routerDirection=\"none\"\n                      lines=\"none\">\n              <IonLabel>\n                      <IonIcon  \n                        icon={list}/> \n                {' '+listItem.name}</IonLabel>\n            </IonItem>\n            <IonItemOptions side=\"end\">\n              <IonItemOption  color=\"danger\" \n                              onClick={() => dispatch('showDeleteAlert',list)}>\n                Delete</IonItemOption>\n            </IonItemOptions>\n          </IonItemSliding>\n        ))}\n      </IonItemGroup>\n      <IonItemDivider>\n      </IonItemDivider>\n      <ListAddInlineComponent key=\"addNewItem\" projectid={projectid} />\n\n      <IonItemGroup>\n        <h2>Tags</h2>\n      </IonItemGroup>\n      {state.tags.filter(tag => (tag.name !== 'today' && tag.name !== 'important'))\n        .map( tagItem => (\n          <IonItemSliding key={tagItem.name+'tag'}>\n            <IonItem  button \n                      color={(path ==='/todos/tag/'+tagItem.name? 'light' : '')}  \n                      routerLink={encodeURI('/todos/tag/'+tagItem.name)} \n                      routerDirection=\"none\"\n                      lines=\"none\">\n              <IonLabel>\n                      <IonIcon  \n                        src={\"/assets/icons/tag.svg\"} /> \n                {' '+tagItem.name}</IonLabel>\n            </IonItem>\n            <IonItemOptions side=\"end\">\n              <IonItemOption  color=\"danger\" \n                              onClick={() => {console.log('No delete implemented')} }>\n                Delete</IonItemOption>\n            </IonItemOptions>\n          </IonItemSliding>\n        ))}\n\n      <IonAlert \n        isOpen={state.showDeleteListAlert}\n        onDidDismiss={() => dispatch('hideDeleteAlert')}\n        header={\"Are you sure you want to delete '\" + state.deleteList.name + \"' list?\"}\n        subHeader={'All tasks in this list will be deleted'}\n        buttons={[\n          {\n            text: 'Cancel',\n            role: 'cancel',\n            cssClass: 'secondary',\n            handler: () => dispatch('hideDeleteAlert')\n          },\n          {\n            text: 'Delete List',\n            handler: () => deleteList()\n          }\n        ]}\n      />\n    </IonList>\n  )\n\n\n\n}\n\nexport default TodoMenuListComponent;","import React, { useReducer, useEffect } from 'react';\nimport { home, apps, sunny, star, heart, basket, construct, bonfire, checkmark, refresh } from 'ionicons/icons';\nimport { getDefaultProject } from '../../data/utilsData';\nimport { authService } from '../../auth/authService';\nimport ulog from 'ulog';\nimport TodoMenuListComponent from '../../../pages/todo/todo.menulist.component';\n\nconst log = ulog('menu');\n\nexport interface AppPage {\n  url: string;\n  icon: any;\n  title: string;\n  lastComponent?: any;\n}\n\n\nexport interface MenuFunctions {\n\n}\n\nexport interface MenuState {\n  projectid: string,\n  appPages: AppPage[];\n}\n\nexport const todoTags: AppPage[] = [\n  {\n    title: 'Today',\n    url: '/todos/today',\n    icon: sunny,\n  },\n  {\n    title: 'Important',\n    url: '/todos/important',\n    icon: star,\n  },\n  {\n    title: 'Important',\n    url: '/todos/tasksmain33mmm',\n    icon: checkmark,\n  },\n  {\n    title: 'Whish List',\n    url: '/todos/whish',\n    icon: heart,\n  },\n  {\n    title: 'Buy',\n    url: '/todos/buy',\n    icon: basket,\n  },\n  {\n    title: 'Projects',\n    url: '/todos/projects',\n    icon: construct,\n  },\n]\n\nexport const getMenuState = (projectid: string): MenuState => {\n  return {\n    projectid,\n    appPages: [\n      {\n        title: 'Home',\n        url: '/home',\n        icon: home,\n      },\n      {\n        title: 'Habits',\n        url: '/habits',\n        icon: refresh,\n      },\n      {\n        title: 'Parties',\n        url: '/parties',\n        icon: bonfire,\n      },\n      {\n        title: 'Todos',\n        url: '/todos',\n        icon: apps,\n        lastComponent: <TodoMenuListComponent projectid={projectid}  />\n      }\n    ]\n  }\n};\n\n\nconst reducer = (state, { type, payload }:{type:string, payload:any}):MenuState => {\n  switch (type) {\n  case 'authChange':\n    return getMenuState(getDefaultProject(authService.userid).id);\n  default:\n    log.error('REDUCER GOT UNHANDLED TYPE ', type, payload);\n    return state\n  }\n}\n\n\n\n//more simpler then auth hook, just read data\nexport function useMenuHookFacade(): [MenuState, MenuFunctions] {\n  const project = getDefaultProject(authService.userid);\n  const [state, _dispatch] = useReducer(reducer, getMenuState(project.id))\n\n  useEffect(() => {\n    const sub = authService.username$.subscribe(name => {\n      _dispatch({type: 'authChange', payload: authService.userid});\n    })\n   \n    return () => {sub.unsubscribe()};\n  }, [])\n          \n  const menuFunctions: MenuFunctions = {\n  }\n\n  \n\n\n  return [state, menuFunctions];\n}","import {\n  IonContent,\n  IonIcon,\n  IonItem,\n  IonLabel,\n  IonMenu,\n  IonMenuToggle,\n  IonGrid,\n  IonCol,\n  IonRow\n} from '@ionic/react';\nimport React from 'react';\nimport { withRouter, useLocation } from 'react-router-dom';\nimport MenuHeaderWithProgress from './MenuHeaderWithProgress';\nimport { useMenuHookFacade } from '../modules/menu/hooks/menu.hook';\nimport './menu.css';\nimport ulog from 'ulog'\n\nconst log = ulog('menu')\n\nconst Menu = () => {\n\n  const [state,] = useMenuHookFacade();\n  const location = useLocation();\n  const path = location.pathname;\n  log.warn(path);\n  return (\n    <IonMenu key=\"ionmenu_left\" contentId=\"main\" type=\"overlay\">\n      <MenuHeaderWithProgress key=\"menu_header\" />\n      <IonContent key=\"menu_left\" >\n        <IonGrid>\n        {state.appPages.map((appPage, index) => {\n          return (\n            <>\n              <IonRow key={appPage.title.replace(' ', '')+appPage.url + index}>\n                <IonCol class=\"leftMenuCol\">\n                <IonMenuToggle  autoHide={false}>\n                  <IonItem\n                        color={(path === appPage.url? 'light' : '')}   \n                        routerLink={appPage.url} routerDirection=\"none\">\n                    <IonIcon slot=\"start\" icon={appPage.icon} />\n                    <IonLabel>{appPage.title}</IonLabel>\n                  </IonItem>\n                </IonMenuToggle>\n                </IonCol>\n              </IonRow>\n              {appPage.lastComponent? (\n                appPage.lastComponent\n              ) : (<></>)}\n            </>\n        )})}\n        </IonGrid>\n      </IonContent>\n    </IonMenu>\n)};\n\nexport default withRouter(Menu);\n","import React, { useState } from 'react';\nimport { PartyProject } from '../models';\nimport { IonHeader, IonToolbar, IonTitle, IonContent, IonItem, \n  IonInput, IonLabel, IonTextarea, IonFooter, IonButton } from '@ionic/react';\n\n\n\n\n\nconst PartyEditComponent = ({party, dismissFunc}:\n    {party: PartyProject| null, dismissFunc:{(party: PartyProject|null, action: 'save'| 'remove' | 'none')}}) => {\n\n  const [state, setState] = useState({party: party||new PartyProject()})\n\n\n  const handleChange = (e) => {\n    const newDoc = {...state.party, ...{[e.target.name]:e.detail.value}}\n    const newState = {...state, ...{party: newDoc}};\n    setState(newState);\n  }\n\n\n  return (\n    <>\n      <IonHeader>\n            <IonToolbar>\n              <IonTitle>Add/Edit Party</IonTitle>\n            </IonToolbar>\n      </IonHeader>\n      <IonContent>\n          <IonItem>\n                <IonLabel position=\"floating\">Name</IonLabel>\n                <IonInput \n                    name=\"name\"\n                    placeholder=\"Your Cool Party Name\" \n                    onIonChange={handleChange}\n                    value={state.party.name} />\n            </IonItem>\n            <IonItem>\n                <IonLabel position=\"floating\">Note</IonLabel>\n                <IonTextarea \n                    placeholder=\"More details for your party members\"\n                    name=\"note\"\n                    onIonChange={handleChange}\n                    value={state.party.note}></IonTextarea>\n            </IonItem>\n            <IonFooter>\n              <IonToolbar>\n                <IonTitle>\n                  <IonButton onClick={() => dismissFunc(state.party, 'save')}>Save</IonButton>\n                  <IonButton onClick={() => dismissFunc(null, 'none')}>Cancel</IonButton>\n                </IonTitle>\n              </IonToolbar>\n            </IonFooter>\n      </IonContent>\n    </>\n  );\n}\n\nexport default PartyEditComponent;","import React, { useState, useEffect, useReducer } from 'react';\nimport { PartyProject } from '../models';\nimport { IonCard, IonCardHeader, IonCardTitle, IonCardSubtitle, IonBadge } from '@ionic/react';\nimport { useHistory } from '../../../../node_modules/@types/react-router';\n\n\nconst PartyListItemComponent = ({partyProject, history,  showEditModalFunction}:\n          {partyProject:PartyProject, history, showEditModalFunction:{(party: PartyProject)}}) => {\n\n  const [state, setState] = useState({party: partyProject})\n\n  useEffect(() => {\n    setState({...state, ...{party:partyProject}});\n  }, [partyProject])\n\n  return(\n    <IonCard>\n      <IonCardHeader onClick={() => history.push('/parties/'+ encodeURI(state.party.id||''))}>\n        <IonCardTitle>{state.party.name} \n              <IonBadge>{state.party.members.length}</IonBadge></IonCardTitle>\n        <IonCardSubtitle>{state.party.note}</IonCardSubtitle>\n      </IonCardHeader>\n    </IonCard>\n  )\n\n\n} \n\nexport default PartyListItemComponent;\n\n\n","import React, { useEffect, useReducer } from 'react';\nimport {\n  IonPage,\n  IonContent,\n  IonList,\n  IonCard,\n  IonCardHeader,\n  IonCardTitle,\n  IonCardSubtitle,\n  IonCardContent,\n  IonLabel,\n  IonButton,\n  IonModal,\n  IonItem} from '@ionic/react';\nimport HeaderWithProgress from '../../../components/HeaderWithProgress';\nimport { authService } from '../../auth/authService';\nimport { PartyProject } from '../models';\nimport PartyEditComponent from '../components/Party.edit.component';\nimport { partyService } from '../party.service';\nimport PartyListItemComponent from '../components/Party.listitem.component';\nimport { useHistory } from 'react-router-dom';\nimport ulog from 'ulog';\n\nconst log = ulog('parties');\n\n\n\nexport interface PartiesState {\n  userId: string,\n  showModal: boolean,\n  party: PartyProject|null\n  docs: PartyProject[],\n}\nconst reducer = (state, action:{type:string, data:any}): PartiesState => {\n  switch(action.type) {\n    case 'dismissEdit':\n      return {...state, ...{showModal: false, party: null}}\n    case 'edit':\n      return {...state, ...{showModal: true, party: action.data}}\n    case 'docs':\n      return {...state, ...{docs:action.data}};\n    case 'userid': \n      return {...state, ...{userId: action.data}};\n    default:\n      log.error('ERROR, INCORRECT ACTION TYPE ', action);\n      return state;\n  }\n}\n\n\n\nconst PartiesPage = () => {\n  const history = useHistory();\n  const [state, _dispatch] = useReducer(reducer, {\n    userId: '',\n    showModal: false,\n    party: new PartyProject(),\n    docs: [],\n  })\n\n  const dispatch = (type: 'userid'|\n                          'dismissEdit'|\n                          'edit'|\n                          'docs', data:any = null) => {\n      _dispatch({type, data});                      \n  }\n\n  useEffect(() => {\n    const subs = [\n      authService.username$.subscribe(username => {\n        dispatch('userid', authService.userid);\n      }),\n      partyService.state$.subscribe(changes => {\n        dispatch('docs', changes.docs);\n      }),\n\n    ]\n    return () => {\n      subs.forEach(sub => {\n        if(sub) sub.unsubscribe();\n      });\n    };\n    // eslint-disable-next-line\n  }, [])\n\n  const editParty = (party:PartyProject = new PartyProject()) => {\n    dispatch('edit', party);\n  }\n\n\n  const modalDismissFunc = (party: PartyProject|null, action:'save'|'remove'|'none') => {\n    dispatch('dismissEdit')\n    if(action === 'save' && party != null){\n      partyService.saveParty(party)\n    }\n    else if(action === 'remove' && party != null && party.id){\n      //dataFunc.remove(habit._id);\n    }\n  }\n\n  const hideModal = () => {\n    dispatch('dismissEdit');\n  }\n\n  return (\n    <IonPage>\n      <HeaderWithProgress title=\"Parties\" />\n      <IonContent>\n        {state.showModal? (\n          <IonModal isOpen={state.showModal} onDidDismiss={() => hideModal()}>\n            <PartyEditComponent party={state.party} \n                                dismissFunc = {modalDismissFunc}  />\n          </IonModal>\n        ) : (\n          <></>\n        )}\n        <IonCard>\n          <IonCardHeader>\n            <IonCardTitle>\n              Here you can join friends to conquer those tasks together.\n            </IonCardTitle>\n            <IonCardSubtitle>\n              \n            </IonCardSubtitle>\n          </IonCardHeader>\n          <IonCardContent>\n            <IonLabel>\n              Create your party to go on quests and challenge your friends.\n            </IonLabel>\n            <IonButton onClick={() =>editParty()} >Create Party</IonButton>\n            <br></br><br></br><br></br>\n            <IonLabel>\n              Join your friends party, give them your code: <strong>{state.userId}</strong>\n            </IonLabel>\n            \n          </IonCardContent>\n        </IonCard>\n      <IonList>\n        {state.docs.map(party => (\n          <PartyListItemComponent partyProject={party} \n                                  history={history}\n                                  key={party.id}\n                                  showEditModalFunction={editParty} />\n        ))}  \n      </IonList>\n      <IonItem>\n        <IonLabel>To join a party, you can give part leader your id: {state.userId} </IonLabel>\n      </IonItem>\n      \n      </IonContent>\n    </IonPage>\n  );\n};\n\nexport default PartiesPage;\n\n","import React from 'react';\nimport { PartyMember, ChallengeMember } from '../models';\nimport { IonBadge } from '@ionic/react';\nimport { COLOR_LIGHT, COLOR_SUCCESS } from '../../../colors';\nimport moment from 'moment';\nimport { MOMENT_DATE_FORMAT } from '../../../pages/habits/models';\nimport './challenge.css';\n\n\nconst ChallengeMemberScoreHistory = ({member}:\n  {member: PartyMember|ChallengeMember}) => {\n\n\n const printDay = (dateString) => {\n  const score = member.scoreHistory[dateString];\n  let color = COLOR_LIGHT;\n  let exp = 0;\n  if(score){\n    color = COLOR_SUCCESS;\n    exp = score.exp;\n  }\n\n  return <IonBadge class=\"scoreHistoryBadge\"  color={color}>{exp}</IonBadge>\n }\n\n  \n  return (\n    <>\n      {printDay(moment().subtract(6, 'd').format(MOMENT_DATE_FORMAT))}\n      {printDay(moment().subtract(5, 'd').format(MOMENT_DATE_FORMAT))}\n      {printDay(moment().subtract(4, 'd').format(MOMENT_DATE_FORMAT))}\n      {printDay(moment().subtract(3, 'd').format(MOMENT_DATE_FORMAT))}\n      {printDay(moment().subtract(2, 'd').format(MOMENT_DATE_FORMAT))}\n      {printDay(moment().subtract(1, 'd').format(MOMENT_DATE_FORMAT))}\n      {printDay(moment().subtract(0, 'd').format(MOMENT_DATE_FORMAT))}\n    </>\n  )\n\n}\nexport default ChallengeMemberScoreHistory;","import React, { useReducer } from 'react';\nimport { PartyProject, PartyMember } from '../models';\nimport { IonCard, IonCardTitle, IonCardHeader, IonCardContent, IonList, IonItem, IonAlert, IonFooter, IonButton, IonLabel, IonBadge } from '@ionic/react';\nimport { partyService } from '../party.service';\nimport  ulog from 'ulog';\nimport { authService } from '../../auth/authService';\nimport { canEditProjectByRights } from '../../data/utilsData';\nimport { COLOR_LIGHT, COLOR_SUCCESS, COLOR_SECONDARY } from '../../../colors';\nimport ChallengeMemberScoreHistory from './Challenge.member.scoreHistory';\nconst log = ulog('memberlist');\n\nexport interface MembersState {\n  showAddModal: boolean,\n  members: PartyMember[],\n}\n\n\nconst reducer = (state, action): MembersState => {\n  switch(action.type) {\n    case 'showAddMemberModal':\n      return {...state, ...{showAddModal: true}};\n    case 'hideAddMemberModal':\n      return {...state, ...{showAddModal: false}};\n\n    default:\n      log.error('Action type is not a match');\n      return state;\n  }\n}\n\nconst PartyMembersListComponent = ({project}:{project:PartyProject}) => {\n  const [state, _dispatch] = useReducer(reducer, {\n    showAddModal: false,\n    members: [],\n  })\n\n  const dispatch = (type: 'showAddMemberModal'|\n                          'hideAddMemberModal', \n                    data:any = {}) => {\n    _dispatch({type, data});\n  }\n\n  const addMember = () => {\n    dispatch(\"showAddMemberModal\");\n    \n  }\n\n  const hideAddUser = () => {\n    dispatch('hideAddMemberModal');\n  }\n\n  const canEditThisProject = () => {\n    const self = project.members.find(m => m.id === authService.userid);\n    if(!self) return false;\n    return canEditProjectByRights(self.rights);\n  }\n\n  const printScore = (score, index) =>{\n    let color = COLOR_LIGHT;\n    if(index === 0) color = COLOR_SUCCESS;\n    if(index === 1) color = COLOR_SECONDARY;\n    return <IonBadge slot=\"end\" color={color}>{score.exp}</IonBadge>\n  }\n\n  \n  return (\n    <IonCard>\n      <IonCardHeader>\n        <IonCardTitle>Members</IonCardTitle>\n      </IonCardHeader>\n      <IonCardContent>\n        <IonList>\n            {project.members.sort((a,b) => b.score.exp - a.score.exp)\n                            .map((member, i) => (\n          <IonItem key={member.id}>\n            <IonLabel>\n              <h2>{member.username} - \n                  <ChallengeMemberScoreHistory member={member}  />\n              </h2>\n            </IonLabel>\n              {printScore(member.score, i)}\n          </IonItem>\n            ))}\n        </IonList>\n        \n      </IonCardContent>\n      {canEditThisProject()? (\n        <IonFooter>\n          <IonButton onClick={()=>addMember()} fill=\"clear\">Invite</IonButton>\n        </IonFooter>\n      ) : ( <></>)}\n      <IonAlert \n        isOpen={state.showAddModal}\n        onDidDismiss={() => hideAddUser()}\n        header=\"Friend ID:\"\n        subHeader={'Found at bottom of parties page.'}\n        inputs={[\n          {\n            name: 'userid',\n            type: 'text',\n            id: 'adduserid',\n          }\n        ]}\n        buttons={[\n          {\n            text: 'Cancel',\n            role: 'cancel',\n            cssClass: 'secondary',\n            handler: () => {\n              hideAddUser();\n            }\n          },\n          {\n            text: 'Invite User',\n            handler: (data) => {\n              partyService.addUser(data.userid, project);\n              hideAddUser();\n            }\n          }\n        ]}\n      />\n    </IonCard>\n  )\n\n}\nexport default PartyMembersListComponent;","import React, { useEffect, useReducer } from 'react';\nimport { IonItem, IonLabel, IonList, IonText, IonBadge } from '@ionic/react';\nimport { Challenge } from '../models';\nimport { COLOR_LIGHT, COLOR_SUCCESS, COLOR_SECONDARY } from '../../../colors';\nimport ChallengeMemberScoreHistory from './Challenge.member.scoreHistory';\n\n\nexport interface ChallengeLocalState {\n  challenge: Challenge,\n}\n\nconst reducer = (state, action): ChallengeLocalState => {\n  switch(action.type) {\n    case 'challenge':\n      return {...state, ...{challenge:action.data}}\n\n    default:\n      console.log('ERROR WENT TO DEFAULTS:: ', action);\n      return state;\n  }\n}\n\n\nconst ChallengeMembersItem = ({challenge}:\n  {challenge:Challenge}) => {\n\n  const [state, _dispatch] = useReducer(reducer, {\n    challenge,\n  })\n\n  const dispatch = (type:'challenge', data:any) => {\n    _dispatch({type, data});\n  }\n\n  useEffect(() => {\n    dispatch('challenge', challenge);\n  }, [challenge])\n\n  const printScore = (score, index) =>{\n    let color = COLOR_LIGHT;\n    if(index === 0) color = COLOR_SUCCESS;\n    if(index === 1) color = COLOR_SECONDARY;\n    return <IonBadge slot=\"end\" color={color}>{score.exp}</IonBadge>\n  }\n\n\n  const print = () => {\n    return (\n      <IonList>\n        {state.challenge.members.sort((a,b)=> b.score.exp - a.score.exp)\n          .map((member, i) => (\n            <IonItem key={member.id}>\n              <IonLabel>\n                <h2>{member.username} - \n                  <ChallengeMemberScoreHistory member={member} />\n                </h2>\n              </IonLabel>\n              {printScore(member.score, i)}\n            </IonItem>\n        ))}\n      </IonList>\n    );\n  }\n  \n  return print();\n};\n\nexport default ChallengeMembersItem;\n\n","import React, { useEffect, useReducer } from 'react';\nimport { IonItem, IonCard, IonCardHeader, IonCardTitle, IonCardContent, IonNote, IonFooter, IonButton, IonLabel } from '@ionic/react';\nimport { Challenge, ChallengeState } from '../models';\nimport ulog from 'ulog';\nimport { partyService } from '../party.service';\nimport { authService } from '../../auth/authService';\nimport ChallengeMembersItem from './Challenge.members.item.component';\nimport { canEditProject } from '../../data/utilsData';\n\nconst log = ulog('clubs');\n\nexport interface ChallengeLocalState {\n  challenge: Challenge,\n}\n\nconst reducer = (state, action): ChallengeLocalState => {\n  switch(action.type) {\n    case 'challenge':\n      return {...state, ...{challenge:action.data}}\n\n    default:\n      console.log('ERROR WENT TO DEFAULTS:: ', action);\n      return state;\n  }\n}\n\n\nconst ChallengeListItemComponent = ({challenge, showEditModalFunction}:\n  {challenge:Challenge, showEditModalFunction:{(challenge: Challenge)}}) => {\n\n  const [state, _dispatch] = useReducer(reducer, {\n    challenge,\n  })\n\n  const dispatch = (type:'challenge', data:any) => {\n    _dispatch({type, data});\n  }\n\n  useEffect(() => {\n    dispatch('challenge', challenge);\n  }, [challenge])\n\n  const joined = challenge.members.find(m => m.id === authService.userid);\n\n  log.info('Challenge Item: ', state);\n\n  const printTitle = () => {\n    if(state.challenge.state === ChallengeState.waiting){\n      return <IonCardTitle>{state.challenge.name} - Join if you dare</IonCardTitle>\n    }\n    else if(state.challenge.state === ChallengeState.current){\n      return <IonCardTitle>{state.challenge.name} - In progress</IonCardTitle>\n    }\n    else if(state.challenge.state === ChallengeState.finished) {\n      return <IonCardTitle>{state.challenge.name} - Finished</IonCardTitle>\n    }\n    else if(state.challenge.state === ChallengeState.future) {\n      return <IonCardTitle>{state.challenge.name} - Preivew of future challenge</IonCardTitle>\n    }\n    return <IonCardTitle>{state.challenge.name}</IonCardTitle>\n  }\n\n  const printInfo = () => {\n    if(state.challenge.regularityInterval === 'day'){\n      return (\n        <IonItem>\n          <IonLabel>\n            <h2>{state.challenge.note}</h2>\n            <IonNote>\n              Challenge goal, for <strong>every day</strong>.\n            </IonNote>\n          </IonLabel>\n        </IonItem>\n      )\n    }\n    \n    return (\n      <IonItem>\n        <IonLabel>\n          <h2>{state.challenge.note}</h2>\n          <IonNote>\n            Challenge goal is for \n            <strong> {state.challenge.regularityIntervalGoal} times {state.challenge.regularityInterval}</strong>\n          </IonNote>\n        </IonLabel>\n      </IonItem>\n    )\n  }\n\n  const challengeSubmitForToday = () => {\n\n    return false;\n  }\n\n  const printActionButtons = () => {\n    if(state.challenge.state === ChallengeState.waiting && joined === undefined){\n      return <IonButton size=\"small\"   fill=\"clear\"\n            onClick={() => partyService.acceptChallenge(state.challenge)} >\n            Accept Challenge</IonButton>\n    }\n    else if(state.challenge.state === ChallengeState.current){\n      if(challengeSubmitForToday()) return;\n      return <IonButton size=\"small\"  fill=\"clear\"\n        onClick={() => partyService.submitChallengeActions(state.challenge.id, 1)} >\n            Done</IonButton>\n    }\n    else if(state.challenge.state === ChallengeState.finished) {\n\n    }\n    else if(state.challenge.state === ChallengeState.future) {\n\n    }\n\n  }\n\n  const printAdminActionButtons = () => {\n    if(!canEditProject(state.challenge.id, authService.getUser())) return;\n    if(state.challenge.state === ChallengeState.waiting){\n      return <>\n              <IonButton size=\"small\" fill=\"clear\"\n                onClick={() => partyService.changeChallengeState(state.challenge.id, ChallengeState.current)} >\n                Start Challenge</IonButton>\n              <IonButton size=\"small\" fill=\"clear\"\n                onClick={() => partyService.changeChallengeState(state.challenge.id, ChallengeState.waiting)} >\n                Freeze For Future Use</IonButton>\n            </>\n    }\n    else if(state.challenge.state === ChallengeState.current){\n\n    }\n    else if(state.challenge.state === ChallengeState.finished) {\n\n    }\n    else if(state.challenge.state === ChallengeState.future) {\n\n    }\n\n  }\n\n\n\n\n  const print = () => {\n    return (\n        <IonCard>\n          <IonCardHeader>\n            {/*<IonCardSubtitle>Card Subtitle</IonCardSubtitle>*/}\n            {printTitle()}\n          </IonCardHeader>\n          <IonCardContent>\n            <ChallengeMembersItem challenge={state.challenge} />\n            {printInfo()}\n          </IonCardContent>\n          <IonFooter>\n            {printActionButtons()}\n            {printAdminActionButtons()}\n          </IonFooter>\n         {/* \n          <IonFab horizontal=\"end\" vertical=\"bottom\" edge>\n            <IonFabButton size=\"small\" color={COLOR_LIGHT} onClick={() => showEditModalFunction(doc)}>\n              <IonIcon size=\"large\" icon={cog} />\n            </IonFabButton>\n          </IonFab>\n        */}\n        </IonCard>\n    );\n  }\n  \n  return print();\n};\n\nexport default ChallengeListItemComponent;\n\n","import React, { useState } from 'react';\nimport { IonItem, IonLabel, IonIcon, IonInput, IonTextarea, IonButton, \n  IonHeader, IonTitle, IonToolbar, IonContent, IonFooter, \n  IonRange, IonFab, \n  IonFabButton, IonAlert, IonSegment, IonSegmentButton } from '@ionic/react';\nimport { ChallengeIntervals, Challenge, ChallengeDifficulty } from '../models';\nimport { capitalize } from '../../../utils';\nimport { COLOR_DANGER } from '../../../colors';\nimport { trash } from 'ionicons/icons';\nimport ulog from 'ulog';\n\nconst log = ulog('party');\n\n\ninterface challengeState {\n  regularity: {\n    interval: ChallengeIntervals,\n    min: number,\n    max: number,\n  }\n  doc: Challenge,\n  showDeleteWarrning: boolean\n}\n\nconst getRegularityValues = (interval: ChallengeIntervals) => {\n  switch (interval) {\n    case ChallengeIntervals.day:\n      return {interval: interval, min:1, max: 1}\n    case ChallengeIntervals.week:\n      return {interval: interval, min:1, max: 6}\n    case ChallengeIntervals.month:\n      return {interval: interval, min:1, max: 25}\n  }\n}\n\nconst ChallengeAddComponent = ({challenge, dismissFunc}:\n  {challenge:Challenge|null, dismissFunc: {(challenge:Challenge|null, action: 'save'|'remove'|'none')}}) => {\n  const _challenge = challenge|| new Challenge();\n  const getDefaultRegularityState: challengeState = {\n    regularity: getRegularityValues(_challenge.regularityInterval),\n    doc: _challenge,\n    showDeleteWarrning: false\n  }\n  const [state, setState] = useState<challengeState>({...getDefaultRegularityState, ...{doc: _challenge}});\n\n\n  const handleChange = (e) => {\n    const newDoc = {...state.doc, ...{[e.target.name]:e.detail.value}}\n    const newState = {...state, ...{doc: newDoc}};\n    setState(newState);\n  }\n\n  const handlerRegularityValue = (e) => {\n    const newDoc = {...state.doc, ...{regularityValue: e.detail.value}};\n    setState({...state, ...{doc: newDoc}});\n  }\n\n  const handlerRegularityIntervalChange = (value) => {\n    value = value || 'day';\n    const newDoc = {...state.doc, ...{regularityInterval: value, regularityValue: 1}};\n    const newReg = {...state.regularity, ...getRegularityValues(value)};\n    setState({...state, ...{doc:newDoc, regularity: newReg}});\n  }\n\n  const printRegularityLabel = () => {\n\n    const times = (state.doc.regularityIntervalGoal > 1)? ' times a ': ' time a ';\n    if(state.doc.regularityInterval === 'day'){\n      return 'I will repeat this task every day.'\n    }\n    \n    return 'I will repeat this task ' + state.doc.regularityIntervalGoal + times + state.doc.regularityInterval\n  }\n\n  const handleDifficultyChange = (e) => {\n    const newDoc = {...state.doc, ...{difficulty: e.detail.value}};\n    setState({...state, ...{doc: newDoc}});\n  }\n\n  const printDifficultyLabel = (chdiff: ChallengeDifficulty): string => {\n    switch(chdiff) {\n      case ChallengeDifficulty.trivial:\n        return 'Easy peasy lemon squeezy';\n      case ChallengeDifficulty.easy:\n        return 'Piece of Cake';\n      case ChallengeDifficulty.medium:\n        return \"Let's Rock\";\n      case ChallengeDifficulty.hard:\n        return 'No Pain, No Gain';\n      case ChallengeDifficulty.extreme:\n        return 'Death Wish';\n    }\n  }\n\n  const showRemoveWarrning = () => {\n    setState({...state, ...{showDeleteWarrning: true}});\n  }\n\n  const hideRemoveWarrning = () => {\n    setState({...state, ...{showDeleteWarrning: false}});\n  }\n\n  const removehabit = () => {\n    hideRemoveWarrning();\n    dismissFunc(state.doc, 'remove');\n  }\n\n\n\n  const print = () => {\n      return (\n      <>\n        <IonHeader>\n          <IonToolbar>\n            {/*\n            <IonButtons slot=\"start\">\n              <IonButton> <IonIcon size=\"large\" icon={arrowBack} /></IonButton>\n            </IonButtons>\n            */}\n            <IonTitle>Add Challenge</IonTitle>\n          </IonToolbar>\n        </IonHeader>\n        <IonContent>\n          <IonItem>\n              <IonLabel position=\"floating\">Name</IonLabel>\n              <IonInput \n                  name=\"name\"\n                  placeholder=\"Read book, Go running ...\" \n                  onIonChange={handleChange}\n                  value={state.doc.name} />\n          </IonItem>\n          <IonItem>\n              <IonLabel position=\"floating\">Note</IonLabel>\n              <IonTextarea \n                  placeholder=\"Enter more information here, motivate yourself...\"\n                  name=\"note\"\n                  onIonChange={handleChange}\n                  value={state.doc.note}></IonTextarea>\n          </IonItem>\n          <IonItem>\n            <IonSegment value={state.doc.regularityInterval}\n                        onIonChange={(e) => handlerRegularityIntervalChange(e.detail.value)}>\n              <IonSegmentButton value=\"day\">\n                <IonLabel>Daily</IonLabel>\n              </IonSegmentButton>\n              <IonSegmentButton value=\"week\">\n                <IonLabel>Weekly</IonLabel>\n              </IonSegmentButton>\n              <IonSegmentButton value=\"month\">\n                <IonLabel>Monthly</IonLabel>\n              </IonSegmentButton>\n            </IonSegment>\n          </IonItem>\n\n          {(state.doc.regularityInterval !== 'day')? (\n            <>\n              <IonRange \n                    min={state.regularity.min}\n                    max={state.regularity.max}\n                    debounce={100}\n                    value={state.doc.regularityIntervalGoal}\n                    onIonChange={handlerRegularityValue}\n                    color=\"secondary\" >\n                <IonLabel slot=\"start\">{state.regularity.min}</IonLabel>\n                <IonLabel slot=\"end\">{state.regularity.max}</IonLabel>\n              </IonRange>\n            </>\n          ) : (\n          <></> )}\n          <IonItem>\n            <IonLabel>{printRegularityLabel()}</IonLabel>\n          </IonItem>\n\n          <IonRange min={0} \n                    max={4} \n                    debounce={100}\n                    value={state.doc.difficulty}\n                    onIonChange={handleDifficultyChange}\n                    color=\"secondary\">\n              <IonLabel slot=\"start\">{capitalize(printDifficultyLabel(ChallengeDifficulty.trivial))}</IonLabel>\n              <IonLabel slot=\"end\">{capitalize(printDifficultyLabel(ChallengeDifficulty.extreme))}</IonLabel>\n          </IonRange>\n\n          <IonItem>\n            <IonLabel>{printDifficultyLabel(state.doc.difficulty)}</IonLabel>\n          </IonItem>\n        </IonContent> \n\n        <IonFooter>\n          <IonToolbar>\n            <IonTitle>\n              <IonButton onClick={() => dismissFunc(state.doc, 'save')}>Save</IonButton>\n              <IonButton onClick={() => dismissFunc(null, 'none')}>Cancel</IonButton>\n            </IonTitle>\n          </IonToolbar>\n        </IonFooter>\n        <IonFab horizontal=\"end\" vertical=\"bottom\" >\n          <IonFabButton size=\"small\" color={COLOR_DANGER} onClick={() => showRemoveWarrning()}>\n            <IonIcon size=\"large\" icon={trash} />\n          </IonFabButton>\n        </IonFab>\n        <IonAlert\n          isOpen={state.showDeleteWarrning}\n          onDidDismiss={() => hideRemoveWarrning}\n          header={'Warrning!!!'}\n          message={'Are you sure you want to <strong>delete</strong> this habit?'}\n          buttons={[\n            {\n              text: 'Cancel',\n              role: 'cancel',\n              cssClass: 'secondary',\n              \n            },\n            {\n              text: 'Yes Im Sure',\n              handler: () => removehabit()\n            }\n          ]}\n        />\n      </>\n      );\n  }\n  \n  return print();\n};\n\nexport default ChallengeAddComponent;\n","import React, { useReducer, useEffect } from 'react';\nimport { IonList, IonModal, IonCard, \n  IonCardContent, IonCardHeader, IonCardTitle, \n  IonFab, IonFabButton, IonIcon, IonButton, IonFooter } from '@ionic/react';\nimport { Challenge, PartyProject, TYPE_PARTY } from '../models';\nimport ChallengeListItemComponent from './Challenge.listitem.component';\nimport ChallengeAddComponent from './Challenge.add.component';\nimport { add } from 'ionicons/icons';\nimport { dataService } from '../../data/dataService';\nimport { partyService } from '../party.service';\nimport { getProjectChildId, canEditProjectByRights } from '../../data/utilsData';\nimport { saveIntoArray } from '../../../utils';\nimport  ulog from 'ulog';\nimport { authService } from '../../auth/authService';\n\n//ulog.level = 7;\nconst log = ulog('challengelist');\n\n\nexport interface ChallengeListState {\n  showModal: boolean,\n  modalChallenge: Challenge|null,\n  challenges: Challenge[],\n}\n\nconst reducer = (state, action): ChallengeListState => {\n  switch(action.type) {\n    case 'addChallengeModal': \n      return {...state, ...{showModal: true, modalChalleng: action.data}}\n    case 'hideChallengeModal':\n      return {...state, ...{showModal: false, modalChalleng: null}}\n    case 'loadChallenges': \n      return {...state, ...{challenges: action.data}}\n    case 'challengeChange':\n      return {...state, ...{challenges:saveIntoArray(action.data,state.challenges)}};\n    default:\n      return state;\n  }\n}\n\n\n\n\nconst ChallengeListComponent = ({project}:{project: PartyProject}) => {\n  const [state, _dispatch] = useReducer(reducer, {\n    showModal: false,\n    modalChallenge: null,\n    challenges: [],\n  });\n\n  useEffect(() => {\n    const sub = dataService.subscribeByPropertyChange('secondaryType', 'challenge')\n      .subscribe(change => {\n        if(change.id.startsWith(getProjectChildId(project.id)))\n          dispatch('challengeChange', change);\n\n    });\n    if(project.id)\n      loadChallenges(project.id);\n\n    return () => {\n      sub.unsubscribe();\n    };\n  // eslint-disable-next-line react-hooks/exhaustive-deps\n  }, [project.id])\n\n  const loadChallenges = async (id: string) => {\n    const res = await dataService.queryByProperty(\n        'secondaryType', 'equals', 'challenge', TYPE_PARTY);\n    const challenges = res.filter(doc => doc.id.startsWith(getProjectChildId(id)));\n    dispatch('loadChallenges', challenges);\n  };\n\n  const dispatch = (type: 'addChallengeModal'|\n                          'loadChallenges'|\n                          'challengeChange'|\n                          'hideChallengeModal', data:any) => {\n    _dispatch({type, data});\n  }\n  \n  const addChallenge = (ch:Challenge = new Challenge()) => {\n    dispatch('addChallengeModal', ch);\n  }\n\n  const hideChallengeModal = () => {\n    dispatch('hideChallengeModal', null);\n  }\n\n  const challengeDismissFunc = (challenge: Challenge|null, action:'save'|'remove'|'none') => {\n    hideChallengeModal();\n    if(action === 'save' && challenge != null){\n      partyService.saveChallenge(challenge, project);\n    }\n    else if(action === 'remove' && challenge != null && challenge.id){\n      //dataFunc.remove(habit.id);\n    }\n  }\n\n\n  const canEditThisProject = () => {\n    const self = project.members.find(m => m.id === authService.userid);\n    if(!self) return false;\n    return canEditProjectByRights(self.rights);\n  }\n\n  return (\n    <IonCard>\n      <IonCardHeader>\n        <IonCardTitle>Challenges</IonCardTitle>\n      </IonCardHeader>\n      <IonCardContent>\n        <IonList>\n          {state.challenges.map(challenge => (\n                <ChallengeListItemComponent\n                          challenge={challenge} \n                          key={challenge.id} \n                          showEditModalFunction={addChallenge}/>\n          ))}\n        </IonList>\n        {state.showModal? (\n          <IonModal isOpen={state.showModal} onDidDismiss={() => hideChallengeModal()}>\n          <ChallengeAddComponent challenge={state.modalChallenge} \n                              dismissFunc = {challengeDismissFunc}  />\n          </IonModal>\n        ) : (\n          <></>\n        )}\n      </IonCardContent>\n      <IonFooter>\n        {canEditThisProject()? (\n          <IonButton    onClick={() => addChallenge()}\n            fill=\"clear\">Add New Challenge</IonButton>\n        ) : ( <></>)}\n      </IonFooter>\n    </IonCard>\n  )\n}\n\n\n\nexport default ChallengeListComponent;","import React, { useState, useEffect, useRef } from 'react';\nimport { IonPage, IonContent} from '@ionic/react';\nimport HeaderWithProgress from '../../../components/HeaderWithProgress';\nimport { PartyProject, TYPE_PARTY } from '../models';\nimport { useParams, useHistory } from 'react-router-dom';\nimport { dataService } from '../../data/dataService';\nimport { HabitsService } from '../../../pages/habits/habits.service';\nimport PartyMembersListComponent from '../components/Members.list.component';\nimport ChallengeListComponent from '../components/Challenge.list.component';\n\n\n\ninterface State {\n  party:PartyProject,\n}\n\nconst getInitState = {\n    party: new PartyProject(),\n}\n\n\nconst loadParty = async (id:string, state, setState, history) => {\n\n  const dataSub = dataService.getReadySub().subscribe(async (ready) => {\n    if(!ready) return;\n    const party = await dataService.getDoc(id, TYPE_PARTY);\n    \n    if(!party){\n      dataSub.unsubscribe();\n      history.push('/parties');\n      return\n    }\n    setState({...state, ...{party}})\n    dataSub.unsubscribe();\n  })\n  \n}\n\n//*********** Page Start *************/\nconst PartyViewPage = () => {\n  const {id} = useParams();\n  const history = useHistory();\n  const [state, setState] = useState<State>(getInitState)\n  const habitsService = useRef(new HabitsService());\n\n  //if(!id) return history.push('/parties');\n  useEffect(() => {\n    if(id)\n      loadParty(id, state, setState, history)\n    else {\n      history.push('/parties');\n    }\n  }, [id])\n  \n\n\n\n\n\n  return (\n    <IonPage>\n      <HeaderWithProgress title={\"Party: \" + state.party.name} />\n      <IonContent>\n        \n      {state.party.id? (\n        <>\n          <PartyMembersListComponent  project={state.party} />\n          <ChallengeListComponent project={state.party} />\n        </>\n      ):(<></>)}\n\n      </IonContent>\n    </IonPage>\n  )\n}\n\nexport default PartyViewPage;","import React, {  } from 'react';\nimport { Redirect, Route, useHistory, useLocation } from 'react-router-dom';\nimport UserPage from './modules/auth/components/user.page';\nimport TodosPage from './pages/todo/Todos.page';\nimport IntroPage from './modules/auth/components/intro.page';\nimport { useAppStatus, AppStatus } from './modules/app/hooks/appStatus.hook';\nimport Home from './pages/Home';\nimport NotFound from './pages/NotFound';\nimport UnauthenticatedRoute from './modules/auth/unauthenticatedRoute';\nimport HabitsPage from './pages/habits/Habits.page';\nimport { IonSplitPane, IonRouterOutlet } from '../node_modules/@ionic/react';\nimport Menu from './components/Menu';\nimport PartiesPage from './modules/parties/pages/Parties.page';\nimport PartyViewPage from './modules/parties/pages/Party.view.page';\n\nexport const Routes = () => {\n  const [appStatus] = useAppStatus();\n  const history = useHistory();\n  const location = useLocation();\n\n  if(appStatus.status === AppStatus.auth && location.pathname.startsWith('/auth/')){\n    if(location.state){\n      const newpath = location.state['prev'] || '/';\n      history.push(newpath);\n    }\n  }\n  \n  const getRoutes = () => {\n    switch(appStatus.status){\n      case AppStatus.auth:\n        return (\n          <IonSplitPane when=\"sm\" contentId=\"main\">\n            <Menu key=\"menumain\"/>\n            <IonRouterOutlet id=\"main\">\n                <Route path=\"/home\" component={Home} exact={true} />           \n                <Route exact path=\"/auth/user\" component={UserPage} />\n                <Route path=\"/todos\" component={TodosPage} exact={true} />\n                <Route path=\"/todos/:list\" component={TodosPage} exact={true} />\n                <Route path=\"/todos/tag/:tag\" component={TodosPage} exact={true} />\n                <Route path=\"/habits\" component={HabitsPage} exact={true} />\n                <Route path=\"/parties\" component={PartiesPage} exact={true} />\n                <Route path=\"/parties/:id\" component={PartyViewPage} exact={true} />\n                <Route path=\"/\" render={() => <Redirect to=\"/home\" />} exact={true} />\n                <Route path=\"/404\" component={NotFound} />\n                <Redirect to=\"/404\" />\n            </IonRouterOutlet>\n        </IonSplitPane>\n        )\n      case AppStatus.guest:\n          return (\n            <IonRouterOutlet>\n              <UnauthenticatedRoute exact path=\"*\" component={Home} />\n            </IonRouterOutlet>\n          );\n      default:\n          return (\n            <IonRouterOutlet>\n              <Route exact path=\"*\"  component={IntroPage} />\n            </IonRouterOutlet>\n          );\n      \n\n    }\n  }\n\n  return getRoutes();\n}","import React, { useState, useEffect } from 'react';\nimport { Subscription } from 'rxjs';\nimport { toastService, ToastMessage } from './toastService';\nimport { ToastContainer } from 'react-toastify';\nimport 'react-toastify/dist/ReactToastify.css';\n\nexport const Toasts: React.FC = () => {\n  const [message, setMessage] = useState<ToastMessage | null>(null);\n\n  useEffect(() => {\n    const subscriptions: Subscription[] = [\n      toastService.messages$.subscribe((m: ToastMessage) =>{\n        setMessage(m);\n      })\n    ];\n    return () => { subscriptions.map(it => it.unsubscribe()) };\n  },[message]);\n\n  return (\n    <div className='toastDiv' >\n      <ToastContainer\n          position=\"top-right\"\n          autoClose={5000}\n          hideProgressBar\n          newestOnTop={false}\n          closeOnClick\n          rtl={false}\n          draggable\n          pauseOnHover\n          />\n    </div>\n  );\n};","import React from 'react';\nimport { IonApp } from '@ionic/react';\nimport { IonReactRouter } from '@ionic/react-router';\n\n\n/* Core CSS required for Ionic components to work properly */\nimport '@ionic/react/css/core.css';\n\n/* Basic CSS for apps built with Ionic */\nimport '@ionic/react/css/normalize.css';\nimport '@ionic/react/css/structure.css';\nimport '@ionic/react/css/typography.css';\n\n/* Optional CSS utils that can be commented out */\nimport '@ionic/react/css/padding.css';\nimport '@ionic/react/css/float-elements.css';\nimport '@ionic/react/css/text-alignment.css';\nimport '@ionic/react/css/text-transformation.css';\nimport '@ionic/react/css/flex-utils.css';\nimport '@ionic/react/css/display.css';\n\n/* Theme variables */\nimport './theme/variables.css';\n\nimport './theme/my.css';\n\nimport { Loading } from './modules/loading/loading.component';\nimport { Routes } from './routes';\nimport { Toasts } from './modules/toast/toast.component';\n\n\n\nconst App: React.FC = () => (\n  <IonApp>\n    <IonReactRouter>\n      <Loading /><Toasts />\n      <Routes />\n    </IonReactRouter>\n  </IonApp>\n);\n\nexport default App;\n","// This optional code is used to register a service worker.\n// register() is not called by default.\n\n// This lets the app load faster on subsequent visits in production, and gives\n// it offline capabilities. However, it also means that developers (and users)\n// will only see deployed updates on subsequent visits to a page, after all the\n// existing tabs open on the page have been closed, since previously cached\n// resources are updated in the background.\n\n// To learn more about the benefits of this model and instructions on how to\n// opt-in, read https://bit.ly/CRA-PWA\n\nconst isLocalhost = Boolean(\n  window.location.hostname === 'localhost' ||\n    // [::1] is the IPv6 localhost address.\n    window.location.hostname === '[::1]' ||\n    // 127.0.0.0/8 are considered localhost for IPv4.\n    window.location.hostname.match(\n      /^127(?:\\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/\n    )\n);\n\ntype Config = {\n  onSuccess?: (registration: ServiceWorkerRegistration) => void;\n  onUpdate?: (registration: ServiceWorkerRegistration) => void;\n};\n\nexport function register(config?: Config) {\n  if (process.env.NODE_ENV === 'production' && 'serviceWorker' in navigator) {\n    // The URL constructor is available in all browsers that support SW.\n    const publicUrl = new URL(\n      process.env.PUBLIC_URL,\n      window.location.href\n    );\n    if (publicUrl.origin !== window.location.origin) {\n      // Our service worker won't work if PUBLIC_URL is on a different origin\n      // from what our page is served on. This might happen if a CDN is used to\n      // serve assets; see https://github.com/facebook/create-react-app/issues/2374\n      return;\n    }\n\n    window.addEventListener('load', () => {\n      const swUrl = `${process.env.PUBLIC_URL}/service-worker.js`;\n\n      if (isLocalhost) {\n        // This is running on localhost. Let's check if a service worker still exists or not.\n        checkValidServiceWorker(swUrl, config);\n\n        // Add some additional logging to localhost, pointing developers to the\n        // service worker/PWA documentation.\n        navigator.serviceWorker.ready.then(() => {\n          console.log(\n            'This web app is being served cache-first by a service ' +\n              'worker. To learn more, visit https://bit.ly/CRA-PWA'\n          );\n        });\n      } else {\n        // Is not localhost. Just register service worker\n        registerValidSW(swUrl, config);\n      }\n    });\n  }\n}\n\nfunction registerValidSW(swUrl: string, config?: Config) {\n  navigator.serviceWorker\n    .register(swUrl)\n    .then(registration => {\n      registration.onupdatefound = () => {\n        const installingWorker = registration.installing;\n        if (installingWorker == null) {\n          return;\n        }\n        installingWorker.onstatechange = () => {\n          if (installingWorker.state === 'installed') {\n            if (navigator.serviceWorker.controller) {\n              // At this point, the updated precached content has been fetched,\n              // but the previous service worker will still serve the older\n              // content until all client tabs are closed.\n              console.log(\n                'New content is available and will be used when all ' +\n                  'tabs for this page are closed. See https://bit.ly/CRA-PWA.'\n              );\n\n              // Execute callback\n              if (config && config.onUpdate) {\n                config.onUpdate(registration);\n              }\n            } else {\n              // At this point, everything has been precached.\n              // It's the perfect time to display a\n              // \"Content is cached for offline use.\" message.\n              console.log('Content is cached for offline use.');\n\n              // Execute callback\n              if (config && config.onSuccess) {\n                config.onSuccess(registration);\n              }\n            }\n          }\n        };\n      };\n    })\n    .catch(error => {\n      console.error('Error during service worker registration:', error);\n    });\n}\n\nfunction checkValidServiceWorker(swUrl: string, config?: Config) {\n  // Check if the service worker can be found. If it can't reload the page.\n  fetch(swUrl, {\n    headers: { 'Service-Worker': 'script' }\n  })\n    .then(response => {\n      // Ensure service worker exists, and that we really are getting a JS file.\n      const contentType = response.headers.get('content-type');\n      if (\n        response.status === 404 ||\n        (contentType != null && contentType.indexOf('javascript') === -1)\n      ) {\n        // No service worker found. Probably a different app. Reload the page.\n        navigator.serviceWorker.ready.then(registration => {\n          registration.unregister().then(() => {\n            window.location.reload();\n          });\n        });\n      } else {\n        // Service worker found. Proceed as normal.\n        registerValidSW(swUrl, config);\n      }\n    })\n    .catch(() => {\n      console.log(\n        'No internet connection found. App is running in offline mode.'\n      );\n    });\n}\n\nexport function unregister() {\n  if ('serviceWorker' in navigator) {\n    navigator.serviceWorker.ready.then(registration => {\n      registration.unregister();\n    });\n  }\n}\n","import React from 'react';\nimport ReactDOM from 'react-dom';\nimport App from './App';\nimport * as serviceWorker from './serviceWorker';\n\nReactDOM.render(<App />, document.getElementById('root'));\n\n// If you want your app to work offline and load faster, you can change\n// unregister() to register() below. Note this comes with some pitfalls.\n// Learn more about service workers: https://bit.ly/CRA-PWA\nserviceWorker.unregister();\n"],"sourceRoot":""}